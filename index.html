<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Learning about Rust">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Learning about Rust">
<meta property="og:locale">
<meta property="article:author" content="QsunOu">
<meta property="article:tag" content="rust">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/"/>





  <title>Hexo</title>
  








<meta name="generator" content="Hexo 7.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/10/Solana-%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/10/Solana-%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/" itemprop="url">Solana 合约开发 - 基础环境安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-10T22:14:58+08:00">
                2024-11-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Solana-cli-安装"><a href="#Solana-cli-安装" class="headerlink" title="Solana-cli 安装:"></a><code>Solana-cli</code> 安装:</h1><p>以 macos 为例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//检查xcode是否安装(其实一般自带已经安装)</span><br><span class="line">xcode-select -p</span><br><span class="line"></span><br><span class="line">//没有安装则</span><br><span class="line">xcode-select --install</span><br><span class="line"></span><br><span class="line">//安装Rust，之前已安装暂不赘述</span><br><span class="line"></span><br><span class="line">//安装 solana-cli ，安装特定版本将stable换成 v2.x.x</span><br><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -sSfL https://release.anza.xyz/stable/install)</span>&quot;</span></span><br><span class="line"></span><br><span class="line">//检查是否安装成功</span><br><span class="line">solana -V</span><br><span class="line"></span><br><span class="line">//如果之前已经安装过，可采用以下方式升级solana</span><br><span class="line">agave-install  update</span><br></pre></td></tr></table></figure>

<h1 id="Anchor开发框架安装"><a href="#Anchor开发框架安装" class="headerlink" title="Anchor开发框架安装:"></a><code>Anchor</code>开发框架安装:</h1><p>Anchor 是 Solana 区块链上的一种开发框架，旨在简化 Solana 程序的开发过程，使得开发者可以更容易地编写、测试和部署智能合约，虽然直接原生写rust也可以，但使用anchor会比较方便。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##正常安装：</span></span><br><span class="line">cargo install --git https://github.com/coral-xyz/anchor avm --locked --force</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##如果rust版本大于1.79，上面那条可能会报错，可尝试以下方案：</span></span><br><span class="line">cargo install --git https://github.com/coral-xyz/anchor --tag v0.30.1 anchor-cli --force</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##如果还不行，就手动安装：</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/coral-xyz/anchor.git</span><br><span class="line"><span class="built_in">cd</span> anchor</span><br><span class="line">git checkout avm</span><br><span class="line">cargo build --locked</span><br><span class="line"><span class="built_in">cd</span> avm</span><br><span class="line">cargo install --path .</span><br><span class="line"></span><br><span class="line">vi Cargo.toml</span><br><span class="line"><span class="comment">##添加：</span></span><br><span class="line">[net]</span><br><span class="line">git-fetch-with-cli = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">-----------------------------------------------</span><br><span class="line"><span class="comment">##上面的安装完以后安装avm:</span></span><br><span class="line"></span><br><span class="line">avm install latest</span><br><span class="line">avm use latest</span><br><span class="line"></span><br><span class="line">anchor -V</span><br><span class="line"><span class="comment">##显示anchor-cli 0.30.1，有显示则成功。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意！！！：</span><br><span class="line">由于rust、cargo、anchor之间的版本依赖非常混乱，简直是各玩各的，版本如果不对很有可能报错，以下是本人测试稳定可用版本：</span><br><span class="line">rustc --version</span><br><span class="line">rustc 1.79.0</span><br><span class="line">cargo --version</span><br><span class="line">cargo 1.79.0</span><br><span class="line">anchor --version</span><br><span class="line">anchor-cli 0.30.1</span><br><span class="line">solana -V</span><br><span class="line">solana-cli 2.1.9</span><br></pre></td></tr></table></figure>

<h1 id="Solana-cli-的使用"><a href="#Solana-cli-的使用" class="headerlink" title="Solana-cli 的使用:"></a><code>Solana-cli</code> 的使用:</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##创建一个新钱包</span></span><br><span class="line"><span class="comment">##pubkey(钱包地址）默认存储位置 ~/.config/solana/id.json</span></span><br><span class="line">solana-keygen new   <span class="comment"># --force overwrite 可重建钱包</span></span><br><span class="line"><span class="comment">#可建多个不同钱包，solana-keygen new -o /Users/qsun-ou/.config/solana/ad1.json</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置默认钱包为哪个，可切换不同钱包json文件</span></span><br><span class="line">solana config <span class="built_in">set</span> -k  ~/.config/solana/ad1.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 空投SOL代币（别想多，localnet 或者 devnet 而已，用来做测试,如果是开发网要在后面加devnet的url）</span></span><br><span class="line">solana airdrop 5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#还有一些常见用法：</span></span><br><span class="line"><span class="comment">#该命令用于获取当前Solana CLI配置的信息，包括所连接的集群（devnet, testnet, mainnet-beta等）、默认的公钥（如果已设置）等。</span></span><br><span class="line">solana config get</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用此命令可以更改当前Solana CLI配置中的集群URL。这里的 &lt;net&gt; 可以是任何有效的Solana集群URL，例如 https://api.devnet.solana.com 对于Devnet环境。也可以直接使用快捷方式如 devnet, testnet, 或 mainnet-beta 来切换到不同的网络环境。</span></span><br><span class="line">solana config <span class="built_in">set</span> --url &lt;net&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#此命令用于生成一个新的密钥对。这是创建新钱包的第一步，它会生成一个全新的私钥和相应的公钥。请确保安全地保存好生成的私钥文件。</span></span><br><span class="line">solana-keygen new</span><br><span class="line"></span><br><span class="line"><span class="comment">#该命令会显示与当前活动密钥对（由Solana CLI配置指定）相关联的Solana公共地址。如果您有多个密钥对，可以通过指定密钥对路径来查看特定地址：solana address --keypair &lt;path-to-keypair-file&gt;。</span></span><br><span class="line">solana address</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询指定公共密钥 &lt;pub_key&gt; 的Solana账户余额。如果不提供公共密钥参数，则默认查询当前配置的密钥对对应的账户余额。</span></span><br><span class="line">solana balance &lt;pub_key&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行从发送者账户到接收者账户的转账操作。需要提供接收者的公共密钥 &lt;recipient_public_key&gt; 和要转移的数量 &lt;amount&gt;。--from 参数允许您指定发送者账户的密钥对路径 &lt;sender_keypair_path&gt;，如果不指定，默认使用当前配置的密钥对。</span></span><br><span class="line">solana transfer &lt;recipient_public_key&gt; &lt;amount&gt; --from &lt;sender_keypair_path&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="启动本地Solana环境"><a href="#启动本地Solana环境" class="headerlink" title="启动本地Solana环境"></a>启动本地Solana环境</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">启动本地节点：</span><br><span class="line">solana-test-validator</span><br><span class="line"></span><br><span class="line">配置Solana Cli使用本地节点：</span><br><span class="line">solana config <span class="built_in">set</span> --url http://localhost:8899</span><br><span class="line"></span><br><span class="line">查看配置地址是否正确：</span><br><span class="line">solana config get  </span><br></pre></td></tr></table></figure>

<h1 id="通过区块链浏览器查看账户交易"><a href="#通过区块链浏览器查看账户交易" class="headerlink" title="通过区块链浏览器查看账户交易"></a>通过区块链浏览器查看账户交易</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">例如</span><br><span class="line">https://explorer.solana.com/address/[钱包地址]?cluster=devnet</span><br><span class="line"></span><br><span class="line">也可以在浏览里面切换localnet、testnet等。</span><br></pre></td></tr></table></figure>

<h1 id="其他参考链接："><a href="#其他参考链接：" class="headerlink" title="其他参考链接："></a>其他参考链接：</h1><p><a target="_blank" rel="noopener" href="https://solana.com/zh/docs/intro/installation#install-anchor-cli">https://solana.com/zh/docs/intro/installation#install-anchor-cli</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/06/Rust-lesson-25/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/06/Rust-lesson-25/" itemprop="url">Rust lesson 25 - 并发</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-06T16:27:30+08:00">
                2024-11-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>并发、并行、进程、线程的概念以及多线程可能导致的问题，这里暂不赘述，请自行查找。</p>
<p>可能会用到的库:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> core::hash;</span><br><span class="line"><span class="keyword">use</span> std::&#123;thread, vec&#125;;</span><br><span class="line"><span class="keyword">use</span> std::time::Duration;</span><br><span class="line"><span class="keyword">use</span> std::sync::&#123;mpsc, Arc&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> serde::de::value;</span><br><span class="line"><span class="keyword">use</span> std::sync::Mutex;</span><br></pre></td></tr></table></figure>

<h1 id="创建线程"><a href="#创建线程" class="headerlink" title="创建线程"></a>创建线程</h1><p>通过<code>thread::spawn</code>函数可以创建新线程。参数是一个闭包，返回值类型是<code>JoinHandle</code>。<br><code>JoinHandle</code>持有值的所有权，调用其join方法，可以等待其他线程完成。</p>
<h2 id="代码示例："><a href="#代码示例：" class="headerlink" title="代码示例："></a>代码示例：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">thread_study</span>() &#123;</span><br><span class="line"> <span class="comment">//可惜主线程打完4后就退出了，主线程退出，子线程没执行完也跟着退出,所以需要下面的handler</span></span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(|| &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..<span class="number">10</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;hi number &#123;&#125; from the spawned thread!&quot;</span>, i);</span><br><span class="line">            thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;); </span><br><span class="line"></span><br><span class="line">	 <span class="comment">//所以要用handle</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">handler</span> = thread::<span class="title function_ invoke__">spawn</span>(|| &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..<span class="number">10</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;hi number &#123;&#125; from the spawned thread!&quot;</span>, i);</span><br><span class="line">            thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;); </span><br><span class="line">    </span><br><span class="line">     <span class="comment">//主线程</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..<span class="number">5</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;hi number &#123;&#125; from the main thread!&quot;</span>, i);</span><br><span class="line">        thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">1</span>));</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">//有handler,主线程就会等待子线程退出后再退出</span></span><br><span class="line">    <span class="comment">//放最后，总执行时间为最长线程的执行时间</span></span><br><span class="line">    handler.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="使用move闭包："><a href="#使用move闭包：" class="headerlink" title="使用move闭包："></a>使用move闭包：</h1><p><code>move</code>闭包通常和<code>thread::spawn</code>函数一起使用，它允许你使用其它线程的数据。<br>创建线程时，把值的所有权从一个线程转移到另一个线程。</p>
<h2 id="代码示例：-1"><a href="#代码示例：-1" class="headerlink" title="代码示例："></a>代码示例：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">thread_study</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="comment">//move || &#123; ... &#125; 是一个闭包（closure），move会使v 的所有权会被移动到新线程中</span></span><br><span class="line">    <span class="comment">//如果不使用 move，闭包只会借用 v，而在多线程环境下，这会导致编译错误，因为编译器无法保证 v 的生命周期足够长，以确保在新线程中安全使用。</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Here&#x27;s a vector: &#123;:?&#125;&quot;</span>, v);</span><br><span class="line">    &#125;); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="多线程通信："><a href="#多线程通信：" class="headerlink" title="多线程通信："></a>多线程通信：</h1><h2 id="消息传递-Channel"><a href="#消息传递-Channel" class="headerlink" title="消息传递 Channel:"></a>消息传递 <code>Channel</code>:</h2><p>线程通过彼此发送消息来进行通信。</p>
<ol>
<li><code>Channel</code> 包含发送端、接收端。</li>
<li>调用发送端的方法，发送数据。</li>
<li>接收端会检查和接收到达的数据</li>
<li>如果发送端、接收端中任意一端被丢弃了，那么频道就关闭了。</li>
</ol>
<h3 id="创建Channel："><a href="#创建Channel：" class="headerlink" title="创建Channel："></a>创建<code>Channel</code>：</h3><ol>
<li>使用<code>mpsc::channel</code>函数来创建（mpsc就是 multiple producer, single consumer,多个生产者，一个消费者）。返回一个tuple（元祖），里面元素分别是发送端和接收端。</li>
<li>使用<code>mpsc::sync_channel</code>来创建带缓冲区的channel，入参为缓冲区大小，当缓冲区塞满时进行阻塞。</li>
</ol>
<h4 id="代码示例：-2"><a href="#代码示例：-2" class="headerlink" title="代码示例："></a>代码示例：</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">thread_study</span>() &#123;</span><br><span class="line"><span class="keyword">let</span> (tx , rx) = mpsc::<span class="title function_ invoke__">channel</span>();</span><br><span class="line">    <span class="comment">//当有多个输入，就要用clone，因为tx的所有权只有一个</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tx1</span> = mpsc::Sender::<span class="title function_ invoke__">clone</span>(&amp;tx);</span><br><span class="line"></span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">vals</span> = <span class="built_in">vec!</span>[</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hi&quot;</span>),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;from&quot;</span>),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;the&quot;</span>),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;thread&quot;</span>)</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">val</span> <span class="keyword">in</span> vals &#123;</span><br><span class="line">            tx.<span class="title function_ invoke__">send</span>(val).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">vals</span> = <span class="built_in">vec!</span>[</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hi&quot;</span>),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;from&quot;</span>),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;the&quot;</span>),</span><br><span class="line">            <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;thread&quot;</span>)</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">val</span> <span class="keyword">in</span> vals &#123;</span><br><span class="line">            <span class="comment">//注意这里用了tx1</span></span><br><span class="line">            tx1.<span class="title function_ invoke__">send</span>(val).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">received</span> <span class="keyword">in</span> rx &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Got: &#123;&#125;&quot;</span>, received);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="共享内存："><a href="#共享内存：" class="headerlink" title="共享内存："></a>共享内存：</h2><p>共享内存并发类似多所有权，多个线程可以同时访问同一块内存。（Channel就不行）</p>
<h3 id="Mutex："><a href="#Mutex：" class="headerlink" title="Mutex："></a>Mutex：</h3><p>使用<code>Mutex</code>来每次只允许一个线程来访问数据。想要访问数据，线程必须先获取互斥锁（lock), lock数据结构是mutex 的一部分，它能跟踪谁对数据拥有独占访问权。</p>
<p><strong>Mutex的两条规则</strong>：</p>
<ol>
<li>在使用数据之前，必须先尝试获取锁。</li>
<li>使用完mutex所保护的数据，必须对数据进行解锁。</li>
</ol>
<h4 id="使用："><a href="#使用：" class="headerlink" title="使用："></a>使用：</h4><ol>
<li>通过<code>Mutex::new</code>来创建<code>Mutex&lt;T&gt;</code>，<code>Mutex&lt;T&gt;</code>是个智能指针</li>
<li>访问数据前，通过lock方法来获取锁</li>
</ol>
<h5 id="代码示例：-3"><a href="#代码示例：-3" class="headerlink" title="代码示例："></a>代码示例：</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">share_memory</span>()&#123;</span><br><span class="line"> <span class="comment">//Mutex::new(5) 创建一个新的互斥锁</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">m</span> = Mutex::<span class="title function_ invoke__">new</span>(<span class="number">5</span>);</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//m.lock().unwrap() 获取互斥锁的锁定，并返回一个 MutexGuard。MutexGuard 是一个智能指针，实现了 Deref 和 Drop，可以用来访问和修改锁定的数据。</span></span><br><span class="line">        <span class="comment">//离开作用域还会自动解锁</span></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span> = m.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        *num = <span class="number">6</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;m = &#123;:?&#125;&quot;</span>, m) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用Arc来进行原子引用计数："><a href="#使用Arc来进行原子引用计数：" class="headerlink" title="使用Arc&lt;T&gt;来进行原子引用计数："></a>使用<code>Arc&lt;T&gt;</code>来进行原子引用计数：</h4><p>就是用来代替<code>RC&lt;T&gt;</code>的，具体看代码示例：</p>
<h5 id="代码示例：-4"><a href="#代码示例：-4" class="headerlink" title="代码示例："></a>代码示例：</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">share_memory</span>() &#123;</span><br><span class="line"><span class="comment">//Arc::new(Mutex::new(0)) 创建一个新的 Arc，其中包含一个 Mutex，初始值为 0</span></span><br><span class="line">    <span class="comment">//Arc 允许多个线程共享同一个 Mutex，而 Mutex 确保对共享数据的访问是线程安全的。</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">counter</span> = Arc::<span class="title function_ invoke__">new</span>(Mutex::<span class="title function_ invoke__">new</span>(<span class="number">0</span>));</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">handles</span> = <span class="built_in">vec!</span>[];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//循环创建 10 个线程</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">_</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">10</span> &#123;</span><br><span class="line">        <span class="comment">//RC只用于单线程场景，多线程要用Arc</span></span><br><span class="line">        <span class="comment">//使用 Arc::clone 克隆 counter，确保每个线程都有自己的 Arc 引用，指向同一个 Mutex</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">thread_counter</span> = Arc::<span class="title function_ invoke__">clone</span>(&amp;counter);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span> = thread_counter.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            *num += <span class="number">1</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        handles.<span class="title function_ invoke__">push</span>(handle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//for handle in handles 遍历所有线程句柄。</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">handle</span> <span class="keyword">in</span> handles &#123;</span><br><span class="line">        handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Result: &#123;&#125;&quot;</span>,*counter.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/05/Rust-lesson-24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/05/Rust-lesson-24/" itemprop="url">Rust lesson 24 - 测试（Test）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-05T21:32:13+08:00">
                2024-11-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="单元测试（Unit-Testing）"><a href="#单元测试（Unit-Testing）" class="headerlink" title="单元测试（Unit Testing）:"></a>单元测试（Unit Testing）:</h1><p>单元测试（Unit Testing）是一种软件测试方法，旨在验证代码中最小可测试单元（通常是函数或方法）的正确性。</p>
<p>单元测试通常是自动化的，可以通过测试框架（如 Rust 的 cargo test）来运行。</p>
<h2 id="简单示例："><a href="#简单示例：" class="headerlink" title="简单示例："></a>简单示例：</h2><p>在 Rust 中，单元测试是通过 <code>#[cfg(test)]</code> 属性和 <code>#[test]</code> 属性来实现的。<code>#[cfg(test)]</code> 属性用于标记测试模块，而 <code>#[test]</code> 属性用于标记测试函数。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/lib.rs 或 src/main.rs</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个简单的函数</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试模块</span></span><br><span class="line"><span class="comment">//属性标记了这个模块只在测试配置中编译。</span></span><br><span class="line"><span class="comment">//定义了一个名为 `tests` 的模块，用于存放测试函数。</span></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="comment">// 引入要测试的函数</span></span><br><span class="line">    <span class="keyword">use</span> super::add;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个测试函数</span></span><br><span class="line">    <span class="comment">//- `#[test]` 属性标记了 `test_add` 函数是一个测试函数。</span></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_add</span>() &#123;</span><br><span class="line">        <span class="comment">// 断言</span></span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">add</span>(<span class="number">1</span>, <span class="number">2</span>), <span class="number">3</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">add</span>(-<span class="number">1</span>, <span class="number">1</span>), <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">add</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="运行测试"><a href="#运行测试" class="headerlink" title="运行测试"></a>运行测试</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<h2 id="其他一些常用属性："><a href="#其他一些常用属性：" class="headerlink" title="其他一些常用属性："></a>其他一些常用属性：</h2><ul>
<li>**<code>#[ignore]</code>**：用于标记测试函数，使其在默认情况下不被运行。</li>
<li>**<code>#[should_panic]</code>**：用于标记测试函数应该在某种条件下引发恐慌。</li>
<li>**<code>#[bench]</code>**：用于标记基准测试函数，用于测量代码的性能。</li>
</ul>
<h3 id="使用示例："><a href="#使用示例：" class="headerlink" title="使用示例："></a>使用示例：</h3><h4 id="ignore"><a href="#ignore" class="headerlink" title="[ignore]:"></a><code>[ignore]</code>:</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::add;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_add</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">add</span>(<span class="number">1</span>, <span class="number">2</span>), <span class="number">3</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">add</span>(-<span class="number">1</span>, <span class="number">1</span>), <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">add</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="meta">#[ignore]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_add_large_numbers</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">add</span>(<span class="number">1_000_000</span>, <span class="number">2_000_000</span>), <span class="number">3_000_000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="meta">#[ignore]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_add_performance</span>() &#123;</span><br><span class="line">        <span class="comment">// 这是一个非常耗时的测试</span></span><br><span class="line">        <span class="keyword">for</span> <span class="variable">_</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">1_000_000</span> &#123;</span><br><span class="line">            <span class="built_in">assert_eq!</span>(<span class="title function_ invoke__">add</span>(<span class="number">1</span>, <span class="number">2</span>), <span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="运行忽略的测试："><a href="#运行忽略的测试：" class="headerlink" title="运行忽略的测试："></a>运行忽略的测试：</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo <span class="built_in">test</span> -- --ignored</span><br></pre></td></tr></table></figure>

<h4 id="should-panic"><a href="#should-panic" class="headerlink" title="[should_panic]:"></a><code>[should_panic]</code>:</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="meta">#[should_panic(expected = <span class="string">&quot;some error message&quot;</span>)]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">test_divide_by_zero</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="number">1</span> / <span class="number">0</span>; <span class="comment">// 这将引发 panic</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="bench"><a href="#bench" class="headerlink" title="[bench]:"></a><code>[bench]</code>:</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[bench]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">bench_add</span>(b: &amp;<span class="keyword">mut</span> test::Bencher) &#123;</span><br><span class="line">    b.<span class="title function_ invoke__">iter</span>(|| <span class="title function_ invoke__">add</span>(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="集成测试（Integration-Testing）："><a href="#集成测试（Integration-Testing）：" class="headerlink" title="集成测试（Integration Testing）："></a>集成测试（Integration Testing）：</h1><p>集成测试（Integration Testing）是一种软件测试方法，旨在验证多个组件或模块协同工作的正确性。与单元测试不同，集成测试关注的是组件之间的交互和接口，确保它们能够正确地协同工作，形成一个完整的系统或子系统。</p>
<p>在 Rust 中，集成测试通常放在 <code>tests</code> 目录下，目录结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my_project/</span><br><span class="line">├── src/</span><br><span class="line">│   ├── lib.rs</span><br><span class="line">│   └── main.rs</span><br><span class="line">└── tests/</span><br><span class="line">    └── integration_test.rs</span><br></pre></td></tr></table></figure>

<h2 id="示例代码："><a href="#示例代码：" class="headerlink" title="示例代码："></a>示例代码：</h2><ol>
<li><p><strong>项目结构</strong>：</p>
<ul>
<li><code>src/lib.rs</code>：定义了一个模块 <code>math</code>，其中包含两个函数 <code>add</code> 和 <code>multiply</code>。</li>
<li><code>src/main.rs</code>：主程序文件，使用 <code>math</code> 模块中的函数进行计算。</li>
<li><code>tests/integration_test.rs</code>：集成测试文件，测试 <code>add</code> 和 <code>multiply</code> 函数的组合使用。</li>
</ul>
</li>
</ol>
<p><code>src/lib.rs</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> math &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        a + b</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">multiply</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        a * b</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><code>src/main.rs</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> math;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">sum</span> = math::<span class="title function_ invoke__">add</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">product</span> = math::<span class="title function_ invoke__">multiply</span>(sum, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Result: &#123;&#125;&quot;</span>, product); <span class="comment">// 输出 &quot;Result: 9&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <code>tests/integration_test.rs</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> my_project::math;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">test_add_and_multiply</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">sum</span> = math::<span class="title function_ invoke__">add</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">product</span> = math::<span class="title function_ invoke__">multiply</span>(sum, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(product, <span class="number">9</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="运行集成测试："><a href="#运行集成测试：" class="headerlink" title="运行集成测试："></a>运行集成测试：</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<h1 id="common-mod-rs"><a href="#common-mod-rs" class="headerlink" title="common&#x2F;mod.rs"></a>common&#x2F;mod.rs</h1><p><code>common/mod.rs</code> 文件用于定义 <code>common</code> 模块，并可以选择性地引入子模块中的内容。</p>
<p>目录结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">my_project/</span><br><span class="line">├── src/</span><br><span class="line">│   ├── common/</span><br><span class="line">│   │   ├── mod.rs</span><br><span class="line">│   │   ├── utils.rs</span><br><span class="line">│   │   └── error.rs</span><br><span class="line">│   ├── main.rs</span><br><span class="line">│   └── lib.rs</span><br><span class="line">└── Cargo.toml</span><br></pre></td></tr></table></figure>

<h2 id="代码示例："><a href="#代码示例：" class="headerlink" title="代码示例："></a>代码示例：</h2><p><code>common/mod.rs:</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入子模块</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> utils;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> error;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重新导出子模块的内容</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> self::utils::greet;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> self::error::MyError;</span><br></pre></td></tr></table></figure>

<p><code>common/utils.rs</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">greet</span>(name: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    <span class="built_in">format!</span>(<span class="string">&quot;Hello, &#123;&#125;!&quot;</span>, name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>common/error.rs</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">MyError</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> message: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">MyError</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(message: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        MyError &#123;</span><br><span class="line">            message: message.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><code>src/main.rs</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mod</span> common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// 使用 common 模块中的函数</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">greeting</span> = common::<span class="title function_ invoke__">greet</span>(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, greeting);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 common 模块中的结构体</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">error</span> = common::MyError::<span class="title function_ invoke__">new</span>(<span class="string">&quot;Something went wrong&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="文档测试（doc-tests）："><a href="#文档测试（doc-tests）：" class="headerlink" title="文档测试（doc tests）："></a>文档测试（doc tests）：</h1><p>文档测试（Doc Tests）是 Rust 中一种特殊的测试形式，它允许你在文档注释中编写测试代码。</p>
<h2 id="代码示例：-1"><a href="#代码示例：-1" class="headerlink" title="代码示例："></a>代码示例：</h2><p><code>src/lib.rs</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// Adds two integers and returns the result.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// # Examples</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// ```</span></span><br><span class="line"><span class="comment">/// use my_library::add;</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// assert_eq!(add(1, 2), 3);</span></span><br><span class="line"><span class="comment">/// assert_eq!(add(-1, 1), 0);</span></span><br><span class="line"><span class="comment">/// assert_eq!(add(0, 0), 0);</span></span><br><span class="line"><span class="comment">/// ```</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>/// Adds two integers and returns the result.</code>：这是函数的简短描述。</li>
<li><code>/// # Examples</code>：这是示例部分的标题。</li>
<li>&#96;&#x2F;&#x2F;&#x2F; &#96;&#96;&#96;&#96;：开始一个代码块。</li>
<li><code>/// use my_library::add;</code>：导入 <code>add</code> 函数。</li>
<li><code>/// assert_eq!(add(1, 2), 3);</code>：断言 <code>add(1, 2)</code> 的结果应该是 <code>3</code>。</li>
<li><code>/// assert_eq!(add(-1, 1), 0);</code>：断言 <code>add(-1, 1)</code> 的结果应该是 <code>0</code>。</li>
<li><code>/// assert_eq!(add(0, 0), 0);</code>：断言 <code>add(0, 0)</code> 的结果应该是 <code>0</code>。</li>
<li>&#96;&#x2F;&#x2F;&#x2F; &#96;&#96;&#96;&#96;：结束一个代码块。</li>
</ul>
<p><strong>运行测试</strong>：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<h1 id="基准测试（Benchmarking"><a href="#基准测试（Benchmarking" class="headerlink" title="基准测试（Benchmarking):"></a>基准测试（Benchmarking):</h1><p>基准测试（Benchmarking）是一种用于测量代码性能的技术。</p>
<p>目录结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">my_project/</span><br><span class="line">├── src/</span><br><span class="line">│   ├── lib.rs</span><br><span class="line">│   └── main.rs</span><br><span class="line">├── benches/</span><br><span class="line">│   └── add_bench.rs</span><br><span class="line">└── Cargo.toml</span><br></pre></td></tr></table></figure>

<h2 id="示例代码：-1"><a href="#示例代码：-1" class="headerlink" title="示例代码："></a>示例代码：</h2><p> <code>src/lib.rs</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>benches/add_bench.rs</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> criterion::&#123;criterion_group, criterion_main, Criterion&#125;;</span><br><span class="line"><span class="keyword">use</span> my_project::add;</span><br><span class="line"></span><br><span class="line"><span class="comment">// `fn bench_add(c: &amp;mut Criterion) &#123; ... &#125;`：定义一个基准测试函数 `bench_add`，接受一个 `Criterion` 类型的参数。</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">bench_add</span>(c: &amp;<span class="keyword">mut</span> Criterion) &#123;</span><br><span class="line">	<span class="comment">// `c.bench_function(&quot;add&quot;, |b| b.iter(|| add(1, 2)));`：使用 `c.bench_function` 方法注册一个基准测试，名称为 `&quot;add&quot;`，测试函数为 `|| add(1, 2)`。</span></span><br><span class="line">	c.<span class="title function_ invoke__">bench_function</span>(<span class="string">&quot;add&quot;</span>, |b| b.<span class="title function_ invoke__">iter</span>(|| <span class="title function_ invoke__">add</span>(<span class="number">1</span>, <span class="number">2</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// `criterion_group!(benches, bench_add);`：定义一个基准测试组 `benches`，包含 `bench_add` 测试。</span></span><br><span class="line">criterion_group!(benches, bench_add);</span><br><span class="line"><span class="comment">//`criterion_main!(benches);`：定义主函数，运行 `benches` 组中的所有基准测试。</span></span><br><span class="line">criterion_main!(benches);</span><br></pre></td></tr></table></figure>

<p><strong>运行测试</strong>：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo bench</span><br></pre></td></tr></table></figure>

<p><strong>生成详细报告</strong>：<br><code>criterion</code> 库会生成详细的性能报告，包括图表和统计数据。这些报告通常保存在 <code>target/criterion</code> 目录下，你可以使用浏览器打开这些报告文件进行查看。</p>
<p><strong>安装 criterion 库</strong>：<br><code>cargo.toml</code>文件里添加下面内容：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dev-dependencies]</span></span><br><span class="line"><span class="attr">criterion</span> = <span class="string">&quot;0.4&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="示例-Examples"><a href="#示例-Examples" class="headerlink" title="示例(Examples):"></a>示例(Examples):</h1><p><code>examples</code> 目录通常用于存放示例代码文件。</p>
<p>目录结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">my_project/</span><br><span class="line">├── src/</span><br><span class="line">│   ├── lib.rs</span><br><span class="line">│   └── main.rs</span><br><span class="line">├── examples/</span><br><span class="line">│   ├── example1.rs</span><br><span class="line">│   └── example2.rs</span><br><span class="line">├── benches/</span><br><span class="line">│   └── add_bench.rs</span><br><span class="line">└── Cargo.toml</span><br></pre></td></tr></table></figure>

<h2 id="示例代码：-2"><a href="#示例代码：-2" class="headerlink" title="示例代码："></a>示例代码：</h2><p><code>src/lib.rs</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>examples/example1.rs</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> my_project;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> my_project::add;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">add</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;1 + 2 = &#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>examples/example2.rs</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> my_project;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> my_project::add;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">add</span>(a, b);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; + &#123;&#125; = &#123;&#125;&quot;</span>, a, b, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>编译和运行example1</strong>：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo run --example example1</span><br></pre></td></tr></table></figure>

<p><strong>编译和运行example2</strong>：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo run --example example2</span><br></pre></td></tr></table></figure>

<h1 id="目录结构规范："><a href="#目录结构规范：" class="headerlink" title="目录结构规范："></a>目录结构规范：</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">my_project/</span><br><span class="line">├── Cargo.lock</span><br><span class="line">├── Cargo.toml</span><br><span class="line">├── src/</span><br><span class="line">│   ├── lib.rs</span><br><span class="line">│   ├── main.rs</span><br><span class="line">│   └── bin/</span><br><span class="line">│       ├── named-executable.rs</span><br><span class="line">│       ├── another-executable.rs</span><br><span class="line">│       └── multi-file-executable/</span><br><span class="line">│           ├── main.rs</span><br><span class="line">│           └── some_module.rs</span><br><span class="line">├── benches/</span><br><span class="line">│   ├── large-input.rs</span><br><span class="line">│   └── multi-file-bench/</span><br><span class="line">│       ├── main.rs</span><br><span class="line">│       └── bench_module.rs</span><br><span class="line">├── examples/</span><br><span class="line">│   ├── simple.rs</span><br><span class="line">│   └── multi-file-example/</span><br><span class="line">│       ├── main.rs</span><br><span class="line">│       └── ex_module.rs</span><br><span class="line">└── tests/</span><br><span class="line">    ├── some-integration-tests.rs</span><br><span class="line">    └── multi-file-test/</span><br><span class="line">        ├── main.rs</span><br><span class="line">        └── test_module.rs</span><br></pre></td></tr></table></figure>

<h3 id="目录和文件说明"><a href="#目录和文件说明" class="headerlink" title="目录和文件说明"></a>目录和文件说明</h3><ol>
<li><p>**<code>Cargo.lock</code>**：记录项目依赖的具体版本信息，确保项目在不同环境中使用相同的依赖版本。</p>
</li>
<li><p>**<code>Cargo.toml</code>**：项目的配置文件，包含项目元数据、依赖项等信息。</p>
</li>
<li><p>**<code>src/</code>**：源代码目录，包含项目的主代码。</p>
<ul>
<li>**<code>lib.rs</code>**：库的入口文件。如果项目是一个库，<code>lib.rs</code> 是主要的模块文件。</li>
<li>**<code>main.rs</code>**：应用程序的入口文件。如果项目是一个可执行程序，<code>main.rs</code> 是主函数所在文件。</li>
<li>**<code>bin/</code>**：多可执行文件目录，包含多个独立的可执行文件。<ul>
<li>**<code>named-executable.rs</code>**：命名的可执行文件1。</li>
<li>**<code>another-executable.rs</code>**：命名的可执行文件2。</li>
<li>**<code>multi-file-executable/</code>**：多文件可执行文件目录。<ul>
<li>**<code>main.rs</code>**：主文件。</li>
<li>**<code>some_module.rs</code>**：模块文件。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>**<code>benches/</code>**：基准测试目录，包含基准测试文件。</p>
<ul>
<li>**<code>large-input.rs</code>**：基准测试文件1。</li>
<li>**<code>multi-file-bench/</code>**：多文件基准测试目录。<ul>
<li>**<code>main.rs</code>**：主文件。</li>
<li>**<code>bench_module.rs</code>**：模块文件。</li>
</ul>
</li>
</ul>
</li>
<li><p>**<code>examples/</code>**：示例代码目录，包含展示如何使用库的示例文件。</p>
<ul>
<li>**<code>simple.rs</code>**：示例文件1。</li>
<li>**<code>multi-file-example/</code>**：多文件示例目录。<ul>
<li>**<code>main.rs</code>**：主文件。</li>
<li>**<code>ex_module.rs</code>**：模块文件。</li>
</ul>
</li>
</ul>
</li>
<li><p>**<code>tests/</code>**：集成测试目录，包含集成测试文件。</p>
<ul>
<li>**<code>some-integration-tests.rs</code>**：集成测试文件1。</li>
<li>**<code>multi-file-test/</code>**：多文件集成测试目录。<ul>
<li>**<code>main.rs</code>**：主文件。</li>
<li>**<code>test_module.rs</code>**：模块文件。</li>
</ul>
</li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/03/Rust-lesson-23/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/03/Rust-lesson-23/" itemprop="url">Rust lesson 23 - 迭代器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-03T21:47:59+08:00">
                2024-11-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="What-is-迭代器："><a href="#What-is-迭代器：" class="headerlink" title="What is 迭代器："></a>What is 迭代器：</h1><p>迭代器（iterator）是一种用于遍历集合（如数组、向量、链表等）的抽象机制。</p>
<h2 id="Iterator-Trait-定义："><a href="#Iterator-Trait-定义：" class="headerlink" title="Iterator Trait 定义："></a>Iterator Trait 定义：</h2><p><code>Iterator</code> trait 是 Rust 标准库中定义的一个重要 trait，它有两个主要部分：</p>
<ol>
<li>**关联类型 <code>type Item</code>**：表示迭代器产生的项的类型。</li>
<li>**方法 <code>fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt;</code>**：返回集合中的下一个元素。如果集合中没有更多元素，则返回 <code>None</code>。</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Iterator</span> &#123; </span><br><span class="line">	<span class="keyword">type</span> <span class="title class_">Item</span>; <span class="comment">// 关联类型，表示迭代器产生的项的类型 </span></span><br><span class="line">	<span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt;; <span class="comment">// 返回下一个元素，如果集合中没有更多元素则返回 None </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="简单的迭代器"><a href="#简单的迭代器" class="headerlink" title="简单的迭代器"></a>简单的迭代器</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">study</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number</span> = <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">iter</span> = number.<span class="title function_ invoke__">iter</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//iter.next()返回迭代器的下一个元素，如果没有，则返回None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(num) = iter.<span class="title function_ invoke__">next</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, num);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建迭代器的几个方法："><a href="#创建迭代器的几个方法：" class="headerlink" title="创建迭代器的几个方法："></a>创建迭代器的几个方法：</h2><ol>
<li>iter方法：在不可变引用上创建迭代器。</li>
<li>into_iter犯法：创建的迭代器会获得所有权。</li>
<li>iter_mut方法：迭代可变的引用。</li>
</ol>
<h2 id="常见迭代器方法："><a href="#常见迭代器方法：" class="headerlink" title="常见迭代器方法："></a>常见迭代器方法：</h2><h3 id="map："><a href="#map：" class="headerlink" title="map："></a>map：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vec&lt;_&gt;,下划线自动推断类型</span></span><br><span class="line"><span class="comment">//collect() 方法将迭代器中的所有元素收集到一个新的集合中</span></span><br><span class="line"><span class="comment">//由于 map 生成的是 i32 类型的值，collect() 会将这些值收集到一个 Vec&lt;i32&gt; 中。</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">squares</span> : <span class="type">Vec</span>&lt;_&gt; = number.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">map</span>(|x| x * x).<span class="title function_ invoke__">collect</span>();</span><br></pre></td></tr></table></figure>

<h3 id="filter："><a href="#filter：" class="headerlink" title="filter："></a>filter：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//filter()</span></span><br><span class="line">    <span class="comment">//对迭代器中的每个元素应用闭包，过滤出满足条件的元素（即偶数）。</span></span><br><span class="line">    <span class="comment">//用这种方法能提高代码可读性，不用单独写很长很长的代码</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">even_numbers</span> : <span class="type">Vec</span>&lt;_&gt; = number.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">filter</span>(|&amp;x| x % <span class="number">2</span> == <span class="number">0</span>).<span class="title function_ invoke__">collect</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;squares: &#123;:?&#125;&quot;</span>, even_numbers);</span><br></pre></td></tr></table></figure>


<h2 id="自定义迭代器："><a href="#自定义迭代器：" class="headerlink" title="自定义迭代器："></a>自定义迭代器：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//自定义迭代器</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    count: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> Counter &#123;</span><br><span class="line">        Counter &#123; count: <span class="number">0</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Iterator</span> <span class="keyword">for</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span> = <span class="type">u32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span>.count += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.count &lt;= <span class="number">5</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(<span class="keyword">self</span>.count)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">None</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">counter</span> = Counter::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(value) = counter.<span class="title function_ invoke__">next</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/03/Rust-lesson-22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/03/Rust-lesson-22/" itemprop="url">Rust lesson 22 - 闭包</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-03T20:42:54+08:00">
                2024-11-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="What-is-闭包："><a href="#What-is-闭包：" class="headerlink" title="What is 闭包："></a>What is 闭包：</h1><p>闭包（closures）是一种匿名函数，可以捕获其定义环境中的变量。匿名函数（anonymous functions）是没有名字的函数。它们通常在需要临时使用的场合下定义和使用，而不是像普通函数那样有一个固定的名称。</p>
<h2 id="闭包基本语法："><a href="#闭包基本语法：" class="headerlink" title="闭包基本语法："></a>闭包基本语法：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个函数就没有名字，就只有内容，然后可以返回值给某个变量</span></span><br><span class="line">|参数<span class="number">1</span>, 参数<span class="number">2</span>, ..., 参数N| <span class="punctuation">-&gt;</span> 返回类型 &#123; </span><br><span class="line">    <span class="comment">// 闭包体</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">add_x</span> = |y: <span class="type">i32</span>| <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123; x + y &#125;; <span class="comment">//这里就捕获了环境中的变量x</span></span><br><span class="line">    <span class="comment">//let add_x = |y| x + y;  省略写法，编译器会自己推断类型</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">add_x</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Result: &#123;&#125;&quot;</span>, result); <span class="comment">// 输出 &quot;Result: 8&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="闭包的特点："><a href="#闭包的特点：" class="headerlink" title="闭包的特点："></a>闭包的特点：</h2><ol>
<li>匿名性：闭包没有名称，通常被赋值给变量或作为参数传递。</li>
<li>捕获环境：闭包可以捕获其定义环境中的变量。</li>
<li>类型推断：Rust 编译器可以自动推断闭包的参数类型和返回类型。</li>
<li>灵活的捕获模式：闭包可以通过三种不同的方式捕获环境中的变量：move、copy 和 borrow。</li>
</ol>
<h1 id="闭包的使用："><a href="#闭包的使用：" class="headerlink" title="闭包的使用："></a>闭包的使用：</h1><h2 id="作为函数参数："><a href="#作为函数参数：" class="headerlink" title="作为函数参数："></a>作为函数参数：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接受一个泛型参数 `F`</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">apply_to_3</span>&lt;F&gt;(f: F) <span class="punctuation">-&gt;</span> <span class="type">i32</span> </span><br><span class="line"><span class="comment">//要求 `F` 实现 `Fn(i32) -&gt; i32`,即 `F` 必须是一个接受一个 `i32` 参数并返回一个 `i32` 的函数或闭包。</span></span><br><span class="line"><span class="keyword">where</span> F : <span class="title function_ invoke__">Fn</span>(<span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line"><span class="comment">//调用传入的函数或闭包 f，并将 3 作为参数传递给它</span></span><br><span class="line">	<span class="title function_ invoke__">f</span>(<span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">double</span> = |x| x * <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,<span class="title function_ invoke__">apply_to_3</span>(double));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出6</span></span><br></pre></td></tr></table></figure>

<h2 id="捕获环境变量"><a href="#捕获环境变量" class="headerlink" title="捕获环境变量"></a>捕获环境变量</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">closure</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">4</span>;</span><br><span class="line">    <span class="comment">//x 在equal_to_x作用域外 依然被捕获</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">equal_to_x</span> = |z | z==x;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="number">4</span>;</span><br><span class="line">    <span class="built_in">assert!</span>(<span class="title function_ invoke__">equal_to_x</span>(y));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="title function_ invoke__">closure</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="闭包三种捕获方式："><a href="#闭包三种捕获方式：" class="headerlink" title="闭包三种捕获方式："></a>闭包三种捕获方式：</h1><h2 id="引用捕获："><a href="#引用捕获：" class="headerlink" title="引用捕获："></a>引用捕获：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">closure</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">4</span>;</span><br><span class="line">    <span class="comment">//x 在equal_to_x作用域外 依然被捕获</span></span><br><span class="line">    <span class="comment">//闭包 equal_to_x 内部保存了对 x 的引用，而不是复制 x 的值。</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">equal_to_x</span> = |z | z==x;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="number">4</span>;</span><br><span class="line">    <span class="built_in">assert!</span>(<span class="title function_ invoke__">equal_to_x</span>(y));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="按可变引用捕获："><a href="#按可变引用捕获：" class="headerlink" title="按可变引用捕获："></a>按可变引用捕获：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">closure</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span> =<span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">change_num</span> = |x | num += x;</span><br><span class="line">    <span class="title function_ invoke__">change_num</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;num: &#123;&#125;&quot;</span>, num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="移动（Move）捕获："><a href="#移动（Move）捕获：" class="headerlink" title="移动（Move）捕获："></a>移动（Move）捕获：</h2><p>就是所有权移动了</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">print_s</span> = <span class="keyword">move</span> || <span class="built_in">println!</span>(<span class="string">&quot;s is: &#123;&#125;&quot;</span>, s);</span><br><span class="line">    <span class="title function_ invoke__">print_s</span>(); <span class="comment">// 输出 &quot;s is: hello&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下面这行代码会报错，因为 s 的所有权已经被移动到闭包中</span></span><br><span class="line">    <span class="comment">// println!(&quot;s is: &#123;&#125;&quot;, s);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="Move-关键字："><a href="#Move-关键字：" class="headerlink" title="Move 关键字："></a>Move 关键字：</h1><p><code>move</code> 关键字用于强制闭包获取其捕获的环境变量的所有权，而不是仅仅借用这些变量。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">closure</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">x</span> = <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">equal_to_x</span> = <span class="keyword">move</span> |z| z==x;</span><br><span class="line">    <span class="comment">//x 没有所有权</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;can&#x27;t use x here: &#123;:?&#125;&quot;</span>, x);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/03/Rust-lesson-21/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/03/Rust-lesson-21/" itemprop="url">Rust lesson 21 - 宏</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-03T17:16:46+08:00">
                2024-11-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="What-is-宏："><a href="#What-is-宏：" class="headerlink" title="What is 宏："></a>What is 宏：</h1><p>宏允许你在编译时生成或修改代码。宏提供了一种灵活的方式来扩展语言的功能，使你可以编写更简洁、更通用的代码。Rust 中的宏分为两种类型：声明式宏（declarative macros）和过程宏（procedural macros）。</p>
<h1 id="声明宏："><a href="#声明宏：" class="headerlink" title="声明宏："></a>声明宏：</h1><p>声明式宏是最常见的宏形式，使用 <code>macro_rules!</code> 定义。它们通过模式匹配来匹配和转换代码片段。声明式宏的主要特点是语法简单，但功能相对有限。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span> () &#123;</span><br><span class="line">    <span class="comment">//宏后面的括号用啥括号都可以，建议()</span></span><br><span class="line">    say_hello!();</span><br><span class="line">    say_hello![<span class="number">1</span>];</span><br><span class="line">    say_hello!&#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">macro_category</span>() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义一个宏,</span></span><br><span class="line"><span class="comment">#[macro_export]</span></span><br><span class="line"><span class="comment">macro_rules! xxx &#123;</span></span><br><span class="line"><span class="comment">    () =&gt; &#123;</span></span><br><span class="line"><span class="comment">        xxx</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">&#125;  */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#[macro_export]</span></span><br><span class="line"><span class="built_in">macro_rules!</span> say_hello &#123;</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//可增加 $x:expr 来匹配表达式</span></span><br><span class="line">    <span class="comment">//可增加多几个`() =&gt; &#123;&#125;` 来匹配多个不同参数</span></span><br><span class="line">    ($x:expr) =&gt; &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, $x);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//fn echo对比宏，只能匹配固定数量参数，现在只能匹配一个</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">echo</span>(a: <span class="type">usize</span>) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="过程宏："><a href="#过程宏：" class="headerlink" title="过程宏："></a>过程宏：</h1><p>过程宏通常用于生成复杂的代码逻辑或实现自定义属性和派生宏。一般很少去写，都是了解常用的，然后熟练运用。</p>
<h2 id="3种类型的过程宏"><a href="#3种类型的过程宏" class="headerlink" title="3种类型的过程宏"></a>3种类型的过程宏</h2><ol>
<li><strong>属性宏（Attribute-like macros）</strong>：用于注解模块、结构体、枚举等。</li>
<li><strong>函数样式的宏（Function-like macros）</strong>：类似于函数调用，但可以生成任意代码。</li>
<li><strong>派生宏（Derive macros）</strong>：用于自动实现某些 trait。</li>
</ol>
<h2 id="属性宏："><a href="#属性宏：" class="headerlink" title="属性宏："></a>属性宏：</h2><h3 id="常用属性宏和用途："><a href="#常用属性宏和用途：" class="headerlink" title="常用属性宏和用途："></a>常用属性宏和用途：</h3><p><strong><code>#[derive]</code></strong>:</p>
<ul>
<li><p><strong>用途</strong>: 自动为结构体或枚举实现特定的 trait。<br><strong><code>#[cfg]</code></strong>:</p>
</li>
<li><p><strong>用途</strong>: 条件编译，根据编译时的条件选择性地包含或排除代码。<br><strong><code>#[test]</code></strong>:</p>
</li>
<li><p><strong>用途</strong>: 标记一个函数为测试函数，可以在运行 <code>cargo test</code> 时执行。<br><strong><code>#[derive(Copy, Clone)]</code></strong>:</p>
</li>
<li><p><strong>用途</strong>: 自动为结构体或枚举实现 <code>Copy</code> 和 <code>Clone</code> trait。</p>
</li>
</ul>
<p><strong><code>#[derive(Serialize, Deserialize)]</code></strong>:</p>
<ul>
<li><strong>用途</strong>: 使用 <code>serde</code> 库自动为结构体或枚举实现序列化和反序列化。</li>
</ul>
<h2 id="函数样式的宏："><a href="#函数样式的宏：" class="headerlink" title="函数样式的宏："></a>函数样式的宏：</h2><h3 id="常用函数样式的宏："><a href="#常用函数样式的宏：" class="headerlink" title="常用函数样式的宏："></a>常用函数样式的宏：</h3><p><strong><code>println!</code></strong>:</p>
<ul>
<li><p><strong>用途</strong>: 打印格式化的字符串到标准输出。<br><strong><code>format!</code></strong>:</p>
</li>
<li><p><strong>用途</strong>: 创建一个格式化的字符串，但不打印，而是返回一个 <code>String</code>。<br><strong><code>vec!</code></strong>:</p>
</li>
<li><p><strong>用途</strong>: 创建一个 <code>Vec</code>。<br><strong><code>stringify!</code></strong>:</p>
</li>
<li><p><strong>用途</strong>: 将表达式转换为字符串字面量。<br><strong><code>assert!</code></strong>:</p>
</li>
<li><p><strong>用途</strong>: 断言一个布尔表达式为真，否则触发 panic。<br><strong><code>assert_eq!</code></strong>:</p>
</li>
<li><p><strong>用途</strong>: 断言两个值相等，否则触发 panic。<br><strong><code>panic!</code></strong>:</p>
</li>
<li><p><strong>用途</strong>: 触发一个 panic。<br><strong><code>env!</code></strong>:</p>
</li>
<li><p><strong>用途</strong>: 获取环境变量的值。</p>
</li>
</ul>
<h2 id="派生宏"><a href="#派生宏" class="headerlink" title="派生宏"></a>派生宏</h2><h3 id="常用派生宏："><a href="#常用派生宏：" class="headerlink" title="常用派生宏："></a>常用派生宏：</h3><p><strong><code>#[derive(Debug)]</code></strong>:</p>
<ul>
<li><strong>用途</strong>: 自动实现 <code>Debug</code> trait，用于格式化输出结构体或枚举的内容。</li>
</ul>
<p><strong><code>#[derive(PartialEq, Eq)]</code></strong>:</p>
<ul>
<li><p><strong>用途</strong>: 自动实现 <code>PartialEq</code> 和 <code>Eq</code> trait，用于比较结构体或枚举的相等性。<br><strong><code>#[derive(PartialOrd, Ord)]</code></strong>:</p>
</li>
<li><p><strong>用途</strong>: 自动实现 <code>PartialOrd</code> 和 <code>Ord</code> trait，用于比较结构体或枚举的顺序。<br><strong><code>#[derive(Copy, Clone)]</code></strong>:</p>
</li>
<li><p><strong>用途</strong>: 自动实现 <code>Copy</code> 和 <code>Clone</code> trait，用于复制结构体或枚举。<br><strong><code>#[derive(Hash)]</code></strong>:</p>
</li>
<li><p><strong>用途</strong>: 自动实现 <code>Hash</code> trait，用于将结构体或枚举哈希化。<br><strong><code>#[derive(Serialize, Deserialize)]</code></strong>:</p>
</li>
<li><p><strong>用途</strong>: 使用 <code>serde</code> 库自动实现序列化和反序列化。</p>
</li>
</ul>
<p><strong><code>#[derive(Default)]</code></strong>:</p>
<ul>
<li><strong>用途</strong>: 自动实现 <code>Default</code> trait，用于提供默认值。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/03/Rust-lesson-20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/03/Rust-lesson-20/" itemprop="url">Rust lesson 20 - 特征（trait）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-03T17:02:55+08:00">
                2024-11-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="What-is-trait："><a href="#What-is-trait：" class="headerlink" title="What is trait："></a>What is <code>trait</code>：</h1><p><code>trait</code> 是一种定义共享行为的方法。它类似于其他编程语言中的接口（interface），但有一些独特的特点。<code>trait</code> 允许你定义一组方法签名，然后可以在具体的类型上实现这些方法。这样，你可以为不同的类型提供相同的行为，从而实现多态性和代码重用。</p>
<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><ol>
<li><p>**定义 <code>trait</code>**：</p>
<ul>
<li>使用 <code>trait</code> 关键字定义一个 <code>trait</code>，并在其中声明方法签名。</li>
<li>这些方法签名定义了该 <code>trait</code> 应该提供的行为。</li>
</ul>
</li>
<li><p>**实现 <code>trait</code>**：</p>
<ul>
<li>使用 <code>impl</code> 关键字为具体的类型实现 <code>trait</code>。</li>
<li>在实现中，你需要提供 <code>trait</code> 中声明的方法的具体实现。</li>
</ul>
</li>
<li><h2 id="使用-trait-：-通过-trait-约束泛型参数，确保泛型参数实现了特定的-trait。-使用-trait-对象（如-Box-或-dyn-Trait）来实现动态分派。"><a href="#使用-trait-：-通过-trait-约束泛型参数，确保泛型参数实现了特定的-trait。-使用-trait-对象（如-Box-或-dyn-Trait）来实现动态分派。" class="headerlink" title="**使用 trait**： - 通过 trait 约束泛型参数，确保泛型参数实现了特定的 trait。 - 使用 trait 对象（如 Box&lt;dyn Trait&gt; 或 &amp;dyn Trait）来实现动态分派。"></a>**使用 <code>trait</code>**：<br><br> - 通过 <code>trait</code> 约束泛型参数，确保泛型参数实现了特定的 <code>trait</code>。<br> - 使用 <code>trait</code> 对象（如 <code>Box&lt;dyn Trait&gt;</code> 或 <code>&amp;dyn Trait</code>）来实现动态分派。</h2></li>
</ol>
<p><strong>基础使用示例</strong>：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">post</span> = Post &#123;</span><br><span class="line">        title: <span class="string">&quot;Rust&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        author: <span class="string">&quot;ou&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        content: <span class="string">&quot;Rust is great&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">weibo</span> = Weibo &#123;</span><br><span class="line">        username: <span class="string">&quot;ou&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        content: <span class="string">&quot;you should learn rust&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,post.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,weibo.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个trait</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span>  <span class="title class_">Post</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> title: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> author: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> content: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//为Post实现trait中的方法</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">Post</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;文章&#123;&#125;: 作者是&#123;&#125;&quot;</span>, <span class="keyword">self</span>.title, <span class="keyword">self</span>.author)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span>  <span class="keyword">struct</span>  <span class="title class_">Weibo</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> username: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> content: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//为Weibo实现trait中的方法</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">Weibo</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125; 发表了微博&#123;&#125;&quot;</span>, <span class="keyword">self</span>.username, <span class="keyword">self</span>.content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="特征定义与实现的位置（孤儿规则）"><a href="#特征定义与实现的位置（孤儿规则）" class="headerlink" title="特征定义与实现的位置（孤儿规则）"></a>特征定义与实现的位置（孤儿规则）</h1><p>孤儿规则的主要目的是防止第三方库之间的冲突，确保每个库都可以独立地定义和实现自己的 trait，而不会相互干扰。</p>
<h3 id="规则的具体内容"><a href="#规则的具体内容" class="headerlink" title="规则的具体内容"></a>规则的具体内容</h3><ol>
<li><strong>本地类型</strong>：如果你正在为一个本地定义的类型实现一个外部 trait，这是允许的。</li>
<li><strong>外部类型和外部 trait</strong>：如果你正在为一个外部类型实现一个外部 trait，这是不允许的，除非你满足孤儿规则。</li>
<li><strong>外部类型和本地 trait</strong>：如果你正在为一个外部类型实现一个本地定义的 trait，这是允许的。</li>
</ol>
<p>代码示例：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Summary和post都在本作用域</span></span><br><span class="line"> <span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">Post</span> &#123;</span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">            <span class="string">&quot;ok&quot;</span>.<span class="title function_ invoke__">to_string</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Post在当前作用域，Display是标准库作用域,这样是可以的</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Display</span> <span class="keyword">for</span> <span class="title class_">Post</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> std::fmt::Formatter&lt;<span class="symbol">&#x27;_</span>&gt;) <span class="punctuation">-&gt;</span> std::fmt::<span class="type">Result</span> &#123;</span><br><span class="line">       <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//impl Display for String &#123;&#125;  这样不行会报错，因为Display和String 没一个在本作用域</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h1 id="默认实现"><a href="#默认实现" class="headerlink" title="默认实现"></a>默认实现</h1><h2 id="1-其他类型无需再实现该方法，也可以选择重载该方法"><a href="#1-其他类型无需再实现该方法，也可以选择重载该方法" class="headerlink" title="1.其他类型无需再实现该方法，也可以选择重载该方法"></a>1.其他类型无需再实现该方法，也可以选择重载该方法</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个trait</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">    <span class="comment">//fn summarize(&amp;self) -&gt; String;</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>&#123;</span><br><span class="line">        <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;default&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//为Post实现trait中的方法</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">Post</span> &#123;</span><br><span class="line">    <span class="comment">//如果把这个fn删掉，那么会调用默认的实现，也就是trait里面那个</span></span><br><span class="line">    <span class="comment">//fn summarize(&amp;self) -&gt; String &#123;</span></span><br><span class="line">    <span class="comment">//    format!(&quot;文章&#123;&#125;: 作者是&#123;&#125;&quot;, self.title, self.author)</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">Weibo</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125; 发表了微博&#123;&#125;&quot;</span>, <span class="keyword">self</span>.username, <span class="keyword">self</span>.content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,post.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,weibo.<span class="title function_ invoke__">summarize</span>());</span><br></pre></td></tr></table></figure>

<h2 id="2-默认实现允许调用相同特征中的其他方法，哪怕这些方法默认没有实现。"><a href="#2-默认实现允许调用相同特征中的其他方法，哪怕这些方法默认没有实现。" class="headerlink" title="2.默认实现允许调用相同特征中的其他方法，哪怕这些方法默认没有实现。"></a>2.默认实现允许调用相同特征中的其他方法，哪怕这些方法默认没有实现。</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">	<span class="keyword">fn</span> <span class="title function_">summarize_author</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">fn</span> <span class="title function_">summarize</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">		<span class="built_in">format!</span>(<span class="string">&quot;Read more from &#123;&#125;...&quot;</span>,<span class="keyword">self</span>.<span class="title function_ invoke__">summarize_author</span>())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Summary</span> <span class="keyword">for</span> <span class="title class_">Weibo</span> &#123;</span><br><span class="line">	<span class="keyword">fn</span> <span class="title function_">summarize_author</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">		<span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,<span class="keyword">self</span>.username)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;1 new weibo: &#123;&#125;&quot;</span>, weibo.<span class="title function_ invoke__">summarize</span>());</span><br></pre></td></tr></table></figure>

<h1 id="带泛型的trait"><a href="#带泛型的trait" class="headerlink" title="带泛型的trait"></a>带泛型的trait</h1><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//泛型trait</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Convert</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">convert</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MyInt</span>(<span class="type">i32</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//impl实现了两次，分别为String和i32</span></span><br><span class="line"><span class="comment">// T转String</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Convert</span>&lt;<span class="type">String</span>&gt; <span class="keyword">for</span> <span class="title class_">MyInt</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">convert</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="number">0</span>.<span class="title function_ invoke__">to_string</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// T转i32</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Convert</span>&lt;<span class="type">i32</span>&gt; <span class="keyword">for</span> <span class="title class_">MyInt</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">convert</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="number">0</span> <span class="keyword">as</span> <span class="type">i32</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这个实现是针对任何实现了 Default trait 的类型 T</span></span><br><span class="line"><span class="keyword">impl</span>&lt;T: <span class="built_in">Default</span>&gt; Convert&lt;T&gt; <span class="keyword">for</span> <span class="title class_">MyInt</span> &#123;</span><br><span class="line">    <span class="comment">//convert 方法返回 T 类型的默认值。T::default() 调用了 Default trait 的 default 方法。</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">convert</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> T &#123;</span><br><span class="line">        T::<span class="title function_ invoke__">default</span>()    </span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">my_int</span> = <span class="title function_ invoke__">MyInt</span>(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//记得显示写String，否则会报错，因为编译器不知道要用哪个类型</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">output</span>: <span class="type">String</span> = my_int.<span class="title function_ invoke__">convert</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,output);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">output</span>: <span class="type">i32</span> = my_int.<span class="title function_ invoke__">convert</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,output); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="关联类型"><a href="#关联类型" class="headerlink" title="关联类型"></a>关联类型</h1><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//关联类型,用这种就是为了限制只能实现某一种类型，不能同时实现两种</span></span><br><span class="line"><span class="comment">// type xxx;</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Convert</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Output</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">convert</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>::Output;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MyInt</span>(<span class="type">i32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Convert</span> <span class="keyword">for</span> <span class="title class_">MyInt</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Output</span> = <span class="type">String</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">convert</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="number">0</span>.<span class="title function_ invoke__">to_string</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// type Output 只能实现一种类型，不能实现两种</span></span><br><span class="line"><span class="comment">// String 和 i32 同时存在会报错</span></span><br><span class="line"><span class="comment">/* impl Convert for MyInt &#123;</span></span><br><span class="line"><span class="comment">    type Output = i32;</span></span><br><span class="line"><span class="comment">    fn convert(&amp;self) -&gt; i32 &#123;</span></span><br><span class="line"><span class="comment">        self.0 as i32</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">&#125; */</span> </span><br></pre></td></tr></table></figure>

<h1 id="自定义类型："><a href="#自定义类型：" class="headerlink" title="自定义类型："></a>自定义类型：</h1><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过这种方式，你可以为自定义类型提供加法操作，并且可以使用泛型函数来处理多种类型的数据。</span></span><br><span class="line"><span class="comment">//T: std::ops::Add&lt;Output = T&gt;,这个约束表示 T 必须实现了 Add trait，并且 Add trait 的 Output 类型必须是 T。</span></span><br><span class="line"><span class="comment">//Output = T 表示加法操作的结果类型必须是 T,接受任何实现了 Add trait 的类型，并返回相同类型的加法结果。</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">add</span>&lt;T: std::ops::Add&lt;Output = T &gt;&gt;(a: T, b: T) <span class="punctuation">-&gt;</span> T &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&#123;</span><br><span class="line">    x: <span class="type">i32</span>,</span><br><span class="line">    y: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Add</span> <span class="keyword">for</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="comment">//指定 Add trait 的 Output 类型为 Point</span></span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Output</span> = Point;</span><br><span class="line">    <span class="comment">//实现 add 方法，接受另一个 Point 对象并返回一个新的 Point 对象</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">add</span>(<span class="keyword">self</span>, other: Point) <span class="punctuation">-&gt;</span> Point &#123;</span><br><span class="line">        <span class="comment">//创建一个新的 Point 对象，其 x 和 y 分别是两个 Point 对象对应字段的和</span></span><br><span class="line">        Point&#123;</span><br><span class="line">            x: <span class="keyword">self</span>.x + other.x,</span><br><span class="line">            y: <span class="keyword">self</span>.y + other.y,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="使用特征作为函数参数"><a href="#使用特征作为函数参数" class="headerlink" title="使用特征作为函数参数"></a>使用特征作为函数参数</h1><h2 id="impl-Trait语法"><a href="#impl-Trait语法" class="headerlink" title="impl Trait语法"></a>impl Trait语法</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//impl Summary作为参数</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>(item: &amp;<span class="keyword">impl</span> <span class="title class_">Summary</span>) &#123;</span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, item.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 还能通过 + 指定多个约束条件</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>(item: &amp;(<span class="keyword">impl</span> <span class="title class_">Summary</span> + Display)) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Trait-Bound-语法"><a href="#Trait-Bound-语法" class="headerlink" title="Trait Bound 语法"></a>Trait Bound 语法</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//impl Trait 和 trait bound作用一样，知识impl 更简化短小</span></span><br><span class="line"><span class="comment">//但trait bound 适用于更复杂场景</span></span><br><span class="line"><span class="comment">//假如有多个参数，trait bound能限制数据类型，但Impl不行</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>&lt;T: Summary&gt;(item: &amp;T) &#123;</span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,item.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">notify</span>&lt;T: Summary + Display&gt;(item: &amp;T) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="where-简化trait-bound"><a href="#where-简化trait-bound" class="headerlink" title="where 简化trait bound"></a>where 简化trait bound</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//where 简化trait bound</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">notify1</span>(item1: &amp;(<span class="keyword">impl</span> <span class="title class_">Summary</span>), item2: &amp;(<span class="keyword">impl</span> <span class="title class_">Summary</span>)) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news! &#123;&#125;&quot;</span>, item1.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news! &#123;&#125;&quot;</span>, item2.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">notify2</span>&lt;T: Summary + Display&gt;(item1: &amp;T, item2: &amp;T) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news! &#123;&#125;&quot;</span>, item1.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news! &#123;&#125;&quot;</span>, item2.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//where其实就是把约束条件从fn notify3&lt;&gt;的&lt;&gt;里面，挪到外面来写，避免&lt;&gt;里面太长可读性差</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">notify3</span>&lt;T,U&gt;(item1: &amp;T, item2: &amp;U) </span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">    T: Summary + Display ,</span><br><span class="line">    U: Summary + Display + <span class="built_in">Debug</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news! &#123;&#125;&quot;</span>, item1.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Breaking news! &#123;&#125;&quot;</span>, item2.<span class="title function_ invoke__">summarize</span>());</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h1 id="返回实现trait类型"><a href="#返回实现trait类型" class="headerlink" title="返回实现trait类型"></a>返回实现trait类型</h1><h2 id="impl-Trait-语法"><a href="#impl-Trait-语法" class="headerlink" title="impl Trait 语法"></a>impl Trait 语法</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回值中使用impl Trait，来返回实现了某个trait的类型</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">return_summarizable</span>() <span class="punctuation">-&gt;</span> <span class="keyword">impl</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line">    Post &#123;</span><br><span class="line">        title: <span class="string">&quot;Rust&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        author: <span class="string">&quot;ou&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        content: <span class="string">&quot;Rust is great&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="特征对象"><a href="#特征对象" class="headerlink" title="特征对象"></a>特征对象</h2><p>指定某种指针如<code>&amp;</code>或<code>Box&lt;T&gt;</code>智能指针，还有<code>dyn</code>keyword, 以及指定相关的trait来创建trait对象。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用 Box&lt;dyn Trait&gt; 允许你在运行时决定返回的具体类型，提供了更大的灵活性。</span></span><br><span class="line"><span class="comment">//封装性：隐藏了具体的类型信息，只暴露了实现的 trait，增加了代码的抽象性和封装性。</span></span><br><span class="line"><span class="comment">//Box&lt;dyn Summary&gt; 返回一个实现了 Summary trait 的动态类型</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">summarizeable</span>(switch: <span class="type">bool</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Summary&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> switch &#123;</span><br><span class="line">       <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Post &#123;</span><br><span class="line">        title: <span class="string">&quot;Rust&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        author: <span class="string">&quot;ou&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        content: <span class="string">&quot;Rust is great&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">       &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Weibo &#123;</span><br><span class="line">            username: <span class="string">&quot;ou&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            content: <span class="string">&quot;you should learn rust&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/01/Rust-lesson-19/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/01/Rust-lesson-19/" itemprop="url">Rust lesson 19 - 智能指针 `Rc<T>`、`RefCell<T>`、`Weak<T>`</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-01T20:14:36+08:00">
                2024-11-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Rc："><a href="#Rc：" class="headerlink" title="Rc&lt;T&gt;："></a><code>Rc&lt;T&gt;</code>：</h1><h2 id="What-is-Rc"><a href="#What-is-Rc" class="headerlink" title="What is Rc&lt;T&gt;:"></a>What is <code>Rc&lt;T&gt;</code>:</h2><p><code>Rc&lt;T&gt;</code> 是 Rust 标准库中提供的一个智能指针类型，代表“引用计数”（Reference Counted）。它允许多个所有者共享同一数据，而无需使用互斥锁或其他同步机制。</p>
<h2 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h2><ol>
<li><p><strong>共享所有权</strong>：</p>
<ul>
<li><code>Rc&lt;T&gt;</code> 允许多个所有者共享同一数据。</li>
<li>每个 <code>Rc&lt;T&gt;</code> 实例都增加数据的引用计数。</li>
</ul>
</li>
<li><p><strong>引用计数</strong>：</p>
<ul>
<li><code>Rc&lt;T&gt;</code> 维护一个引用计数器，记录有多少个 <code>Rc&lt;T&gt;</code> 实例指向同一数据。</li>
<li>当引用计数为零时，数据会被自动释放。</li>
</ul>
</li>
<li><p><strong>不可变性</strong>：</p>
<ul>
<li>默认情况下，<code>Rc&lt;T&gt;</code> 提供的数据是不可变的。</li>
<li>如果需要内部可变性，可以结合 <code>RefCell&lt;T&gt;</code> 使用。</li>
</ul>
</li>
</ol>
<h2 id="代码示例："><a href="#代码示例：" class="headerlink" title="代码示例："></a>代码示例：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"><span class="keyword">use</span> crate::List::*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">    <span class="comment">//包含整数和指向下一个列表节点的 Rc 引用的节点。</span></span><br><span class="line">    <span class="title function_ invoke__">Cons</span>(<span class="type">i32</span>, Rc&lt;List&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">study</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个包含两个节点的链表 a，节点值分别为 5 和 10</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = Rc::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(<span class="number">5</span>,Rc::<span class="title function_ invoke__">new</span>(<span class="title function_ invoke__">Cons</span>(<span class="number">10</span>, Rc::<span class="title function_ invoke__">new</span>(Nil)))));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;a: &#123;&#125;&quot;</span>,Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个新的节点 b，其值为 3，并指向 a，并共享所有权，a的引用计数加一</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">3</span>, Rc::<span class="title function_ invoke__">clone</span>(&amp;a));</span><br><span class="line">    <span class="comment">//Rc::strong_count 方法来获取关于a的 Rc 引用的强引用计数。强引用计数表示当前有多少个 Rc 引用指向同一个数据。</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;b: &#123;&#125;&quot;</span>,Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个新的节点 c，其值为 4，并指向 a</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = <span class="title function_ invoke__">Cons</span>(<span class="number">4</span>, Rc::<span class="title function_ invoke__">clone</span>(&amp;a));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;c: &#123;&#125;&quot;</span>,Rc::<span class="title function_ invoke__">strong_count</span>(&amp;a));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,a);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,b);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,c);</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">study</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出结果</span></span><br><span class="line">a: <span class="number">1</span>   <span class="comment">//a的引用计数是1</span></span><br><span class="line">b: <span class="number">2</span>   <span class="comment">//a的引用计数是2</span></span><br><span class="line">c: <span class="number">3</span>   <span class="comment">//a的引用计数是3</span></span><br><span class="line"><span class="title function_ invoke__">Cons</span>(<span class="number">5</span>, <span class="title function_ invoke__">Cons</span>(<span class="number">10</span>, Nil))</span><br><span class="line"><span class="title function_ invoke__">Cons</span>(<span class="number">3</span>, <span class="title function_ invoke__">Cons</span>(<span class="number">5</span>, <span class="title function_ invoke__">Cons</span>(<span class="number">10</span>, Nil)))</span><br><span class="line"><span class="title function_ invoke__">Cons</span>(<span class="number">4</span>, <span class="title function_ invoke__">Cons</span>(<span class="number">5</span>, <span class="title function_ invoke__">Cons</span>(<span class="number">10</span>, Nil)))</span><br></pre></td></tr></table></figure>

<h2 id="Rc-和-Box-指针的区别："><a href="#Rc-和-Box-指针的区别：" class="headerlink" title="Rc 和 Box 指针的区别："></a>Rc 和 Box 指针的区别：</h2><ol>
<li><p><strong>所有权</strong>：</p>
<ul>
<li><code>Box&lt;T&gt;</code> 是独占的，只能有一个所有者。</li>
<li><code>Rc&lt;T&gt;</code> 允许多个所有者共享同一数据。</li>
</ul>
</li>
<li><p><strong>内存管理</strong>：</p>
<ul>
<li><code>Box&lt;T&gt;</code> 在堆上分配内存，当 <code>Box&lt;T&gt;</code> 被丢弃时，其内部的数据也会被自动释放。</li>
<li><code>Rc&lt;T&gt;</code> 维护一个引用计数器，当引用计数为零时，数据会被自动释放。</li>
</ul>
</li>
<li><p><strong>使用场景</strong>：</p>
<ul>
<li><code>Box&lt;T&gt;</code> 适用于需要在堆上分配数据的情况，特别是大型数据结构。</li>
<li><code>Rc&lt;T&gt;</code> 适用于需要在多个所有者之间共享数据的情况，避免不必要的数据拷贝。</li>
</ul>
</li>
<li><p><strong>内部可变性</strong>：</p>
<ul>
<li>如果需要内部可变性，两者都可以结合 <code>RefCell&lt;T&gt;</code> 使用。</li>
</ul>
</li>
</ol>
<h1 id="RefCell"><a href="#RefCell" class="headerlink" title="RefCell&lt;T&gt;"></a><code>RefCell&lt;T&gt;</code></h1><h2 id="What-is-RefCell"><a href="#What-is-RefCell" class="headerlink" title="What is RefCell&lt;T&gt;:"></a>What is <code>RefCell&lt;T&gt;</code>:</h2><p><code>RefCell&lt;T&gt;</code> 是 Rust 标准库中提供的一个智能指针类型，用于实现内部可变性（Interior Mutability）。它允许你在编译时不可变的情况下，在运行时进行可变性检查</p>
<h2 id="特点：-1"><a href="#特点：-1" class="headerlink" title="特点："></a>特点：</h2><ol>
<li><p><strong>内部可变性</strong>：</p>
<ul>
<li><code>RefCell&lt;T&gt;</code> 允许你在不可变引用的情况下修改数据。</li>
<li>这种特性在某些情况下非常有用，例如在 <code>Rc&lt;T&gt;</code> 中存储可变数据。</li>
</ul>
</li>
<li><p><strong>运行时借用检查</strong>：</p>
<ul>
<li><code>RefCell&lt;T&gt;</code> 在运行时（不是编译时）检查借用（引用）规则，确保在同一时间只有一个可变引用或多个不可变引用。</li>
<li>如果违反了这些规则，程序会在运行时 panic。</li>
</ul>
</li>
<li><p><strong>不可变引用</strong>：</p>
<ul>
<li>使用 <code>borrow</code> 方法获取不可变引用。</li>
<li>多个不可变引用可以同时存在。</li>
</ul>
</li>
<li><p><strong>可变引用</strong>：</p>
<ul>
<li>使用 <code>borrow_mut</code> 方法获取可变引用。</li>
</ul>
</li>
</ol>
<h2 id="代码示例：-1"><a href="#代码示例：-1" class="headerlink" title="代码示例："></a>代码示例：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">study</span>() &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">data</span> = RefCell::<span class="title function_ invoke__">new</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">//获取不可变引用</span></span><br><span class="line">    &#123;   </span><br><span class="line">        <span class="comment">//data.borrow() 获取一个不可变引用 Ref</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">value</span> = data.<span class="title function_ invoke__">borrow</span>();</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可变引用</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//data.borrow_mut() 获取一个可变引用 RefMut。value可以做运算。</span></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">value</span> = data.<span class="title function_ invoke__">borrow_mut</span>();</span><br><span class="line">        *value += <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//再次获取不可变引用</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">value</span> = data.<span class="title function_ invoke__">borrow</span>();</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="注意事项："><a href="#注意事项：" class="headerlink" title="注意事项："></a>注意事项：</h2><ol>
<li><p><strong>运行时检查</strong>：</p>
<ul>
<li><code>RefCell&lt;T&gt;</code> 在运行时检查借用规则，确保在同一时间只有一个可变引用或多个不可变引用。</li>
<li>如果违反了这些规则，程序会在运行时 panic。</li>
</ul>
</li>
<li><p><strong>性能开销</strong>：</p>
<ul>
<li><code>RefCell&lt;T&gt;</code> 在运行时进行借用检查，可能会带来一些性能开销。</li>
<li>在性能敏感的应用中，应谨慎使用 <code>RefCell&lt;T&gt;</code>。</li>
</ul>
</li>
<li><p><strong>线程安全</strong>：</p>
<ul>
<li><code>RefCell&lt;T&gt;</code> 不是线程安全的，只能在单线程环境中使用。</li>
<li>如果需要在多线程环境中实现内部可变性，应使用 <code>Mutex&lt;T&gt;</code> 或 <code>RwLock&lt;T&gt;</code>。</li>
</ul>
</li>
</ol>
<h1 id="引用循环和内存泄露："><a href="#引用循环和内存泄露：" class="headerlink" title="引用循环和内存泄露："></a>引用循环和内存泄露：</h1><h2 id="代码示例：-2"><a href="#代码示例：-2" class="headerlink" title="代码示例："></a>代码示例：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    value: <span class="type">i32</span>,</span><br><span class="line">    next: <span class="type">Option</span>&lt;Rc&lt;RefCell&lt;Node&gt;&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">study</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">first</span> = Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(Node&#123;value:<span class="number">1</span>, next: <span class="literal">None</span>&#125;));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">second</span> = Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(Node&#123;value:<span class="number">2</span>, next: <span class="literal">None</span>&#125;));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建引用循环，first指second,second指first</span></span><br><span class="line">    first.<span class="title function_ invoke__">borrow_mut</span>().next = <span class="title function_ invoke__">Some</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;second));</span><br><span class="line">    second.<span class="title function_ invoke__">borrow_mut</span>().next = <span class="title function_ invoke__">Some</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;first));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//打印引用计数，然后发现很正常，查不出来</span></span><br><span class="line">    <span class="comment">//因为 Rc 的强引用计数只统计强引用的数量，而弱引用计数则统计弱引用的数量。</span></span><br><span class="line">    <span class="comment">//Rc::strong_count(&amp;first) 和 Rc::strong_count(&amp;second) 分别返回 first 和 second 的强引用计数。</span></span><br><span class="line">    <span class="comment">//Rc::weak_count(&amp;first) 和 Rc::weak_count(&amp;second) 分别返回 first 和 second 的弱引用计数。    </span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;first strong: &#123;:?&#125;,first weak: &#123;:?&#125;&quot;</span>,Rc::<span class="title function_ invoke__">strong_count</span>(&amp;first), Rc::<span class="title function_ invoke__">weak_count</span>(&amp;first));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;second strong: &#123;:?&#125;,second weak: &#123;:?&#125;&quot;</span>,Rc::<span class="title function_ invoke__">strong_count</span>(&amp;second), Rc::<span class="title function_ invoke__">weak_count</span>(&amp;second));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//再直接打印，发现一直循环，fatal runtime error: stack overflow</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, first);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出结果</span></span><br><span class="line"><span class="comment">//first 的强引用计数是 2，因为 first 自身是一个引用，另一个引用来自 second 的 next 字段。</span></span><br><span class="line"><span class="comment">//first 没有弱引用.second 同理。</span></span><br><span class="line"><span class="comment">//first strong: 2, first weak: 0 </span></span><br><span class="line"><span class="comment">//second strong: 2, second weak: 0</span></span><br></pre></td></tr></table></figure>

<h1 id="Weak："><a href="#Weak：" class="headerlink" title="Weak&lt;T&gt;："></a><code>Weak&lt;T&gt;</code>：</h1><h2 id="What-is-Weak："><a href="#What-is-Weak：" class="headerlink" title="What is Weak："></a>What is Weak：</h2><p><code>Weak&lt;T&gt;</code> 是一种智能指针类型，用于打破由 <code>Rc&lt;T&gt;</code> 或 <code>Arc&lt;T&gt;</code> 创建的引用循环。<code>Weak&lt;T&gt;</code> 不增加强引用计数，因此不会阻止对象被释放。</p>
<h2 id="特点：-2"><a href="#特点：-2" class="headerlink" title="特点："></a>特点：</h2><ol>
<li><p><strong>不增加强引用计数</strong>：</p>
<ul>
<li><code>Weak&lt;T&gt;</code> 不增加被引用对象的强引用计数。</li>
<li>因此，<code>Weak&lt;T&gt;</code> 不会阻止对象被释放。</li>
</ul>
</li>
<li><p><strong>可升级</strong>：</p>
<ul>
<li><code>Weak&lt;T&gt;</code> 可以通过 <code>upgrade</code> 方法转换为 <code>Rc&lt;T&gt;</code> 或 <code>Arc&lt;T&gt;</code>。</li>
<li>如果对象已经被释放，<code>upgrade</code> 方法会返回 <code>None</code>。</li>
</ul>
</li>
<li><p><strong>打破引用循环</strong>：</p>
<ul>
<li><code>Weak&lt;T&gt;</code> 常用于打破由 <code>Rc&lt;T&gt;</code> 或 <code>Arc&lt;T&gt;</code> 创建的引用循环，避免内存泄漏。</li>
</ul>
</li>
</ol>
<h2 id="解决循环引用代码示例"><a href="#解决循环引用代码示例" class="headerlink" title="解决循环引用代码示例:"></a>解决循环引用代码示例:</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::rc::&#123;Rc,Weak&#125;;</span><br><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    value: <span class="type">i32</span>,</span><br><span class="line">    <span class="comment">//next：指向下一个节点的强引用。</span></span><br><span class="line">    next: <span class="type">Option</span>&lt;Rc&lt;RefCell&lt;Node&gt;&gt;&gt;,</span><br><span class="line">    <span class="comment">//prev：指向前一个节点的弱引用</span></span><br><span class="line">    prev: <span class="type">Option</span>&lt;Weak&lt;RefCell&lt;Node&gt;&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">study</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">first</span> = Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(Node&#123;value:<span class="number">1</span>, next: <span class="literal">None</span>, prev: <span class="literal">None</span>&#125;));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">second</span> = Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(Node&#123;value:<span class="number">2</span>, next: <span class="literal">None</span>, prev: <span class="literal">None</span>&#125;));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建引用循环</span></span><br><span class="line">    first.<span class="title function_ invoke__">borrow_mut</span>().next = <span class="title function_ invoke__">Some</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;second));</span><br><span class="line">    <span class="comment">//`second` 的 `prev` 字段指向 `first`，使用 `Weak` 引用来打破循环。</span></span><br><span class="line">    <span class="comment">//Rc::downgrade 创建一个 Weak&lt;T&gt; 实例</span></span><br><span class="line">    <span class="comment">//使用weak后，first 的强引用计数器是1（自身），而不是2</span></span><br><span class="line">    second.<span class="title function_ invoke__">borrow_mut</span>().prev = <span class="title function_ invoke__">Some</span>(Rc::<span class="title function_ invoke__">downgrade</span>(&amp;first));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//打印引用计数，然后发现很正常，查不出来</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;first strong: &#123;:?&#125;,first weak: &#123;:?&#125;&quot;</span>,Rc::<span class="title function_ invoke__">strong_count</span>(&amp;first), Rc::<span class="title function_ invoke__">weak_count</span>(&amp;first));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;second strong: &#123;:?&#125;,second weak: &#123;:?&#125;&quot;</span>,Rc::<span class="title function_ invoke__">strong_count</span>(&amp;second), Rc::<span class="title function_ invoke__">weak_count</span>(&amp;second));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//这回就正常多了</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, first);</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出结果：</span></span><br><span class="line">first strong: <span class="number">1</span>,first weak: <span class="number">1</span></span><br><span class="line">second strong: <span class="number">2</span>,second weak: <span class="number">0</span></span><br><span class="line">RefCell &#123; value: Node &#123; value: <span class="number">1</span>, next: <span class="title function_ invoke__">Some</span>(RefCell &#123; value: Node &#123; value: <span class="number">2</span>, next: <span class="literal">None</span>, prev: <span class="title function_ invoke__">Some</span>((Weak)) &#125; &#125;), prev: <span class="literal">None</span> &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// drop(first) 以后会释放强引用，first强引用为0，节点被释放。</span></span><br><span class="line"><span class="comment">//second不会被释放，因为它的强引用从 2-&gt;1,不为0.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="强引用和弱引用区别："><a href="#强引用和弱引用区别：" class="headerlink" title="强引用和弱引用区别："></a>强引用和弱引用区别：</h1><h3 id="所有权"><a href="#所有权" class="headerlink" title="所有权"></a>所有权</h3><ol>
<li><p><strong>强引用</strong>：</p>
<ul>
<li>强引用拥有对象的所有权。</li>
<li>每个强引用都会增加对象的引用计数。</li>
<li>当最后一个强引用被释放时，对象的所有权被完全释放，对象会被销毁。</li>
</ul>
</li>
<li><p><strong>弱引用</strong>：</p>
<ul>
<li>弱引用不拥有对象的所有权。</li>
<li>弱引用不会增加对象的引用计数。</li>
<li>即使所有强引用都被释放，弱引用仍然可以存在，但它们不能再访问已销毁的对象。</li>
</ul>
</li>
</ol>
<h3 id="引用计数"><a href="#引用计数" class="headerlink" title="引用计数"></a>引用计数</h3><ol>
<li><p><strong>强引用</strong>：</p>
<ul>
<li>强引用使用引用计数来管理对象的生命周期。</li>
<li>每次创建一个新的强引用，引用计数加一。</li>
<li>每次释放一个强引用，引用计数减一。</li>
<li>当引用计数为零时，对象被销毁。</li>
</ul>
</li>
<li><p><strong>弱引用</strong>：</p>
<ul>
<li>弱引用不直接影响引用计数。</li>
<li>弱引用的存在不会阻止对象的销毁。</li>
<li>使用 <code>upgrade</code> 方法可以尝试将弱引用转换为强引用，如果对象已经销毁，则返回 <code>None</code>。</li>
</ul>
</li>
</ol>
<h3 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h3><ol>
<li><p><strong>强引用</strong>：</p>
<ul>
<li>强引用确保对象在至少有一个强引用存在时不会被销毁。</li>
<li>对象的内存只有在所有强引用都被释放后才会被回收。</li>
<li>强引用适用于需要确保对象在整个生命周期内始终存在的场景。</li>
</ul>
</li>
<li><p><strong>弱引用</strong>：</p>
<ul>
<li>弱引用允许对象在没有任何强引用时被销毁，即使还有弱引用存在。</li>
<li>弱引用不会阻止对象的内存回收。</li>
<li>使用弱引用来访问对象时，需要先检查对象是否还存在（通过 <code>upgrade</code> 方法）。</li>
</ul>
</li>
</ol>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ol>
<li><p><strong>强引用</strong>：</p>
<ul>
<li><strong>共享所有权</strong>：当多个部分需要共享同一个数据结构且这些部分都需要确保数据在使用期间存在时。</li>
<li><strong>多线程共享</strong>：使用 <code>Arc&lt;T&gt;</code> 在多线程环境中安全地共享不可变数据。</li>
<li><strong>资源管理</strong>：确保资源（如文件句柄、网络连接等）在不再需要时被正确释放。</li>
</ul>
</li>
<li><p><strong>弱引用</strong>：</p>
<ul>
<li><strong>避免循环引用</strong>：在有相互引用的数据结构中使用弱引用来避免内存泄漏。</li>
<li><strong>缓存</strong>：在缓存中使用弱引用来避免占用过多内存，当对象不再需要时可以自动清除。</li>
<li><strong>观察者模式</strong>：在实现观察者模式时，使用弱引用来避免观察者对象和被观察对象之间的循环引用。</li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/01/Rust-lesson-18/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/01/Rust-lesson-18/" itemprop="url">Rust lesson 18 - 生命周期</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-01T17:09:40+08:00">
                2024-11-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="为什么需要生命周期注解？"><a href="#为什么需要生命周期注解？" class="headerlink" title="为什么需要生命周期注解？"></a>为什么需要生命周期注解？</h1><h2 id="引用的有效范围："><a href="#引用的有效范围：" class="headerlink" title="引用的有效范围："></a>引用的有效范围：</h2><p>当函数返回一个引用时，编译器需要确保这个引用在其生命周期内始终有效。<br>如果没有生命周期注解，编译器无法确定返回的引用 &amp;str 的生命周期与输入引用 x 和 y 的生命周期之间的关系。</p>
<h2 id="悬垂引用："><a href="#悬垂引用：" class="headerlink" title="悬垂引用："></a>悬垂引用：</h2><p>悬垂引用是指指向已经释放的内存的引用。这是非常危险的，因为它会导致未定义行为。<br>生命周期注解帮助编译器确保返回的引用在其生命周期内始终有效，从而避免悬垂引用。</p>
<h2 id="创建生命周期："><a href="#创建生命周期：" class="headerlink" title="创建生命周期："></a>创建生命周期：</h2><p>生命周期主要通过生命周期注解来创建和使用。使用显示声明，例如<code>&#39;a</code>这种单引号加字母的方式，至于字母是什么无所谓，有单引号就行。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x27;a 是一个生命周期参数，表示 x 和 y 的生命周期至少与返回的引用的生命周期一样长</span></span><br><span class="line"><span class="comment">//x: &amp;&#x27;a str 和 y: &amp;&#x27;a str 表示 x 和 y 都是生命周期为 &#x27;a 的字符串切片</span></span><br><span class="line"><span class="comment">//-&gt; &amp;&#x27;a str 表示返回的字符串切片的生命周期也是 &#x27;a</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">longest</span>&lt;<span class="symbol">&#x27;a</span>&gt;(x: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>, y: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> x.<span class="title function_ invoke__">len</span>() &gt; y.<span class="title function_ invoke__">len</span>()&#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="生命周期类别："><a href="#生命周期类别：" class="headerlink" title="生命周期类别："></a>生命周期类别：</h1><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">example</span>&lt;<span class="symbol">&#x27;a</span>&gt;(input: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span> &#123;</span><br><span class="line">    input</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Example</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    a: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">StringOption</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(&amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>),</span><br><span class="line">    <span class="literal">None</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;a</span>, <span class="symbol">&#x27;b</span>&gt; StringOption &lt;<span class="symbol">&#x27;a</span>, <span class="symbol">&#x27;b</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="特殊生命周期标注"><a href="#特殊生命周期标注" class="headerlink" title="特殊生命周期标注"></a>特殊生命周期标注</h1><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//&#x27;static 是特殊的生命周期。</span></span><br><span class="line"><span class="comment">//&#x27;static 是 Rust 中最长的生命周期，表示引用在整个程序的生命周期内都是有效的。(注意整个程序)，通常用于全局变量和字符串字面量。</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s</span>: &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SOME_COORDINATE: (<span class="type">i32</span>, <span class="type">i32</span>) = (<span class="number">7</span>, <span class="number">4</span>);</span><br><span class="line"><span class="comment">//static_reference 是一个指向 SOME_COORDINATE 的引用，具有 &#x27;static 生命周期。</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">static_reference</span>: &amp;<span class="symbol">&#x27;static</span> (<span class="type">i32</span>, <span class="type">i32</span>) = &amp;SOME_COORDINATE;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Counter</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    counter: &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> <span class="type">i32</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//impl&lt;&#x27;a&gt; Counter&lt;&#x27;a&gt; 能简写成下面这样</span></span><br><span class="line"><span class="comment">//&#x27;_&#x27; 是一个匿名生命周期参数，表示编译器会自动推断出适当的生命周期。</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Counter</span>&lt;<span class="symbol">&#x27;_</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">increment</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        *<span class="keyword">self</span>.counter += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/31/Rust-lesson-17/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/31/Rust-lesson-17/" itemprop="url">Rust lesson 17 - 泛型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-10-31T21:04:04+08:00">
                2024-10-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="What-is-泛型："><a href="#What-is-泛型：" class="headerlink" title="What is 泛型："></a>What is 泛型：</h1><p>泛型（Generics）是编程语言中的一种特性，允许你在编写代码时使用占位符（类型参数）来代替具体的类型。通过以下使用场景，你就能理解是干什么的了。</p>
<h1 id="泛型使用场景："><a href="#泛型使用场景：" class="headerlink" title="泛型使用场景："></a>泛型使用场景：</h1><h2 id="泛型函数减少了代码重复，一个顶三个，简单示例："><a href="#泛型函数减少了代码重复，一个顶三个，简单示例：" class="headerlink" title="泛型函数减少了代码重复，一个顶三个，简单示例："></a>泛型函数减少了代码重复，一个顶三个，简单示例：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">add_i8</span>(a:<span class="type">i8</span>, b:<span class="type">i8</span>) <span class="punctuation">-&gt;</span> <span class="type">i8</span> &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">add_i32</span>(a:<span class="type">i32</span>, b:<span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">add_f64</span>(a:<span class="type">f64</span>, b:<span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//T 是一个泛型参数，表示任意类型,没啥特殊含义，你用ABCDEFG都行。</span></span><br><span class="line"><span class="comment">//std::ops::Add&lt;Output = T&gt; 是一个 trait 约束，表示类型 T 必须实现了 Add trait，并且加法操作的结果类型也是 T。</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">add</span>&lt;T : std::ops::Add&lt;Output = T&gt;&gt;(a:T, b:T) <span class="punctuation">-&gt;</span> T &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="comment">//2i8,就是2（i8类型）</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;add i8: &#123;&#125;&quot;</span>,<span class="title function_ invoke__">add_i8</span>(<span class="number">2i8</span>, <span class="number">3i8</span>));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;add i32: &#123;&#125;&quot;</span>,<span class="title function_ invoke__">add_i32</span>(<span class="number">20</span>, <span class="number">30</span>));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;add f64: &#123;&#125;&quot;</span>,<span class="title function_ invoke__">add_f64</span>(<span class="number">1.23</span>, <span class="number">1.23</span>));</span><br><span class="line">    <span class="title function_ invoke__">add</span>(<span class="number">2i8</span>, <span class="number">3i8</span>);</span><br><span class="line">    <span class="title function_ invoke__">add</span>(<span class="number">20</span>, <span class="number">30</span>);</span><br><span class="line">    <span class="title function_ invoke__">add</span>(<span class="number">1.23</span>, <span class="number">1.23</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="复杂一点的例子-比较大小-："><a href="#复杂一点的例子-比较大小-：" class="headerlink" title="复杂一点的例子(比较大小)："></a>复杂一点的例子(比较大小)：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//list: &amp;[T] 表示 list 是一个切片，切片是一个指向数组的引用，可以是任何长度的数组的一部分。</span></span><br><span class="line"><span class="comment">//-&gt; &amp;T 表示返回一个指向切片中元素的引用。</span></span><br><span class="line"><span class="comment">//通过实现 std::cmp::PartialOrd，可以在泛型函数或泛型结构中允许使用比较操作。</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">larget</span>&lt;T: std::cmp::<span class="built_in">PartialOrd</span>&gt;(list: &amp;[T])<span class="punctuation">-&gt;</span> &amp;T &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">largest</span> = &amp;list[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">item</span> <span class="keyword">in</span> list &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>  largest;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number_list</span> = <span class="built_in">vec!</span>[<span class="number">34</span>, <span class="number">50</span>, <span class="number">25</span>, <span class="number">100</span>, <span class="number">65</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">larget</span>(&amp;number_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest number is &#123;&#125;&quot;</span>, result);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">char_list</span> = <span class="built_in">vec!</span>[<span class="string">&#x27;y&#x27;</span>,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;q&#x27;</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">larget</span>(&amp;char_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest char is &#123;&#125;&quot;</span>,result);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="结构体中使用泛型："><a href="#结构体中使用泛型：" class="headerlink" title="结构体中使用泛型："></a>结构体中使用泛型：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//T 和 U区分两个类型</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;T,U&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: U,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p1</span> = Point&#123;x:<span class="number">5</span> , y:<span class="number">10</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p2</span> = Point&#123;x:<span class="number">1.0</span> , y:<span class="number">1.0</span>&#125;;</span><br><span class="line">    <span class="comment">//如果上面是struct是&lt;T&gt;,会报错，因为x和y是不同类型。</span></span><br><span class="line">    <span class="comment">//但写成&lt;T ,U&gt;,区分开不同类型，就不会报错。</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p3</span> = Point&#123;x: <span class="number">5</span>, y: <span class="number">4.0</span>&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="枚举中用泛型："><a href="#枚举中用泛型：" class="headerlink" title="枚举中用泛型："></a>枚举中用泛型：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Option</span>&lt;T&gt; &#123;</span><br><span class="line">	<span class="title function_ invoke__">Some</span>(T),</span><br><span class="line">	<span class="literal">None</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;T, E&gt; &#123;</span><br><span class="line">	<span class="title function_ invoke__">Ok</span>(T),</span><br><span class="line">	<span class="title function_ invoke__">Err</span>(E),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实现方法使用泛型："><a href="#实现方法使用泛型：" class="headerlink" title="实现方法使用泛型："></a>实现方法使用泛型：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;T,U&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: U,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//为结构体实现方法，使用泛型要在impl后面加&lt;T, U&gt;</span></span><br><span class="line"><span class="keyword">impl</span>&lt;T, U&gt; Point&lt;T,U&gt;&#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">x</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;T&#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.x</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//接受另一个 Point 实例 other，返回一个新的 Point 实例，其 x 字段来自 self，y 字段来自 other。</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">mixup</span>&lt;T2, U2&gt;(<span class="keyword">self</span>, other: Point&lt;T2, U2&gt;) <span class="punctuation">-&gt;</span> Point&lt;T, U2&gt; &#123;</span><br><span class="line">        Point &#123;</span><br><span class="line">            x: <span class="keyword">self</span>.x,</span><br><span class="line">            y: other.y,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">p4</span> = Point &#123; x:<span class="number">5</span> , y:<span class="number">10.4</span>&#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p5</span> = Point &#123; x: <span class="string">&quot;Hello&quot;</span>, y: <span class="string">&#x27;c&#x27;</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//p4的 x 和 p5的 y 混合</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p6</span> = p4.<span class="title function_ invoke__">mixup</span>(p5);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;p6.x is &#123;&#125;,p6.y is &#123;&#125;&quot;</span>,p6.x,p6.y);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* let p1 = Point&#123;x:5 , y:10 &#125;;</span></span><br><span class="line"><span class="comment">    let p2 = Point&#123;x:1.0 , y:1.0&#125;;</span></span><br><span class="line"><span class="comment">    let p3 = Point&#123;x: 5, y: 4.0&#125;; */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="const使用泛型："><a href="#const使用泛型：" class="headerlink" title="const使用泛型："></a>const使用泛型：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">display_array</span>(arr: [<span class="type">i32</span>; <span class="number">3</span>]) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, arr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//接受一个切片arr（slice）,元素类型为 T 作为参数，并使用 std::fmt::Debug trait 将切片的内容打印出来</span></span><br><span class="line"><span class="comment">//切片是一个指向数组的引用，可以是任何长度的数组的一部分</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">display_array1</span>&lt;T: std::fmt::<span class="built_in">Debug</span>&gt;(arr: &amp;[T]) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, arr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//const N: usize：这是一个常量泛型参数，表示数组的大小 N 是一个常量, 大小事 usize</span></span><br><span class="line"><span class="comment">//arr: [T; N]：函数接受一个固定大小的数组 arr，数组中的元素类型为 T，大小为 N</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">display_array2</span>&lt;T: std::fmt::<span class="built_in">Debug</span>, <span class="keyword">const</span> N: <span class="type">usize</span> &gt;(arr: [T; N]) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, arr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">arr</span>: [<span class="type">i32</span>; <span class="number">3</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="title function_ invoke__">display_array</span>(arr); </span><br><span class="line"></span><br><span class="line">    <span class="comment">/* //这样不行，因为display_array(arr: [i32; 3])</span></span><br><span class="line"><span class="comment">    let arr2: [i32; 2] = [1, 2];</span></span><br><span class="line"><span class="comment">    display_array(arr2); */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span>: [<span class="type">i32</span>; <span class="number">3</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="title function_ invoke__">display_array1</span>(&amp;arr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span>: [<span class="type">i32</span>; <span class="number">2</span>] = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">    <span class="title function_ invoke__">display_array1</span>(&amp;arr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span>: [<span class="type">i32</span>; <span class="number">3</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="title function_ invoke__">display_array2</span>(arr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span>: [<span class="type">i32</span>; <span class="number">2</span>] = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">    <span class="title function_ invoke__">display_array2</span>(arr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">QsunOu</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
