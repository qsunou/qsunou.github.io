<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Learning about Rust&amp;Solana">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Learning about Rust&amp;Solana">
<meta property="og:locale">
<meta property="article:author" content="QsunOu">
<meta property="article:tag" content="rust">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/page/2/"/>





  <title>Hexo</title>
  








<meta name="generator" content="Hexo 7.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/02/13/Solana%20%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91%20-%20DeFi%20-%20Dex%20%E5%BC%80%E5%8F%91%E5%9B%9B%EF%BC%9Acreator/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2025/02/13/Solana%20%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91%20-%20DeFi%20-%20Dex%20%E5%BC%80%E5%8F%91%E5%9B%9B%EF%BC%9Acreator/" itemprop="url">Solana 合约开发 - DeFi - Dex 开发四：Creator</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-02-13T22:36:29+08:00">
                2025-02-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Solana%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91-DeFi-Dex/" itemprop="url" rel="index">
                    <span itemprop="name">Solana合约开发-DeFi-Dex</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在创建流动性池之前，我们需要先准备一些creator相关的账户。</p>
<h1 id="合约代码："><a href="#合约代码：" class="headerlink" title="合约代码："></a>合约代码：</h1><p>anchor&#x2F;programs&#x2F;swap&#x2F;src&#x2F;accounts_all&#x2F;creator.rs</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::states::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"><span class="keyword">use</span> anchor_spl::&#123;</span><br><span class="line">    associated_token::AssociatedToken,</span><br><span class="line">    token::Mint <span class="keyword">as</span> TokenMint,</span><br><span class="line">    token::Token,</span><br><span class="line">    token_interface::&#123;Mint, TokenAccount, TokenInterface&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Accounts)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">InitCreator</span>&lt;<span class="symbol">&#x27;info</span>&gt; &#123;</span><br><span class="line">    <span class="meta">#[account(mut)]</span></span><br><span class="line">    <span class="keyword">pub</span> payer: Signer&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//creator自己的lp token vault</span></span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        init_if_needed,</span></span><br><span class="line"><span class="meta">        associated_token::mint = lp_token_mint,</span></span><br><span class="line"><span class="meta">        associated_token::authority = payer,</span></span><br><span class="line"><span class="meta">        payer = payer,</span></span><br><span class="line"><span class="meta">        token::token_program = token_program,</span></span><br><span class="line"><span class="meta">    )]</span></span><br><span class="line">    <span class="keyword">pub</span> creator_lp_token_vault: <span class="type">Box</span>&lt;InterfaceAccount&lt;<span class="symbol">&#x27;info</span>, TokenAccount&gt;&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            LP_TOKEN_SEED.as_bytes(),</span></span><br><span class="line"><span class="meta">        ]</span>,</span><br><span class="line">        bump,</span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> lp_token_mint: Account&lt;<span class="symbol">&#x27;info</span>, TokenMint&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用于接收创建流动性池时支付的费用,通过经济成本阻止垃圾创建池操作，PoolState在下一章节创建</span></span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        init_if_needed,</span></span><br><span class="line"><span class="meta">        payer = payer,</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            PoolState::CREATE_POOL_FEE_PREFIX.as_bytes(),</span></span><br><span class="line"><span class="meta">        ]</span>,</span><br><span class="line">        bump,</span><br><span class="line">        token::mint = token_wsol_mint,</span><br><span class="line">        token::authority = pool_lp_authority,</span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> create_pool_fee: <span class="type">Box</span>&lt;InterfaceAccount&lt;<span class="symbol">&#x27;info</span>, TokenAccount&gt;&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> token_wsol_mint: <span class="type">Box</span>&lt;InterfaceAccount&lt;<span class="symbol">&#x27;info</span>, Mint&gt;&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        constraint = token_0_mint.key() &lt; token_1_mint.key(),</span></span><br><span class="line"><span class="meta">        mint::token_program = token_0_program,</span></span><br><span class="line"><span class="meta">    )]</span></span><br><span class="line">    <span class="keyword">pub</span> token_0_mint: <span class="type">Box</span>&lt;InterfaceAccount&lt;<span class="symbol">&#x27;info</span>, Mint&gt;&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        mint::token_program = token_1_program,</span></span><br><span class="line"><span class="meta">    )]</span></span><br><span class="line">    <span class="keyword">pub</span> token_1_mint: <span class="type">Box</span>&lt;InterfaceAccount&lt;<span class="symbol">&#x27;info</span>, Mint&gt;&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// CHECK: pool vault and lp mint authority</span></span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            crate::AUTH_SEED.as_bytes(),</span></span><br><span class="line"><span class="meta">        ]</span>,</span><br><span class="line">        bump,</span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> pool_lp_authority: UncheckedAccount&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// CHECK: Token program for token_0</span></span><br><span class="line">    <span class="keyword">pub</span> token_0_program: Interface&lt;<span class="symbol">&#x27;info</span>, TokenInterface&gt;,</span><br><span class="line">    <span class="comment">/// CHECK: Token program for token_1</span></span><br><span class="line">    <span class="keyword">pub</span> token_1_program: Interface&lt;<span class="symbol">&#x27;info</span>, TokenInterface&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> system_program: Program&lt;<span class="symbol">&#x27;info</span>, System&gt;,</span><br><span class="line">    <span class="keyword">pub</span> token_program: Program&lt;<span class="symbol">&#x27;info</span>, Token&gt;,</span><br><span class="line">    <span class="keyword">pub</span> associated_token_program: Program&lt;<span class="symbol">&#x27;info</span>, AssociatedToken&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>anchor&#x2F;programs&#x2F;swap&#x2F;src&#x2F;instructions&#x2F;creator.rs</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::accounts_all::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">init_creator</span>(ctx: Context&lt;InitCreator&gt;) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>lib.rs:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pub mod 里面添加</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">init_creator</span>(ctx: Context&lt;InitCreator&gt;) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">        instructions::<span class="title function_ invoke__">init_creator</span>(ctx)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>执行Anchor命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anchor build &amp;&amp; anchor deploy</span><br></pre></td></tr></table></figure>

<h1 id="前端TS代码："><a href="#前端TS代码：" class="headerlink" title="前端TS代码："></a>前端TS代码：</h1><p>anchor&#x2F;example&#x2F;api&#x2F;creator.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&#x27;@coral-xyz/anchor&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; program &#125; <span class="keyword">from</span> <span class="string">&quot;./wallet&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">init_creator</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="attr">wallet</span>: anchor.<span class="title class_">Wallet</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">token0Mint</span>: anchor.web3.<span class="title class_">PublicKey</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">token1Mint</span>: anchor.web3.<span class="title class_">PublicKey</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">token0Program</span>: anchor.web3.<span class="title class_">PublicKey</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">token1Program</span>: anchor.web3.<span class="title class_">PublicKey</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">tokenWsolMint</span>: anchor.web3.<span class="title class_">PublicKey</span>,</span></span><br><span class="line"><span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> program.<span class="property">methods</span>.<span class="title function_">initCreator</span>(</span><br><span class="line">    )</span><br><span class="line">        .<span class="title function_">accounts</span>(&#123;</span><br><span class="line">            <span class="attr">token0Mint</span>: token0Mint,</span><br><span class="line">            <span class="attr">token1Mint</span>: token1Mint,</span><br><span class="line">            <span class="attr">token0Program</span>: token0Program,</span><br><span class="line">            <span class="attr">token1Program</span>: token1Program,</span><br><span class="line">            <span class="attr">tokenWsolMint</span>: tokenWsolMint</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">signers</span>([wallet.<span class="property">payer</span>])</span><br><span class="line">        .<span class="title function_">rpc</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>anchor&#x2F;example&#x2F;index.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//初始化creator,这里使用devnet环境的program id和一些常见token的mint地址，这些地址都可以查得到</span></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">TOKEN_DEV_PROGRAM_ID</span> = <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&#x27;TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> usdcDevTokenMint = <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&#x27;4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> eurcDevTokenMint = <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&#x27;HzwqbKZw8HxMN6bF2yFZNrht3c2iXXzpKcFu7uBEDKtr&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">WsolDevTokenMint</span> = <span class="keyword">new</span> <span class="title class_">PublicKey</span>(<span class="string">&#x27;So11111111111111111111111111111111111111112&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> creator = <span class="keyword">await</span> <span class="title function_">init_creator</span>(</span><br><span class="line">    defaultWallet,</span><br><span class="line">    usdcDevTokenMint,</span><br><span class="line">    eurcDevTokenMint,</span><br><span class="line">    <span class="variable constant_">TOKEN_DEV_PROGRAM_ID</span>,</span><br><span class="line">    <span class="variable constant_">TOKEN_DEV_PROGRAM_ID</span>,</span><br><span class="line">    <span class="title class_">WsolDevTokenMint</span>,</span><br><span class="line">  );</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(creator);</span><br></pre></td></tr></table></figure>

<p>执行Anchor命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anchor run api</span><br></pre></td></tr></table></figure>

<p>本章节只是简单创建一些账号</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/02/10/Solana-Dex-%E9%A1%B9%E7%9B%AE%E5%8E%9F%E7%94%9F%20Token/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2025/02/10/Solana-Dex-%E9%A1%B9%E7%9B%AE%E5%8E%9F%E7%94%9F%20Token/" itemprop="url">Solana 合约开发 - DeFi - Dex 开发三：项目Token</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-02-10T21:46:35+08:00">
                2025-02-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Solana%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91-DeFi-Dex/" itemprop="url" rel="index">
                    <span itemprop="name">Solana合约开发-DeFi-Dex</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>SPL Token在之前已经介绍过了，在这再水一次，solana上面很多著名的项目都会发行自己项目的代币，这里也不例外。</p>
<h2 id="合约代码："><a href="#合约代码：" class="headerlink" title="合约代码："></a>合约代码：</h2><p>注意：建议在<code>devnet</code>环境下测试，因为<code>localnet</code>默认不支持 Token metadata program，它属于第三方开源框架，当然也有其他办法在localnet上使用，就是麻烦点。</p>
<p>首先在Anchor 项目下创建<code>accounts_all/token.rs</code>  文件，用来记录所需要用到哪些账户<br>例如：anchor&#x2F;programs&#x2F;swap&#x2F;src&#x2F;accounts_all&#x2F;token.rs</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> anchor_lang:: prelude::*;</span><br><span class="line"><span class="keyword">use</span> anchor_spl::&#123;</span><br><span class="line">    metadata::Metadata,</span><br><span class="line">    token::&#123;Mint, Token&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">use</span> crate::states::token;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Accounts)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">CreateMintAndMetadata</span>&lt;<span class="symbol">&#x27;info</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建一个 token Mint账户</span></span><br><span class="line">	<span class="comment">//init就是初始化账户，假如不存在这个账户就会自动创建</span></span><br><span class="line">	<span class="comment">//payer就是创建这个账户所花的fee由谁来支付</span></span><br><span class="line">	<span class="comment">//根据seeds的内容 自动构建一个PDA，生成账户地址</span></span><br><span class="line">	<span class="comment">//bump 自动生成的 bump 种子值，用于解决 PDA 地址冲突问题。PDA 是一种特殊的 Solana 地址，它不是由私钥控制的，而是通过程序逻辑生成的。Bump 值确保生成的地址不会与任何有效的公钥冲突。</span></span><br><span class="line">	<span class="comment">//mint::decimals: 设置新代币的小数位数</span></span><br><span class="line">	<span class="comment">//mint::authority: 指定哪个账户拥有对这个 Mint 账户的控制权,设成别的账户也可以</span></span><br><span class="line">	<span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        init,</span></span><br><span class="line"><span class="meta">        payer = payer,</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            token::SWAP_TOKEN_SEED.as_bytes(),</span></span><br><span class="line"><span class="meta">        ]</span>,        </span><br><span class="line">        bump,</span><br><span class="line">        mint::decimals = token::SWAP_TOKEN_DECIMALS,</span><br><span class="line">        mint::authority = authority.<span class="title function_ invoke__">key</span>(),</span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> swap_token_mint: <span class="type">Box</span>&lt;Account&lt;<span class="symbol">&#x27;info</span>, Mint&gt;&gt;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建一个 token metadata账户</span></span><br><span class="line">	<span class="comment">//因为这里使用了UncheckedAccount类型的账户，所以需要写&quot;///CHECK&quot;,不然build不通过，至于内容随意</span></span><br><span class="line">	<span class="comment">// mut 表示该账户是可变的，意味着在交易过程中可以修改它的内容,而不使用init是因为在代码里动态创建。</span></span><br><span class="line">	<span class="comment">// 指定哪个程序负责生成这个 PDA。在这里，指定的是 token_metadata_program，这意味着只有这个特定的元数据程序才能生成或操作这个账户。</span></span><br><span class="line">	<span class="comment">/// CHECK: Validate address by derving pda</span></span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        mut,</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            token::SWAP_TOKEN_METADATA.as_bytes(),</span></span><br><span class="line"><span class="meta">            token_metadata_program.key().as_ref(),</span></span><br><span class="line"><span class="meta">            swap_token_mint.key().as_ref(),</span></span><br><span class="line"><span class="meta">        ]</span>,</span><br><span class="line">        bump,</span><br><span class="line">        seeds::program = token_metadata_program.<span class="title function_ invoke__">key</span>(),</span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> swap_token_metadata: UncheckedAccount&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">    <span class="comment">/// CHECK: pool vault and lp mint authority</span></span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            crate::AUTH_SEED.as_bytes(),</span></span><br><span class="line"><span class="meta">        ]</span>,</span><br><span class="line">        bump,</span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> authority: UncheckedAccount&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">//可以使用你的钱包地址</span></span><br><span class="line">    <span class="meta">#[account(mut)]</span></span><br><span class="line">    <span class="keyword">pub</span> payer: Signer&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">//都是所使用到的一些程序账户</span></span><br><span class="line">    <span class="keyword">pub</span> token_metadata_program: Program&lt;<span class="symbol">&#x27;info</span>, Metadata&gt;,</span><br><span class="line">    <span class="keyword">pub</span> token_program: Program&lt;<span class="symbol">&#x27;info</span>, Token&gt;,</span><br><span class="line">    <span class="keyword">pub</span> system_program: Program&lt;<span class="symbol">&#x27;info</span>, System&gt;,</span><br><span class="line">    <span class="keyword">pub</span> rent: Sysvar&lt;<span class="symbol">&#x27;info</span>, Rent&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>然后在Anchor 项目下创建<code>states/token.rs</code>  文件<br>例如：anchor&#x2F;programs&#x2F;swap&#x2F;src&#x2F;states&#x2F;token.rs</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用来创建一些常量，在上面的accounts里面所使用</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">const</span> SWAP_TOKEN_SEED: &amp;<span class="type">str</span> = <span class="string">&quot;swap_token_V1&quot;</span>;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">const</span> SWAP_TOKEN_METADATA: &amp;<span class="type">str</span> = <span class="string">&quot;metadata&quot;</span>;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">const</span> SWAP_TOKEN_DECIMALS: <span class="type">u8</span> = <span class="number">9</span>;</span><br></pre></td></tr></table></figure>


<p>然后在Anchor 项目下创建<code>instruction/token.rs</code>  文件，用来写具体的创建代码<br>例如：anchor&#x2F;programs&#x2F;swap&#x2F;src&#x2F;instruction&#x2F;token.rs</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这里的use都是引入哪些包</span></span><br><span class="line"><span class="keyword">use</span> crate::accounts_all::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"><span class="keyword">use</span> anchor_spl::metadata::&#123;</span><br><span class="line">    create_metadata_accounts_v3, mpl_token_metadata::types::DataV2, CreateMetadataAccountsV3,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//具体创建token代码</span></span><br><span class="line"><span class="comment">//ctx就是上面的 accounts 结构体，也就是把账户信息都传进来</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">create_token_metadata</span>(ctx: Context&lt;CreateMintAndMetadata&gt;) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">	<span class="comment">//生成签名种子，以便在 CPI 调用中作为签名者。</span></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">signer_seeds</span>: &amp;[&amp;[&amp;[<span class="type">u8</span>]]] =</span><br><span class="line">        &amp;[&amp;[crate::AUTH_SEED.<span class="title function_ invoke__">as_bytes</span>(), &amp;[ctx.bumps.authority]]];</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">create_metadata_accounts_v3</span>(</span><br><span class="line">        CpiContext::<span class="title function_ invoke__">new_with_signer</span>(</span><br><span class="line">	    <span class="comment">//ctx.accounts.lp_token_metadata.to_account_info()，指向元数据账户的信息。</span></span><br><span class="line">	        ctx.accounts.iswap_token_metadata.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">	        <span class="comment">//metadata: 元数据账户本身。</span></span><br><span class="line">			<span class="comment">//mint: 关联的 Mint 账户。</span></span><br><span class="line">			<span class="comment">//mint_authority: Mint 账户的权威机构。</span></span><br><span class="line">			<span class="comment">//update_authority: 更新元数据账户的权威机构。</span></span><br><span class="line">			<span class="comment">//payer: 支付交易费用的账户。</span></span><br><span class="line">			<span class="comment">//system_program: Solana 系统程序。</span></span><br><span class="line">			<span class="comment">//rent: 租金变量，确保账户有足够的资金来避免被系统回收          </span></span><br><span class="line">			CreateMetadataAccountsV3 &#123;</span><br><span class="line">                metadata: ctx.accounts.iswap_token_metadata.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                mint: ctx.accounts.iswap_token_mint.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                mint_authority: ctx.accounts.authority.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                update_authority: ctx.accounts.authority.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                payer: ctx.accounts.payer.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                system_program: ctx.accounts.system_program.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                rent: ctx.accounts.rent.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">            &#125;,</span><br><span class="line">            signer_seeds,</span><br><span class="line">        ),</span><br><span class="line">        <span class="comment">//定义了元数据的具体内容</span></span><br><span class="line">        <span class="comment">//name: 代币名称。</span></span><br><span class="line">		<span class="comment">//symbol: 代币符号。</span></span><br><span class="line">		<span class="comment">//uri: 指向更多元数据信息的 URL（例如，代币的图标、描述等）。</span></span><br><span class="line">		<span class="comment">//seller_fee_basis_points: 卖家费用百分比点数，通常用于 NFTs 的二次销售。</span></span><br><span class="line">		<span class="comment">//creators, collection, uses: 可选字段，分别指代币创作者信息、所属集合信息及用途信息，在这个例子中均设为 None。</span></span><br><span class="line">		DataV2 &#123;</span><br><span class="line">            name: <span class="string">&quot;swap&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            symbol: <span class="string">&quot;swap&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            uri: <span class="string">&quot;swap.com&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            seller_fee_basis_points: <span class="number">0</span>,</span><br><span class="line">            creators: <span class="literal">None</span>,</span><br><span class="line">            collection: <span class="literal">None</span>,</span><br><span class="line">            uses: <span class="literal">None</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">//第三个参数 false: 是否更新现有元数据账户。</span></span><br><span class="line">		<span class="comment">//第四个参数 true: 是否使用更新权限。</span></span><br><span class="line">		<span class="comment">//第五个参数 None: 可选的额外参数。        </span></span><br><span class="line">		<span class="literal">false</span>,</span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line">        <span class="literal">None</span>,</span><br><span class="line">    )?;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>lib.rs</code> 添加以下内容：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">const</span> AUTH_SEED: &amp;<span class="type">str</span> = <span class="string">&quot;swap_auth_seed&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#[program]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> swap &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">create_token_metadata</span>(ctx: Context&lt;CreateMintAndMetadata&gt;) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">        instructions::<span class="title function_ invoke__">create_token_metadata</span>(ctx)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<p><code>Cargo.toml</code> 文件里面添加以下内容：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[features]</span></span><br><span class="line"><span class="attr">idl-build</span> = [<span class="string">&quot;anchor-lang/idl-build&quot;</span>, <span class="string">&quot;anchor-spl/idl-build&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">anchor-lang</span> = &#123; version = <span class="string">&quot;0.30.1&quot;</span>, features = [<span class="string">&quot;init-if-needed&quot;</span>] &#125;</span><br><span class="line"><span class="attr">anchor-spl</span> = &#123; version = <span class="string">&quot;0.30.1&quot;</span>, features = [<span class="string">&quot;metadata&quot;</span>] &#125;</span><br></pre></td></tr></table></figure>

<p>执行Anchor命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anchor build &amp;&amp; anchor deploy</span><br></pre></td></tr></table></figure>
<h2 id="前端TS测试合约代码："><a href="#前端TS测试合约代码：" class="headerlink" title="前端TS测试合约代码："></a>前端TS测试合约代码：</h2><p>获取本地钱包：<br>anchor&#x2F;example&#x2F;api&#x2F;wallet.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&quot;@coral-xyz/anchor&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Program</span>&#125; <span class="keyword">from</span> <span class="string">&quot;@coral-xyz/anchor&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; swap &#125; <span class="keyword">from</span> <span class="string">&quot;../../target/types/swap&quot;</span>;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> provider = anchor.<span class="property">AnchorProvider</span>.<span class="title function_">env</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;provider:&quot;</span>, provider.<span class="property">wallet</span>.<span class="property">publicKey</span>.<span class="title function_">toBase58</span>());</span><br><span class="line">anchor.<span class="title function_">setProvider</span>(provider);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> program = anchor.<span class="property">workspace</span>.<span class="property">swap</span> <span class="keyword">as</span> <span class="title class_">Program</span>&lt;swap&gt; ;</span><br><span class="line"><span class="keyword">const</span> wallet = provider.<span class="property">wallet</span> <span class="keyword">as</span> anchor.<span class="property">Wallet</span>;</span><br><span class="line"><span class="keyword">const</span> connection = provider.<span class="property">connection</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; program, provider,connection&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义并导出 useDefaultWallet 函数。</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useDefaultWallet</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> anchor.<span class="property">Wallet</span>.<span class="title function_">local</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写测试方法：<br>anchor&#x2F;example&#x2F;api&#x2F;token.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&#x27;@coral-xyz/anchor&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; program &#125; <span class="keyword">from</span> <span class="string">&#x27;./wallet&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这个方法就是lib.rs里的方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createTokenMetadata</span>(<span class="params"><span class="attr">wallet</span>: anchor.<span class="title class_">Wallet</span></span>) &#123;</span><br><span class="line">	</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> program.<span class="property">methods</span></span><br><span class="line">    .<span class="title function_">createTokenMetadata</span>()</span><br><span class="line">    .<span class="title function_">accounts</span>(&#123;</span><br><span class="line">      <span class="attr">payer</span>: wallet.<span class="property">publicKey</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">signers</span>([wallet.<span class="property">payer</span>])</span><br><span class="line">    .<span class="title function_">rpc</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用测试方法：<br>anchor&#x2F;example&#x2F;index.ts&#96;&#96;&#96;</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&#x27;@coral-xyz/anchor&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connection, program, provider, useDefaultWallet &#125; <span class="keyword">from</span> <span class="string">&#x27;./api/wallet&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createTokenMetadata &#125; <span class="keyword">from</span> <span class="string">&#x27;./api/token&#x27;</span>;</span><br><span class="line"></span><br><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">	<span class="comment">// 获取默认钱包</span></span><br><span class="line">	<span class="keyword">const</span> defaultWallet = <span class="title function_">useDefaultWallet</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建token</span></span><br><span class="line">	<span class="keyword">const</span> create_token = <span class="keyword">await</span> <span class="title function_">createTokenMetadata</span>(</span><br><span class="line">		defaultWallet,</span><br><span class="line">   );</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(create_token);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>


<p>执行Anchor命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anchor run api</span><br></pre></td></tr></table></figure>


<p>测试成功后会输出交易的transactions,  可将这个transactions输入到区块链浏览器里，查看交易的具体细节，产生了什么。<br>链接： <a target="_blank" rel="noopener" href="https://explorer.solana.com/">https://explorer.solana.com/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/02/09/Solana-Dex-Admin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2025/02/09/Solana-Dex-Admin/" itemprop="url">Solana 合约开发 - DeFi - Dex 开发二：Admin</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-02-09T17:14:12+08:00">
                2025-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Solana%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91-DeFi-Dex/" itemprop="url" rel="index">
                    <span itemprop="name">Solana合约开发-DeFi-Dex</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本章节介绍如何创建 <code>Admin</code>,<code>Admin</code>或管理员角色通常是指具有特殊权限的账户，用于执行关键操作和维护系统的正常运行。这些操作可能包括但不限于参数调整、紧急情况处理、安全更新等,接下来通过代码一起学习。</p>
<h1 id="合约代码："><a href="#合约代码：" class="headerlink" title="合约代码："></a>合约代码：</h1><p>&#96;anchor&#x2F;programs&#x2F;swap&#x2F;src&#x2F;states&#x2F;admin.rs:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"><span class="keyword">use</span> anchor_spl::token::&#123;<span class="keyword">self</span>, Token, TokenAccount&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[account]</span></span><br><span class="line"><span class="meta">#[derive(InitSpace, Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Admin</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> authority: Pubkey,</span><br><span class="line">    <span class="keyword">pub</span> permissions: <span class="type">u8</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Admin</span> &#123;</span><br><span class="line">	<span class="comment">//通过设置哪位为1来控制权限</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">const</span> PERMISSION_UPDATE_PERMISSIONS: <span class="type">u8</span> = <span class="number">1</span> &lt;&lt; <span class="number">0</span>; <span class="comment">// 00000001</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">const</span> PERMISSION_ADD_POOL: <span class="type">u8</span> = <span class="number">1</span> &lt;&lt; <span class="number">1</span>; <span class="comment">// 00000010</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">const</span> PERMISSION_REMOVE_POOL: <span class="type">u8</span> = <span class="number">1</span> &lt;&lt; <span class="number">2</span>; <span class="comment">// 00000100</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">const</span> PERMISSION_UPDATE_Config: <span class="type">u8</span> = <span class="number">1</span> &lt;&lt; <span class="number">3</span>; <span class="comment">// 00001000</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">const</span> ADMIN_SEED_PREFIX: &amp;<span class="type">str</span> = <span class="string">&quot;admin_v1&quot;</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">init</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, authority: Pubkey, permissions: <span class="type">u8</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span>.authority = authority;</span><br><span class="line">        <span class="keyword">self</span>.permissions = permissions;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">has_permission</span>(&amp;<span class="keyword">self</span>, permission: <span class="type">u8</span>) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.permissions &amp; permission != <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>&#96;anchor&#x2F;programs&#x2F;swap&#x2F;src&#x2F;accounts_all&#x2F;admin.rs</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"><span class="keyword">use</span> crate::states::*;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Accounts)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">InitAdmin</span>&lt;<span class="symbol">&#x27;info</span>&gt; &#123;</span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        init_if_needed,</span></span><br><span class="line"><span class="meta">        payer = authority,</span></span><br><span class="line"><span class="meta">        space = 8 + Admin::INIT_SPACE,</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            Admin::ADMIN_SEED_PREFIX.as_bytes(),</span></span><br><span class="line"><span class="meta">            authority.key().as_ref(),</span></span><br><span class="line"><span class="meta">        ]</span>, </span><br><span class="line">        bump,</span><br><span class="line">        </span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> admin: <span class="type">Box</span>&lt;Account&lt;<span class="symbol">&#x27;info</span>, Admin&gt;&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[account(mut)]</span></span><br><span class="line">    <span class="keyword">pub</span> authority: Signer&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line">    <span class="keyword">pub</span> system_program: Program&lt;<span class="symbol">&#x27;info</span>, System&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Accounts)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">UpdatePermissions</span>&lt;<span class="symbol">&#x27;info</span>&gt; &#123;</span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        mut, </span></span><br><span class="line"><span class="meta">    )]</span></span><br><span class="line">    <span class="keyword">pub</span> admin: <span class="type">Box</span>&lt;Account&lt;<span class="symbol">&#x27;info</span>, Admin&gt;&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[account(mut)]</span></span><br><span class="line">    <span class="keyword">pub</span> authority: Signer&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line">    <span class="keyword">pub</span> system_program: Program&lt;<span class="symbol">&#x27;info</span>, System&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Accounts)]</span></span><br><span class="line"><span class="meta">#[instruction(index: u16)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">UpdateAmmConfig</span>&lt;<span class="symbol">&#x27;info</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[account(mut)]</span></span><br><span class="line">    <span class="keyword">pub</span> owner: Signer&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 讲下Box，使用 Box 可以让你在堆上分配这些数据，而不是直接在栈上，从而避免栈溢出等问题，当然不用Box也不是不行。</span></span><br><span class="line">	<span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        mut, </span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            Admin::ADMIN_SEED_PREFIX.as_bytes(),</span></span><br><span class="line"><span class="meta">            owner.key().as_ref(),          </span></span><br><span class="line"><span class="meta">        ]</span>, </span><br><span class="line">        bump,</span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> admin: <span class="type">Box</span>&lt;Account&lt;<span class="symbol">&#x27;info</span>, Admin&gt;&gt;,</span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line">    </span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        mut,</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            AmmConfig::CONFIG_PREFIX_SEED.as_bytes(),</span></span><br><span class="line"><span class="meta">            &amp;index.to_be_bytes()</span></span><br><span class="line"><span class="meta">        ]</span>,</span><br><span class="line">        bump,</span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> config: AccountLoader&lt;<span class="symbol">&#x27;info</span>, AmmConfig&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// CHECK: pool vault and lp mint authority</span></span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        init,</span></span><br><span class="line"><span class="meta">        payer = owner,</span></span><br><span class="line"><span class="meta">        space = AUTHORITY_SPACE,</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            crate::AUTH_SEED.as_bytes(),</span></span><br><span class="line"><span class="meta">        ]</span>,</span><br><span class="line">        bump,</span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> authority: UncheckedAccount&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> system_program: Program&lt;<span class="symbol">&#x27;info</span>, System&gt;,</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cell::RefMut;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::accounts_all::*;</span><br><span class="line"><span class="keyword">use</span> crate::calculate::*;</span><br><span class="line"><span class="keyword">use</span> crate::error::ErrorCode;</span><br><span class="line"><span class="keyword">use</span> crate::states::AmmConfig;</span><br><span class="line"><span class="keyword">use</span> crate::states::*;</span><br><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(AnchorSerialize, AnchorDeserialize, Clone, PartialEq, Eq)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">ConfigValue</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Bool</span>(<span class="type">bool</span>),</span><br><span class="line">    <span class="title function_ invoke__">U64</span>(<span class="type">u64</span>),</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 初始化管理员</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">init_admin</span>(ctx: Context&lt;InitAdmin&gt;, permissions: <span class="type">u8</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">admin</span> = &amp;<span class="keyword">mut</span> ctx.accounts.admin;</span><br><span class="line">    <span class="keyword">if</span> admin.authority != Pubkey::<span class="title function_ invoke__">default</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(error!(ErrorCode::AlreadyInitialized));</span><br><span class="line">    &#125;</span><br><span class="line">    admin.<span class="title function_ invoke__">init</span>(*ctx.accounts.authority.key, permissions)?;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新管理员权限</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">update_admin_permissions</span>(</span><br><span class="line">    ctx: Context&lt;UpdatePermissions&gt;,</span><br><span class="line">    new_permissions: <span class="type">u8</span>,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">admin</span> = &amp;<span class="keyword">mut</span> ctx.accounts.admin;</span><br><span class="line">    <span class="comment">//判断权限</span></span><br><span class="line">    <span class="keyword">if</span> !admin.<span class="title function_ invoke__">has_permission</span>(<span class="number">1</span> &lt;&lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(error!(ErrorCode::Unauthorized));</span><br><span class="line">    &#125;</span><br><span class="line">    admin.permissions = new_permissions;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//更新AMM配置</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">update_amm_config</span>(ctx: Context&lt;UpdateAmmConfig&gt;, num: <span class="type">u8</span>, value: <span class="type">u64</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">admin</span> = &amp;ctx.accounts.admin;</span><br><span class="line">    <span class="comment">//判断权限</span></span><br><span class="line">    <span class="keyword">if</span> !admin.<span class="title function_ invoke__">has_permission</span>(<span class="number">1</span> &lt;&lt; <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(error!(ErrorCode::Unauthorized));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">amm_config</span> = ctx.accounts.config.<span class="title function_ invoke__">load_mut</span>()?;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">match_num</span> = <span class="title function_ invoke__">Some</span>(num);</span><br><span class="line">    <span class="keyword">match</span> match_num &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="number">0</span>) =&gt; <span class="title function_ invoke__">update_amm_trade_fee_rate</span>(&amp;<span class="keyword">mut</span> amm_config, value),</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="number">1</span>) =&gt; <span class="title function_ invoke__">update_amm_protocol_fee_rate</span>(&amp;<span class="keyword">mut</span> amm_config, value),</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="number">2</span>) =&gt; <span class="title function_ invoke__">update_amm_fund_fee_rate</span>(&amp;<span class="keyword">mut</span> amm_config, value),</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="number">3</span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">new_procotol_owner</span> = *ctx.remaining_accounts.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">next</span>().<span class="title function_ invoke__">unwrap</span>().key;</span><br><span class="line">            <span class="title function_ invoke__">set_amm_new_protocol_owner</span>(&amp;<span class="keyword">mut</span> amm_config, new_procotol_owner)?;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="number">4</span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">new_fund_owner</span> = *ctx.remaining_accounts.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">next</span>().<span class="title function_ invoke__">unwrap</span>().key;</span><br><span class="line">            <span class="title function_ invoke__">set_amm_new_fund_owner</span>(&amp;<span class="keyword">mut</span> amm_config, new_fund_owner)?;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="number">5</span>) =&gt; amm_config.create_pool_fee = value,</span><br><span class="line">        _ =&gt; <span class="keyword">return</span> err!(ErrorCode::InvalidInput),</span><br><span class="line">        <span class="comment">//以此类推，以后还能继续扩展下去</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">update_amm_protocol_fee_rate</span>(amm_config: &amp;<span class="keyword">mut</span> RefMut&lt;AmmConfig&gt;, protocol_fee_rate: <span class="type">u64</span>) &#123;</span><br><span class="line">    <span class="built_in">assert!</span>(protocol_fee_rate &lt;= FEE_RATE_VALUE);</span><br><span class="line">    <span class="built_in">assert!</span>(protocol_fee_rate + amm_config.fund_fee_rate &lt;= FEE_RATE_VALUE);</span><br><span class="line">    amm_config.protocol_fee_rate = protocol_fee_rate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">update_amm_trade_fee_rate</span>(amm_config: &amp;<span class="keyword">mut</span> RefMut&lt;AmmConfig&gt;, trade_fee_rate: <span class="type">u64</span>) &#123;</span><br><span class="line">    <span class="built_in">assert!</span>(trade_fee_rate &lt; FEE_RATE_VALUE);</span><br><span class="line">    amm_config.trade_fee_rate = trade_fee_rate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">update_amm_fund_fee_rate</span>(amm_config: &amp;<span class="keyword">mut</span> RefMut&lt;AmmConfig&gt;, fund_fee_rate: <span class="type">u64</span>) &#123;</span><br><span class="line">    <span class="built_in">assert!</span>(fund_fee_rate &lt;= FEE_RATE_VALUE);</span><br><span class="line">    <span class="built_in">assert!</span>(fund_fee_rate + amm_config.protocol_fee_rate &lt;= FEE_RATE_VALUE);</span><br><span class="line">    amm_config.fund_fee_rate = fund_fee_rate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">set_amm_new_protocol_owner</span>(amm_config: &amp;<span class="keyword">mut</span> RefMut&lt;AmmConfig&gt;, new_owner: Pubkey) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    require_keys_neq!(new_owner, Pubkey::<span class="title function_ invoke__">default</span>());</span><br><span class="line">    amm_config.protocol_owner = new_owner;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">set_amm_new_fund_owner</span>(</span><br><span class="line">    amm_config: &amp;<span class="keyword">mut</span> RefMut&lt;AmmConfig&gt;,</span><br><span class="line">    new_fund_owner: Pubkey,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line"></span><br><span class="line">    require_keys_neq!(new_fund_owner, Pubkey::<span class="title function_ invoke__">default</span>());</span><br><span class="line">    amm_config.fund_owner = new_fund_owner;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义了一些错误提示：<br>anchor&#x2F;programs&#x2F;swap&#x2F;src&#x2F;error.rs：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[error_code]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">ErrorCode</span> &#123;</span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Not approved&quot;</span>)]</span></span><br><span class="line">    NotApproved,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Input account owner is not the program address&quot;</span>)]</span></span><br><span class="line">    InvalidOwner,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Input token account empty,please provide more token&quot;</span>)]</span></span><br><span class="line">    EmptySupply,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;InvalidInput&quot;</span>)]</span></span><br><span class="line">    InvalidInput,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Address of the provided lp token mint is incorrect&quot;</span>)]</span></span><br><span class="line">    IncorrectLpMint,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Exceeds desired slippage limit&quot;</span>)]</span></span><br><span class="line">    ExceededSlippage,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Given pool token amount results in zero trading tokens&quot;</span>)]</span></span><br><span class="line">    ZeroTradingTokens,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Not support token_2022 mint extension&quot;</span>)]</span></span><br><span class="line">    NotSupportMint,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;invaild vault&quot;</span>)]</span></span><br><span class="line">    InvalidVault,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Init lp amount is too less(Because 100 amount lp will be locked)&quot;</span>)]</span></span><br><span class="line">    InitLpAmountTooLess,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Unauthorized access&quot;</span>)]</span></span><br><span class="line">    Unauthorized,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;The Admin account already initialized&quot;</span>)]</span></span><br><span class="line">    AlreadyInitialized,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;AMM ouput price is too low than oracle price&quot;</span>)]</span></span><br><span class="line">    InvalidArgument,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;PDA is invalid&quot;</span>)]</span></span><br><span class="line">    InvalidPDA,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Lack of necessary accounts&quot;</span>)]</span></span><br><span class="line">    InvalidAccounts,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Insufficient balance&quot;</span>)]</span></span><br><span class="line">    InsufficientBalance,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;No Price Available&quot;</span>)]</span></span><br><span class="line">    NoPriceAvailable,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Calculation Overflow&quot;</span>)]</span></span><br><span class="line">    CalculationOverflow,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Invaild Token&quot;</span>)]</span></span><br><span class="line">    InvalidToken,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Invaild PoolState&quot;</span>)]</span></span><br><span class="line">    InvalidPoolState,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 新增错误代码</span></span><br><span class="line">    <span class="meta">#[msg(<span class="string">&quot;Invalid seeds provided for PDA&quot;</span>)]</span></span><br><span class="line">    InvalidSeeds,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行Anchor命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anchor build &amp;&amp; anchor deploy</span><br></pre></td></tr></table></figure>

<h1 id="前端TS测试代码："><a href="#前端TS测试代码：" class="headerlink" title="前端TS测试代码："></a>前端TS测试代码：</h1><p>获取本地钱包：<br><code>anchor/example/api/wallet.ts</code>:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&quot;@coral-xyz/anchor&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Program</span>&#125; <span class="keyword">from</span> <span class="string">&quot;@coral-xyz/anchor&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; swap &#125; <span class="keyword">from</span> <span class="string">&quot;../../target/types/swap&quot;</span>;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> provider = anchor.<span class="property">AnchorProvider</span>.<span class="title function_">env</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;provider:&quot;</span>, provider.<span class="property">wallet</span>.<span class="property">publicKey</span>.<span class="title function_">toBase58</span>());</span><br><span class="line">anchor.<span class="title function_">setProvider</span>(provider);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> program = anchor.<span class="property">workspace</span>.<span class="property">swap</span> <span class="keyword">as</span> <span class="title class_">Program</span>&lt;swap&gt; ;</span><br><span class="line"><span class="keyword">const</span> wallet = provider.<span class="property">wallet</span> <span class="keyword">as</span> anchor.<span class="property">Wallet</span>;</span><br><span class="line"><span class="keyword">const</span> connection = provider.<span class="property">connection</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; program, provider,connection&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义并导出 useDefaultWallet 函数。</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useDefaultWallet</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> anchor.<span class="property">Wallet</span>.<span class="title function_">local</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写测试方法：<br>&#96;anchor&#x2F;example&#x2F;api&#x2F;admin.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&#x27;@coral-xyz/anchor&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; program &#125; <span class="keyword">from</span> <span class="string">&#x27;./wallet&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化Admin</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">initAdmin</span>(<span class="params"><span class="attr">wallet</span>: anchor.<span class="title class_">Wallet</span>, <span class="attr">permission</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [adminPda] = anchor.<span class="property">web3</span>.<span class="property">PublicKey</span>.<span class="title function_">findProgramAddressSync</span>(</span><br><span class="line">    [<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;admin_v1&#x27;</span>), wallet.<span class="property">publicKey</span>.<span class="title function_">toBuffer</span>()],</span><br><span class="line">    program.<span class="property">programId</span>,</span><br><span class="line">  );</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;admin Pda is:&#x27;</span>, adminPda.<span class="title function_">toString</span>());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    adminPda,</span><br><span class="line">    <span class="keyword">await</span> program.<span class="property">methods</span></span><br><span class="line">      .<span class="title function_">initAdmin</span>(permission)</span><br><span class="line">      .<span class="title function_">accounts</span>(&#123;</span><br><span class="line">        <span class="attr">authority</span>: wallet.<span class="property">publicKey</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">signers</span>([wallet.<span class="property">payer</span>])</span><br><span class="line">      .<span class="title function_">rpc</span>(),</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取Admin数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getAdmin</span>(<span class="params"><span class="attr">wallet</span>: anchor.<span class="title class_">Wallet</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [adminPda] = anchor.<span class="property">web3</span>.<span class="property">PublicKey</span>.<span class="title function_">findProgramAddressSync</span>(</span><br><span class="line">    [<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;admin_v1&#x27;</span>), wallet.<span class="property">publicKey</span>.<span class="title function_">toBuffer</span>()],</span><br><span class="line">    program.<span class="property">programId</span>,</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> program.<span class="property">account</span>.<span class="property">admin</span>.<span class="title function_">fetch</span>(adminPda);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//更新Admin权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">updateAdmin</span>(<span class="params"><span class="attr">wallet</span>: anchor.<span class="title class_">Wallet</span>, <span class="attr">permission</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> [adminPda] = anchor.<span class="property">web3</span>.<span class="property">PublicKey</span>.<span class="title function_">findProgramAddressSync</span>(</span><br><span class="line">	    [<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;admin_v1&#x27;</span>), wallet.<span class="property">publicKey</span>.<span class="title function_">toBuffer</span>()],</span><br><span class="line">	    program.<span class="property">programId</span>,</span><br><span class="line">	  );</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> program.<span class="property">methods</span></span><br><span class="line">    .<span class="title function_">updateAdminPermissions</span>(permission)</span><br><span class="line">    .<span class="title function_">accounts</span>(&#123;</span><br><span class="line">      <span class="attr">authority</span>: wallet.<span class="property">publicKey</span>,</span><br><span class="line">      <span class="attr">admin</span>: adminPda,</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">signers</span>([wallet.<span class="property">payer</span>])</span><br><span class="line">    .<span class="title function_">rpc</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//至于更新 AmmConfig，则在上一节 Config 的代码中</span></span><br></pre></td></tr></table></figure>


<p>调用测试方法：<br><code>anchor/example/index.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&#x27;@coral-xyz/anchor&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connection, program, provider, useDefaultWallet &#125; <span class="keyword">from</span> <span class="string">&#x27;./api/wallet&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; initAdmin, updateAdmin, getAdmin &#125; <span class="keyword">from</span> <span class="string">&#x27;./api/admin&#x27;</span>;</span><br><span class="line"></span><br><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">	<span class="comment">// 获取默认钱包</span></span><br><span class="line">	<span class="keyword">const</span> defaultWallet = <span class="title function_">useDefaultWallet</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//初始化管理员</span></span><br><span class="line">  <span class="keyword">const</span> [init_admin] = <span class="keyword">await</span> <span class="title function_">initAdmin</span>(defaultWallet, <span class="number">1</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(init_admin);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取管理员对象信息</span></span><br><span class="line">  <span class="keyword">const</span> admin = <span class="keyword">await</span> <span class="title function_">getAdmin</span>(defaultWallet);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;admin is&#x27;</span>, admin);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//更新管理员权限</span></span><br><span class="line">  <span class="keyword">const</span> update_admin = <span class="keyword">await</span> <span class="title function_">updateAdmin</span>(defaultWallet, <span class="number">8</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(update_admin);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>执行Anchor命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anchor run api</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/02/09/Solana%20-%20Dex%20config%20%E5%BC%80%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2025/02/09/Solana%20-%20Dex%20config%20%E5%BC%80%E5%8F%91/" itemprop="url">Solana 合约开发 - DeFi - Dex 开发一：Config</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-02-09T15:02:36+08:00">
                2025-02-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Solana%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91-DeFi-Dex/" itemprop="url" rel="index">
                    <span itemprop="name">Solana合约开发-DeFi-Dex</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一个Dex 会涉及到许多模块，例如用户创建、流动性池创建、监视器创建、管理员创建、SWAP等，接下来会一一讲解，首先讲下 <code>Config</code> 模块。</p>
<p>在创建AMM 的流动型池之前，我们需要先编写 config，通常用于配置和管理AMM相关参数的一组工具或接口。这些参数对于决定流动性池的行为、交易费用、价格发现机制等至关重要，接下来一起看看代码。</p>
<h1 id="合约代码："><a href="#合约代码：" class="headerlink" title="合约代码："></a>合约代码：</h1><p><code>anchor/programs/swap/src/states/config.rs:</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义 AmmConfig账户</span></span><br><span class="line"><span class="meta">#[account]</span></span><br><span class="line"><span class="meta">#[derive(InitSpace,Default,Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">AmmConfig</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> bump: <span class="type">u8</span>,   <span class="comment">//用于生成程序派生地址（PDA）时避免冲突。</span></span><br><span class="line">    <span class="keyword">pub</span> trade_fee_rate: <span class="type">u64</span>, <span class="comment">//交易手续费率，表示每笔交易中收取的费用比例。</span></span><br><span class="line">    <span class="keyword">pub</span> create_pool_fee: <span class="type">u64</span>, <span class="comment">//创建一个新的流动性池时需要支付的一次性费用。</span></span><br><span class="line">    <span class="keyword">pub</span> protocol_fee_rate: <span class="type">u64</span>, <span class="comment">//协议级别的费用比率，可能用于支持协议的发展或维护。</span></span><br><span class="line">    <span class="keyword">pub</span> protocol_owner: Pubkey, <span class="comment">//协议所有者的公钥，通常是接收协议级别费用的账户。</span></span><br><span class="line">    <span class="keyword">pub</span> fund_fee_rate: <span class="type">u64</span>, <span class="comment">//指向基金或其他资金池的费用比率。   </span></span><br><span class="line">    <span class="keyword">pub</span> fund_owner: Pubkey, <span class="comment">//基金或其他资金池的所有者公钥，</span></span><br><span class="line">    <span class="keyword">pub</span> index: <span class="type">u16</span>, <span class="comment">//一个标识符，可能用于区分不同的 AMM 配置实例。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">AmmConfig</span> &#123;</span><br><span class="line">	<span class="keyword">pub</span> <span class="keyword">const</span> CONFIG_PREFIX_SEED: &amp;<span class="type">str</span> = <span class="string">&quot;amm_config&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//使用 1_000_000 作为分母，可以将费率表示为百万分之一的单位。例如，3000 对应 3000 / 1_000_000 = 0.003，即 0.3%。</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">const</span> FEE_RATE_VALUE: <span class="type">u64</span> = <span class="number">1_000_000</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">get_amm_config_key</span>(index: <span class="type">u16</span>) <span class="punctuation">-&gt;</span> Pubkey &#123;</span><br><span class="line">        <span class="comment">// 计算池子状态账户的PDA</span></span><br><span class="line">        Pubkey::<span class="title function_ invoke__">find_program_address</span>(</span><br><span class="line">            &amp;[<span class="keyword">Self</span>::CONFIG_PREFIX_SEED.<span class="title function_ invoke__">as_bytes</span>(), &amp;index.<span class="title function_ invoke__">to_be_bytes</span>()],</span><br><span class="line">            &amp;crate::ID,</span><br><span class="line">        )</span><br><span class="line">        .<span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>anchor/programs/swap/src/accounts_all/config.rs</code>：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"><span class="keyword">use</span> crate::states::*;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Accounts)]</span></span><br><span class="line"><span class="meta">#[instruction(index: u16)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">CreateAmmConfig</span>&lt;<span class="symbol">&#x27;info</span>&gt; &#123;</span><br><span class="line">	<span class="comment">//初始化amm_config账户，space使用了INIT_SPACE自动计算所需要的空间，需要上面states目录文件derive支持</span></span><br><span class="line">	<span class="comment">// 而 &quot;8 +&quot; 是因为Solana 账户有一个 8 字节的头部用于存储账户的分配大小和其他元数据</span></span><br><span class="line">	<span class="comment">// seeds里面使用 &amp;index 是为了区分账户，毕竟多个index会有多个config账户</span></span><br><span class="line">	<span class="comment">// 这里使用 AccountLoader 以后单开一篇再讲</span></span><br><span class="line">	<span class="comment">// &amp;index是引用instruction里面的index，也就是动态获取index</span></span><br><span class="line">	<span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        init,</span></span><br><span class="line"><span class="meta">        payer = owner,</span></span><br><span class="line"><span class="meta">        space = 8+ AmmConfig::INIT_SPACE,</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            AmmConfig::CONFIG_PREFIX_SEED.as_bytes(),</span></span><br><span class="line"><span class="meta">            //&amp;index.to_be_bytes() 是 Rust 中的一个表达式，用于将一个整数（如 u16、u32 等）转换为大端序（Big-Endian）的字节数组,从小到大排序，8个字节为1位，u16即为2位，如果index=1,则为&amp;[0, 1]</span></span><br><span class="line">            &amp;index.<span class="title function_ invoke__">to_be_bytes</span>(),       </span><br><span class="line">        ],</span><br><span class="line">        bump,</span><br><span class="line">        </span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> amm_config: Account&lt;<span class="symbol">&#x27;info</span>, AmmConfig&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[account(mut)]</span></span><br><span class="line">    <span class="keyword">pub</span> owner: Signer&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> system_program: Program&lt;<span class="symbol">&#x27;info</span>, System&gt;,</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>&#96;anchor&#x2F;programs&#x2F;swap&#x2F;src&#x2F;instructions&#x2F;config.rs:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::accounts_all::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置amm参数,创建amm_config</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">create_amm_config</span>(</span><br><span class="line">    ctx: Context&lt;CreateAmmConfig&gt;,</span><br><span class="line">    index: <span class="type">u16</span>,</span><br><span class="line">    trade_fee_rate: <span class="type">u64</span>,</span><br><span class="line">    protocol_fee_rate: <span class="type">u64</span>,</span><br><span class="line">    create_pool_fee: <span class="type">u64</span>,</span><br><span class="line">    fund_fee_rate: <span class="type">u64</span>,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">config</span> = ctx.accounts.amm_config.<span class="title function_ invoke__">deref_mut</span>();</span><br><span class="line">    config.protocol_owner = ctx.accounts.owner.<span class="title function_ invoke__">key</span>();</span><br><span class="line">    config.bump = ctx.bumps.amm_config;</span><br><span class="line">    config.trade_fee_rate = trade_fee_rate;</span><br><span class="line">    config.protocol_fee_rate = protocol_fee_rate;</span><br><span class="line">    config.create_pool_fee = create_pool_fee;</span><br><span class="line">    config.fund_fee_rate = fund_fee_rate;</span><br><span class="line">    config.fund_owner = ctx.accounts.owner.<span class="title function_ invoke__">key</span>();</span><br><span class="line">    config.index = index;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">注意！！！这里有个超级大坑：</span><br><span class="line"><span class="meta">#[instruction(index: u16)]</span>不单要参数匹配，还要顺序匹配，也就`index`的位置必须放在create_amm_config方法的第一位，如果不在第一位，哪怕instruction里面写的是index,也会读取到其他第一位的值，例如trade_fee_rate，然后传入到instruction到seeds里面，生成错误的PDA，导致初始化账户一直出现种子冲突问题。</span><br></pre></td></tr></table></figure>

<p><code>lib.rs </code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pub mod 里面添加以下代码：</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">create_amm_config</span>(</span><br><span class="line">        ctx: Context&lt;CreateAmmConfig&gt;,</span><br><span class="line">        index: <span class="type">u16</span>,</span><br><span class="line">        trade_fee_rate: <span class="type">u64</span>,</span><br><span class="line">        protocol_fee_rate: <span class="type">u64</span>,</span><br><span class="line">        fund_fee_rate: <span class="type">u64</span>,</span><br><span class="line">        create_pool_fee: <span class="type">u64</span>,       </span><br><span class="line">    ) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">        <span class="built_in">assert!</span>(trade_fee_rate &lt; AmmConfig::FEE_RATE_VALUE);</span><br><span class="line">        <span class="built_in">assert!</span>(protocol_fee_rate &lt;= AmmConfig::FEE_RATE_VALUE);</span><br><span class="line">        <span class="built_in">assert!</span>(fund_fee_rate &lt;= AmmConfig::FEE_RATE_VALUE);</span><br><span class="line">        <span class="built_in">assert!</span>(fund_fee_rate + protocol_fee_rate &lt;= AmmConfig::FEE_RATE_VALUE);</span><br><span class="line">        instructions::<span class="title function_ invoke__">create_amm_config</span>(</span><br><span class="line">            ctx,</span><br><span class="line">            index,</span><br><span class="line">            trade_fee_rate,</span><br><span class="line">            protocol_fee_rate,</span><br><span class="line">            fund_fee_rate,</span><br><span class="line">            create_pool_fee,</span><br><span class="line">            </span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">注意！！！这里有个超级大坑：</span><br><span class="line"><span class="meta">#[instruction(index: u16)]</span>不单要参数匹配，还要顺序匹配，也就`index`的位置必须放在create_amm_config方法的第一位，如果不在第一位，哪怕instruction里面写的是index,也会读取到其他第一位的值，例如trade_fee_rate，然后传入到instruction到seeds里面，生成错误的PDA，导致初始化账户一直出现种子冲突问题。</span><br></pre></td></tr></table></figure>

<p>执行Anchor命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anchor build &amp;&amp; anchor deploy</span><br></pre></td></tr></table></figure>



<h1 id="前端TS测试代码："><a href="#前端TS测试代码：" class="headerlink" title="前端TS测试代码："></a>前端TS测试代码：</h1><p>获取本地钱包：<br><code>anchor/example/api/wallet.ts</code>:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&quot;@coral-xyz/anchor&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Program</span>&#125; <span class="keyword">from</span> <span class="string">&quot;@coral-xyz/anchor&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; swap &#125; <span class="keyword">from</span> <span class="string">&quot;../../target/types/swap&quot;</span>;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> provider = anchor.<span class="property">AnchorProvider</span>.<span class="title function_">env</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;provider:&quot;</span>, provider.<span class="property">wallet</span>.<span class="property">publicKey</span>.<span class="title function_">toBase58</span>());</span><br><span class="line">anchor.<span class="title function_">setProvider</span>(provider);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> program = anchor.<span class="property">workspace</span>.<span class="property">swap</span> <span class="keyword">as</span> <span class="title class_">Program</span>&lt;swap&gt; ;</span><br><span class="line"><span class="keyword">const</span> wallet = provider.<span class="property">wallet</span> <span class="keyword">as</span> anchor.<span class="property">Wallet</span>;</span><br><span class="line"><span class="keyword">const</span> connection = provider.<span class="property">connection</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; program, provider,connection&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义并导出 useDefaultWallet 函数。</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useDefaultWallet</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> anchor.<span class="property">Wallet</span>.<span class="title function_">local</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&#x27;@coral-xyz/anchor&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; program &#125; <span class="keyword">from</span> <span class="string">&#x27;./wallet&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">BN</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;bn.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PublicKey</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@solana/web3.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建AmmConfig</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createAmmConfig</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">wallet</span>: anchor.<span class="title class_">Wallet</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">trade_fee_rate</span>: <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">protocol_fee_rate</span>: <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">fund_fee_rate</span>: <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">create_pool_fee</span>: <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">index</span>: <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> [ammConfigPda, bump] = <span class="keyword">await</span> <span class="title class_">PublicKey</span>.<span class="title function_">findProgramAddress</span>(</span><br><span class="line">	    [</span><br><span class="line">	    <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;amm_config&#x27;</span>), <span class="comment">//必须要与合约里面定义的种子前缀一样</span></span><br><span class="line">	    <span class="title function_">u16ToBytes</span>(index)   </span><br><span class="line">	    ],</span><br><span class="line">	    program.<span class="property">programId</span>,</span><br><span class="line">	  );</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">await</span> program.<span class="property">methods</span></span><br><span class="line">    .<span class="title function_">createAmmConfig</span>(</span><br><span class="line">	  index, <span class="comment">//u16使用number类型就好，不需要BN</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title function_">BN</span>(trade_fee_rate), <span class="comment">// 转换为 BN 类型 ,因为合约参数使用了u64，数值较大</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title function_">BN</span>(protocol_fee_rate), <span class="comment">// 转换为 BN 类型</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title function_">BN</span>(fund_fee_rate), <span class="comment">// 转换为 BN 类型</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title function_">BN</span>(create_pool_fee), <span class="comment">// 转换为 BN 类型     </span></span><br><span class="line">    )</span><br><span class="line">    .<span class="title function_">accounts</span>(&#123;</span><br><span class="line">	  <span class="attr">ammConfig</span>: ammConfigPda,</span><br><span class="line">	  <span class="attr">owner</span>: wallet.<span class="property">publicKey</span>,</span><br><span class="line">    &#125; <span class="keyword">as</span> <span class="built_in">never</span> )</span><br><span class="line">    .<span class="title function_">signers</span>([wallet.<span class="property">payer</span>])</span><br><span class="line">    .<span class="title function_">rpc</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//更新 AmmConfig，暂时不用管，因为还没创建admin账户，这个后面还会讲</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">updateAmmConfig</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">wallet</span>: anchor.<span class="title class_">Wallet</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">num</span>: <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">value</span>: <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">index</span>: <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [adminPda] = anchor.<span class="property">web3</span>.<span class="property">PublicKey</span>.<span class="title function_">findProgramAddressSync</span>(</span><br><span class="line">    [<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;admin_v1&#x27;</span>), wallet.<span class="property">publicKey</span>.<span class="title function_">toBuffer</span>()],</span><br><span class="line">    program.<span class="property">programId</span>,</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [ammConfigPda, bump] = <span class="keyword">await</span> <span class="title class_">PublicKey</span>.<span class="title function_">findProgramAddress</span>(</span><br><span class="line">    [<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;amm_config&#x27;</span>), <span class="title function_">u16ToBytes</span>(index)],</span><br><span class="line">    program.<span class="property">programId</span>,</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> program.<span class="property">methods</span></span><br><span class="line">    .<span class="title function_">updateAmmConfig</span>(num, <span class="keyword">new</span> <span class="title function_">BN</span>(value))</span><br><span class="line">    .<span class="title function_">accounts</span>(&#123;</span><br><span class="line">      <span class="attr">owner</span>: wallet.<span class="property">publicKey</span>,</span><br><span class="line">      <span class="attr">admin</span>: adminPda,</span><br><span class="line">      <span class="attr">ammConfig</span>: ammConfigPda,</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">signers</span>([wallet.<span class="property">payer</span>])</span><br><span class="line">    .<span class="title function_">rpc</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取 AmmConfig配置信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getAmmConfig</span>(<span class="params"><span class="attr">index</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [ammConfigPda, bump] = <span class="keyword">await</span> <span class="title class_">PublicKey</span>.<span class="title function_">findProgramAddress</span>(</span><br><span class="line">	    [</span><br><span class="line">	    <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;amm_config&#x27;</span>), <span class="comment">//必须要与合约里面定义的种子前缀一样</span></span><br><span class="line">	    <span class="title function_">u16ToBytes</span>(index)   </span><br><span class="line">	    ],</span><br><span class="line">	    program.<span class="property">programId</span>,</span><br><span class="line">	  );</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ammConfig Pda is:&#x27;</span>, ammConfigPda.<span class="title function_">toString</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">//fetch 方法用于从链上获取账户的数据，并将其反序列化为指定的 Rust 结构体,从链上获取一个特定的 AMM 配置账户（ammConfig）的数据。	</span></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">await</span> program.<span class="property">account</span>.<span class="property">ammConfig</span>.<span class="title function_">fetch</span>(ammConfigPda);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将number转换为u16字节数组，对应 &amp;index.to_be_bytes()</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">u16ToBytes</span>(<span class="params"><span class="attr">num</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> arr = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">2</span>);</span><br><span class="line">  <span class="keyword">const</span> view = <span class="keyword">new</span> <span class="title class_">DataView</span>(arr);</span><br><span class="line">  view.<span class="title function_">setUint16</span>(<span class="number">0</span>, num, <span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(arr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用测试方法：<br><code>anchor/example/index.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&#x27;@coral-xyz/anchor&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connection, program, provider, useDefaultWallet &#125; <span class="keyword">from</span> <span class="string">&#x27;./api/wallet&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createAmmConfig, getAmmConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;./api/config&#x27;</span>;</span><br><span class="line"></span><br><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">	<span class="comment">// 获取默认钱包</span></span><br><span class="line">	<span class="keyword">const</span> defaultWallet = <span class="title function_">useDefaultWallet</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建config</span></span><br><span class="line">  <span class="keyword">const</span> amm_config = <span class="keyword">await</span> <span class="title function_">createAmmConfig</span>(defaultWallet, <span class="number">3_000</span>, <span class="number">3_000</span>, <span class="number">3_000</span>, <span class="number">3_000</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(amm_config); <span class="comment">//会输出trancsations</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//获取config具体信息</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">AmmConfig</span> = <span class="keyword">await</span> <span class="title function_">getAmmConfig</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get_amm_config is&#x27;</span>, <span class="title class_">AmmConfig</span>); <span class="comment">//输出具体配置</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//更新config，需要admin章节创建admin后才能使用</span></span><br><span class="line">  <span class="keyword">const</span> updateConfig = <span class="keyword">await</span> <span class="title function_">updateAmmConfig</span>(defaultWallet, <span class="number">0</span>, <span class="number">4_000</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;updateAmmConfig is&#x27;</span>, updateConfig);</span><br></pre></td></tr></table></figure>

<p>执行Anchor命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anchor run api</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/02/08/Solana%20%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91%20-%20DeFi%20%20%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2025/02/08/Solana%20%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91%20-%20DeFi%20%20%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" itemprop="url">Solana 合约开发 - DeFi  基础概念</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2025-02-08T23:29:26+08:00">
                2025-02-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Solana%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91-DeFi-Dex/" itemprop="url" rel="index">
                    <span itemprop="name">Solana合约开发-DeFi-Dex</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="什么是DeFi？"><a href="#什么是DeFi？" class="headerlink" title="什么是DeFi？"></a>什么是DeFi？</h1><p>去中心化金融（Decentralized Finance，简称 DeFi）是基于区块链技术，构建的一系列金融服务和产品的总称。与传统的中心化金融系统不同，DeFi 平台运行在区块链上，不依赖于银行、公司等中介机构来提供服务。这意味着用户可以直接通过这些平台进行借贷、交易、储蓄、投资等活动，享受更高的透明度、控制权以及更低的进入门槛。</p>
<h2 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h2><p><strong>无需许可</strong>：任何人都可以使用 DeFi 应用程序，无需经过任何机构的审批或同意。<br><strong>去中心化</strong>：没有单一的控制点，而是由智能合约自动执行规则，减少了人为干预的风险。<br><strong>透明性</strong>：所有交易都是公开透明的，并记录在区块链上，任何人都可以查看。<br><strong>可访问性</strong>：只要有互联网连接，全球任何人都能访问 DeFi 服务，不受地域限制。<br><strong>创新性</strong>：提供了传统金融体系中难以实现的新产品和服务，比如流动性挖矿、闪贷等。</p>
<h2 id="常见的DeFi服务："><a href="#常见的DeFi服务：" class="headerlink" title="常见的DeFi服务："></a>常见的DeFi服务：</h2><p><strong>借贷平台</strong>：如 Compound 和 Aave，允许用户存入资金赚取利息，或者抵押资产借出其他类型的代币。<br><strong>去中心化交易所（DEXs）</strong>：例如 Uniswap 和 SushiSwap，让用户直接从自己的钱包交换加密货币，无需通过中心化的交易所。<br><strong>稳定币</strong>：像 DAI 这样的去中心化稳定币，旨在保持价值相对稳定，通常与美元挂钩。<br><strong>收益农业（Yield Farming）</strong>：通过将资产存入特定协议来获得奖励，通常是该协议的治理代币。</p>
<h1 id="什么是-AMM？"><a href="#什么是-AMM？" class="headerlink" title="什么是 AMM？"></a>什么是 AMM？</h1><p>自动做市商（Automated Market Maker，简称 AMM）是去中心化金融（DeFi）领域中一种用于在去中心化交易所（DEXs）上实现资产交易的机制。与传统的订单簿模式不同，AMM 不依赖买卖双方直接匹配订单来完成交易（跟你大A股不一样），而是通过算法和流动性池来确定价格并执行交易。</p>
<h2 id="工作原理："><a href="#工作原理：" class="headerlink" title="工作原理："></a>工作原理：</h2><p>在 AMM 系统中，流动性提供者（Liquidity Providers, LPs）将两种或多种代币存入一个智能合约创建的流动性池中。当用户想要进行交易时（例如用 Token A 交换 Token B），他们不是与另一个买家或卖家匹配，而是与这个流动性池进行交互。交易的价格由预设的数学公式决定，最常见的是恒定乘积公式 <code>x * y = k</code> ,<code>x</code> 和 <code>y</code>  代表两种 token , k 是一个常数， 这个叫<code>恒定乘积公式</code>。</p>
<p>这意味着如果有人想要购买更多的 Token A，那么 Token A 在流动性池中的数量会减少，而 Token B 的数量会增加，从而导致 Token A 的价格上涨。反之亦然，如果有人卖出 Token A，则其价格会下降。</p>
<h1 id="什么是流动性提供者（LP）"><a href="#什么是流动性提供者（LP）" class="headerlink" title="什么是流动性提供者（LP）?"></a>什么是流动性提供者（LP）?</h1><p>流动性提供者是那些将自己持有的代币存入特定的智能合约中，以形成一个或多个代币对的“流动性池”的用户。这些池子为去中心化交易所提供了必要的流动性，使得买家和卖家无需等待匹配订单即可立即进行交易。作为回报，流动性提供者通常会从每笔交易中抽取一定比例的手续费作为奖励。</p>
<p>当你成功向流动性池添加了资金后，你会收到代表你在该池中的份额的LP代币。这些代币（token）不仅证明了你对该池贡献了多少流动性，还可以用于重新取回你的本金及赚取的交易费用。</p>
<p>每当有用户通过该流动性池进行交易时，都会产生一笔小额的交易费，这笔费用会被分配给所有的流动性提供者，按照他们在池中所占的比例分享。</p>
<h1 id="什么是质押（Staking）？"><a href="#什么是质押（Staking）？" class="headerlink" title="什么是质押（Staking）？"></a>什么是质押（Staking）？</h1><p>质押涉及将一定数量的代币“锁定”在一个特定的智能合约或钱包地址中，这些代币不能在质押期间随意转移或交易。质押者通过这种方式参与到区块链网络的验证过程中，帮助确认交易和创建新的区块。作为对提供这种服务的补偿，质押者可以获得新生成的代币或其他形式的奖励。<br>就类似于定期存款，给DEX提供流动性，到期还你钱还奖励你一些token。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/30/Solana%20%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91%20-%20%E5%9F%BA%E4%BA%8ESPL%20Token%20%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAToken/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/30/Solana%20%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91%20-%20%E5%9F%BA%E4%BA%8ESPL%20Token%20%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAToken/" itemprop="url">Solana 合约开发 - 基于SPL Token 创建一个Token</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-30T16:50:04+08:00">
                2024-11-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Solana%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91-DeFi-Dex/" itemprop="url" rel="index">
                    <span itemprop="name">Solana合约开发-DeFi-Dex</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="先了解下SPL-Token涉及到哪些概念："><a href="#先了解下SPL-Token涉及到哪些概念：" class="headerlink" title="先了解下SPL Token涉及到哪些概念："></a>先了解下SPL Token涉及到哪些概念：</h1><h2 id="SPL-Token-program"><a href="#SPL-Token-program" class="headerlink" title="SPL Token program"></a>SPL Token program</h2><p>SPL Token Program 是 Solana 区块链上用于创建、管理和转移代币的核心智能合约或程序。它是 Solana 程序库（SPL）的一部分，提供了标准化的方式来处理代币操作，如铸造新代币、转账、冻结账户等。SPL Token Program 使得开发者能够轻松地在 Solana 上发行和管理自己的代币。</p>
<h2 id="代币账户（Token-Account）"><a href="#代币账户（Token-Account）" class="headerlink" title="代币账户（Token Account）"></a>代币账户（Token Account）</h2><p>这是最基本的账户类型，用于持有特定的代币。每个代币账户都与一个特定的代币相关联，并且可以包含该代币的数量</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="comment">/// The mint associated with this account</span></span><br><span class="line">    <span class="keyword">pub</span> mint: Pubkey,</span><br><span class="line">    <span class="comment">/// The owner of this account.</span></span><br><span class="line">    <span class="keyword">pub</span> owner: Pubkey,</span><br><span class="line">    <span class="comment">/// The amount of tokens this account holds.</span></span><br><span class="line">    <span class="keyword">pub</span> amount: <span class="type">u64</span>,</span><br><span class="line">    <span class="comment">/// If `delegate` is `Some` then `delegated_amount` represents</span></span><br><span class="line">    <span class="comment">/// the amount authorized by the delegate</span></span><br><span class="line">    <span class="keyword">pub</span> delegate: COption&lt;Pubkey&gt;,</span><br><span class="line">    <span class="comment">/// The account&#x27;s state</span></span><br><span class="line">    <span class="keyword">pub</span> state: AccountState,</span><br><span class="line">    <span class="comment">/// If is_native.is_some, this is a native token, and the value logs the</span></span><br><span class="line">    <span class="comment">/// rent-exempt reserve. An Account is required to be rent-exempt, so</span></span><br><span class="line">    <span class="comment">/// the value is used by the Processor to ensure that wrapped SOL</span></span><br><span class="line">    <span class="comment">/// accounts do not drop below this threshold.</span></span><br><span class="line">    <span class="keyword">pub</span> is_native: COption&lt;<span class="type">u64</span>&gt;,</span><br><span class="line">    <span class="comment">/// The amount delegated</span></span><br><span class="line">    <span class="keyword">pub</span> delegated_amount: <span class="type">u64</span>,</span><br><span class="line">    <span class="comment">/// Optional authority to close the account.</span></span><br><span class="line">    <span class="keyword">pub</span> close_authority: COption&lt;Pubkey&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Mint-账户（Mint-Account）"><a href="#Mint-账户（Mint-Account）" class="headerlink" title="Mint 账户（Mint Account）"></a>Mint 账户（Mint Account）</h2><p>Mint 账户负责定义和控制某一类代币的基本属性，比如总供应量、小数位数等。它是创建新代币的基础，可以理解成创建一种新代币，就会有个新的Mint账户代表它。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Mint</span> &#123;</span><br><span class="line">    <span class="comment">/// Optional authority used to mint new tokens. The mint authority may only</span></span><br><span class="line">    <span class="comment">/// be provided during mint creation. If no mint authority is present</span></span><br><span class="line">    <span class="comment">/// then the mint has a fixed supply and no further tokens may be</span></span><br><span class="line">    <span class="comment">/// minted.</span></span><br><span class="line">    <span class="keyword">pub</span> mint_authority: COption&lt;Pubkey&gt;,</span><br><span class="line">    <span class="comment">/// Total supply of tokens.</span></span><br><span class="line">    <span class="keyword">pub</span> supply: <span class="type">u64</span>,</span><br><span class="line">    <span class="comment">/// Number of base 10 digits to the right of the decimal place.</span></span><br><span class="line">    <span class="keyword">pub</span> decimals: <span class="type">u8</span>,</span><br><span class="line">    <span class="comment">/// Is `true` if this structure has been initialized</span></span><br><span class="line">    <span class="keyword">pub</span> is_initialized: <span class="type">bool</span>,</span><br><span class="line">    <span class="comment">/// Optional authority to freeze token accounts.</span></span><br><span class="line">    <span class="keyword">pub</span> freeze_authority: COption&lt;Pubkey&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/./images/token-account-relationship.d1cdddce.svg" alt="这是图片" title="token-account"></p>
<h2 id="Authority（权限）"><a href="#Authority（权限）" class="headerlink" title="Authority（权限）"></a>Authority（权限）</h2><p>权限指的是对某个代币相关操作的控制权。例如，Mint 权限允许铸造新的代币，Freeze 权限允许冻结某些账户等。</p>
<h2 id="Program-Derived-Address（PDA）"><a href="#Program-Derived-Address（PDA）" class="headerlink" title="Program Derived Address（PDA）"></a>Program Derived Address（PDA）</h2><p>在 Solana 区块链中，Program Derived Address（PDA）是一个非常重要的概念，尤其在开发智能合约和去中心化应用时。PDA 是一种特殊的账户地址，它不由私钥直接控制，而是通过程序逻辑生成的。这意味着只有特定的程序才能签署与该地址相关的交易，这为开发者提供了一种安全且灵活的方式来管理链上状态。</p>
<h3 id="PDA-的生成"><a href="#PDA-的生成" class="headerlink" title="PDA 的生成:"></a>PDA 的生成:</h3><p>PDA 是通过一个种子（seeds）数组和当前区块链的状态（称为“bump”值）生成的。具体来说：<br><strong>种子（Seeds）</strong>: 这是一组可以是任意数据的输入，如字符串、公钥或其他信息。这些种子用于确定性地生成 PDA。</p>
<p><strong>Bump</strong>: 自动生成的 bump 种子值，用于解决 PDA 地址冲突问题。PDA 是一种特殊的 Solana 地址，它不是由私钥控制的，而是通过程序逻辑生成的。Bump 值确保生成的地址不会与任何有效的公钥冲突。</p>
<h2 id="关联代币账户（Associated-Token-Account-ATA）"><a href="#关联代币账户（Associated-Token-Account-ATA）" class="headerlink" title="关联代币账户（Associated Token Account, ATA）"></a>关联代币账户（Associated Token Account, ATA）</h2><p>关联代币账户是一种特殊的代币账户(Token Account)，ATA 的地址是通过所有者的钱包公钥和代币 Mint 地址以及 SPL Token 程序 ID 作为种子，利用 Solana 的程序派生地址（Program Derived Address, PDA）机制生成的.这意味着，给定相同的所有者和 Mint 地址，每次生成的 ATA 地址都是相同的，从而保证了唯一性和一致性。</p>
<p><img src="/./images/associated-token-account.svg" alt="这是图片" title="ATA"></p>
<p><img src="/./images/token-account-relationship-ata.910e6042.svg" alt="这是图片" title="ATA2"></p>
<h3 id="Token-Account-和-ATA的区别："><a href="#Token-Account-和-ATA的区别：" class="headerlink" title="Token Account 和 ATA的区别："></a>Token Account 和 ATA的区别：</h3><p>先说Token Account，它相当一个存钱罐，这个存钱罐专门用来存放某种特定类型的硬币（比如1元硬币），你可以有多个存钱罐，每个存钱罐都可以存放不同数量的同一种硬币。注意！是N个罐存同一种硬币！<br>再说ATA，假设有一种特殊规则：每个人对于每种类型的硬币只能有一个“官方”存钱罐，而且这个存钱罐的位置是根据你的名字和硬币类型计算出来的。这样做的好处是，当你想要给别人一些特定类型的硬币时，你知道他们只有一个指定的地方可以接收这些硬币，不需要担心找错地方或者重复创建新的存钱罐。也就是说你一种硬币就只能有一个罐。</p>
<p>使用场景差异: 在大多数情况下，当你想要向某人发送代币时，你会希望使用他们的 ATA，因为这样可以保证你发送到的是他们针对那种代币的默认账户。而在某些特殊情况下，比如需要对代币进行更复杂的权限控制或隔离不同的资金用途时，可能会手动创建额外的 Token Account。</p>
<h2 id="Token-Metadata-Program"><a href="#Token-Metadata-Program" class="headerlink" title="Token Metadata Program"></a>Token Metadata Program</h2><p>Token Metadata Program 是一个专门设计的程序，允许开发者为 SPL 代币添加更详细的元数据信息，原本Token Program所允许添加的信息太少了，这个Metadata Program相当于是种扩展。这个程序通常与 Metaplex 协议相关联，Metaplex 是 Solana 上的一个开源框架，提供了创建和管理 NFT 的工具和服务。</p>
<h2 id="Metadata-Account"><a href="#Metadata-Account" class="headerlink" title="Metadata Account"></a>Metadata Account</h2><p>Metadata Account 是存储上述元数据的实际账户。每个 Metadata Account 都与一个特定的 Mint 账户关联，这意味着每种代币类型都有一个对应的 Metadata Account 来存储其元数据信息。</p>
<p><img src="/./images/metadata.png" alt="这是图片" title="metadata"></p>
<h2 id="CPI（Cross-Program-Invocation，跨程序调用）"><a href="#CPI（Cross-Program-Invocation，跨程序调用）" class="headerlink" title="CPI（Cross-Program Invocation，跨程序调用）"></a>CPI（Cross-Program Invocation，跨程序调用）</h2><p>CPI（Cross-Program Invocation，跨程序调用）是 Solana 区块链上的一个重要概念，它允许一个程序调用另一个程序的功能。<br>在 Solana 上，每个交易由一系列指令组成，每个指令可以操作多个账户，并执行特定的逻辑。当一个程序需要调用另一个程序时，就可以使用 CPI 来完成这个操作。具体来说：</p>
<p><strong>发起者程序</strong>：这是调用其他程序的那个程序。<br><strong>被调用程序</strong>：这是提供所需功能的程序，比如 SPL Token 程序、Metaplex 的 Token Metadata 程序等。</p>
<h1 id="结合代码来学习："><a href="#结合代码来学习：" class="headerlink" title="结合代码来学习："></a>结合代码来学习：</h1><h2 id="合约代码："><a href="#合约代码：" class="headerlink" title="合约代码："></a>合约代码：</h2><p>注意：建议在<code>devnet</code>环境下测试，因为<code>localnet</code>默认不支持 Token metadata program，它属于第三方开源框架，当然也有其他办法在localnet上使用，就是麻烦点。</p>
<p>首先在Anchor 项目下创建<code>accounts_all/token.rs</code>  文件，用来记录所需要用到哪些账户<br>例如：anchor&#x2F;programs&#x2F;swap&#x2F;src&#x2F;accounts_all&#x2F;token.rs</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> anchor_lang:: prelude::*;</span><br><span class="line"><span class="keyword">use</span> anchor_spl::&#123;</span><br><span class="line">    metadata::Metadata,</span><br><span class="line">    token::&#123;Mint, Token&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">use</span> crate::states::token;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这里会涉及到很多上面所提到的账户类型，以下是静态创建账户</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Accounts)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">CreateMintAndMetadata</span>&lt;<span class="symbol">&#x27;info</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建一个 token Mint账户</span></span><br><span class="line">	<span class="comment">//init就是初始化账户，假如不存在这个账户就会自动创建</span></span><br><span class="line">	<span class="comment">//payer就是创建这个账户所花的fee由谁来支付</span></span><br><span class="line">	<span class="comment">//根据seeds的内容 自动构建一个PDA，生成账户地址</span></span><br><span class="line">	<span class="comment">//bump 自动生成的 bump 种子值，用于解决 PDA 地址冲突问题。PDA 是一种特殊的 Solana 地址，它不是由私钥控制的，而是通过程序逻辑生成的。Bump 值确保生成的地址不会与任何有效的公钥冲突。</span></span><br><span class="line">	<span class="comment">//mint::decimals: 设置新代币的小数位数</span></span><br><span class="line">	<span class="comment">//mint::authority: 指定哪个账户拥有对这个 Mint 账户的控制权,设成别的账户也可以</span></span><br><span class="line">	<span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        init,</span></span><br><span class="line"><span class="meta">        payer = payer,</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            token::LP_TOKEN_SEED.as_bytes(),</span></span><br><span class="line"><span class="meta">        ]</span>,        </span><br><span class="line">        bump,</span><br><span class="line">        mint::decimals = token::LP_TOKEN_DECIMALS,</span><br><span class="line">        mint::authority = authority.<span class="title function_ invoke__">key</span>(),</span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> lp_token_mint: Account&lt;<span class="symbol">&#x27;info</span>, Mint&gt;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建一个 token metadata账户</span></span><br><span class="line">	<span class="comment">//因为这里使用了UncheckedAccount类型的账户，所以需要写&quot;///CHECK&quot;,不然build不通过，至于内容随意</span></span><br><span class="line">	<span class="comment">// mut 表示该账户是可变的，意味着在交易过程中可以修改它的内容,而不使用init是因为在代码里动态创建。</span></span><br><span class="line">	<span class="comment">// 指定哪个程序负责生成这个 PDA。在这里，指定的是 token_metadata_program，这意味着只有这个特定的元数据程序才能生成或操作这个账户。</span></span><br><span class="line">	<span class="comment">/// CHECK: Validate address by derving pda</span></span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">        mut,</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            token::LP_TOKEN_METADATA.as_bytes(),</span></span><br><span class="line"><span class="meta">            token_metadata_program.key().as_ref(),</span></span><br><span class="line"><span class="meta">            lp_token_mint.key().as_ref(),</span></span><br><span class="line"><span class="meta">        ]</span>,</span><br><span class="line">        bump,</span><br><span class="line">        seeds::program = token_metadata_program.<span class="title function_ invoke__">key</span>(),</span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> lp_token_metadata: UncheckedAccount&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">    <span class="comment">/// CHECK: pool vault and lp mint authority</span></span><br><span class="line">    <span class="meta">#[account(</span></span><br><span class="line"><span class="meta">	    init,</span></span><br><span class="line"><span class="meta">	    payer = payer,</span></span><br><span class="line"><span class="meta">        seeds = [</span></span><br><span class="line"><span class="meta">            crate::AUTH_SEED.as_bytes(),</span></span><br><span class="line"><span class="meta">        ]</span>,</span><br><span class="line">        bump,</span><br><span class="line">    )]</span><br><span class="line">    <span class="keyword">pub</span> authority: UncheckedAccount&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">//可以使用你的钱包地址</span></span><br><span class="line">    <span class="meta">#[account(mut)]</span></span><br><span class="line">    <span class="keyword">pub</span> payer: Signer&lt;<span class="symbol">&#x27;info</span>&gt;,</span><br><span class="line"></span><br><span class="line">	<span class="comment">//都是所使用到的一些程序账户</span></span><br><span class="line">    <span class="keyword">pub</span> token_metadata_program: Program&lt;<span class="symbol">&#x27;info</span>, Metadata&gt;,</span><br><span class="line">    <span class="keyword">pub</span> token_program: Program&lt;<span class="symbol">&#x27;info</span>, Token&gt;,</span><br><span class="line">    <span class="keyword">pub</span> system_program: Program&lt;<span class="symbol">&#x27;info</span>, System&gt;,</span><br><span class="line">    <span class="keyword">pub</span> rent: Sysvar&lt;<span class="symbol">&#x27;info</span>, Rent&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>然后在Anchor 项目下创建<code>states/token.rs</code>  文件<br>例如：anchor&#x2F;programs&#x2F;swap&#x2F;src&#x2F;states&#x2F;token.rs</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用来创建一些常量，在上面的accounts里面所使用</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">const</span> LP_TOKEN_SEED: &amp;<span class="type">str</span> = <span class="string">&quot;lp_token_V1&quot;</span>;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">const</span> LP_TOKEN_METADATA: &amp;<span class="type">str</span> = <span class="string">&quot;metadata&quot;</span>;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">const</span> LP_TOKEN_DECIMALS: <span class="type">u8</span> = <span class="number">9</span>;</span><br></pre></td></tr></table></figure>


<p>然后在Anchor 项目下创建<code>instruction/token.rs</code>  文件，用来写具体的创建代码<br>例如：anchor&#x2F;programs&#x2F;swap&#x2F;src&#x2F;instruction&#x2F;token.rs</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这里的use都是引入哪些包</span></span><br><span class="line"><span class="keyword">use</span> crate::accounts_all::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"><span class="keyword">use</span> anchor_spl::metadata::&#123;</span><br><span class="line">    create_metadata_accounts_v3, mpl_token_metadata::types::DataV2, CreateMetadataAccountsV3,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//具体创建token代码</span></span><br><span class="line"><span class="comment">//ctx就是上面的 accounts 结构体，也就是把账户信息都传进来</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">create_lp_token_metadata</span>(ctx: Context&lt;CreateMintAndMetadata&gt;) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">	<span class="comment">//生成签名种子，以便在 CPI 调用中作为签名者。</span></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">signer_seeds</span>: &amp;[&amp;[&amp;[<span class="type">u8</span>]]] =</span><br><span class="line">        &amp;[&amp;[crate::AUTH_SEED.<span class="title function_ invoke__">as_bytes</span>(), &amp;[ctx.bumps.authority]]];</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">create_metadata_accounts_v3</span>(</span><br><span class="line">        CpiContext::<span class="title function_ invoke__">new_with_signer</span>(</span><br><span class="line">	    <span class="comment">//ctx.accounts.lp_token_metadata.to_account_info()，指向元数据账户的信息。</span></span><br><span class="line">	        ctx.accounts.lp_token_metadata.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">	        <span class="comment">//metadata: 元数据账户本身。</span></span><br><span class="line">			<span class="comment">//mint: 关联的 Mint 账户。</span></span><br><span class="line">			<span class="comment">//mint_authority: Mint 账户的权威机构。</span></span><br><span class="line">			<span class="comment">//update_authority: 更新元数据账户的权威机构。</span></span><br><span class="line">			<span class="comment">//payer: 支付交易费用的账户。</span></span><br><span class="line">			<span class="comment">//system_program: Solana 系统程序。</span></span><br><span class="line">			<span class="comment">//rent: 租金变量，确保账户有足够的资金来避免被系统回收          </span></span><br><span class="line">			CreateMetadataAccountsV3 &#123;</span><br><span class="line">                metadata: ctx.accounts.lp_token_metadata.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                mint: ctx.accounts.lp_token_mint.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                mint_authority: ctx.accounts.pool_lp_authority.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                update_authority: ctx.accounts.pool_lp_authority.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                payer: ctx.accounts.payer.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                system_program: ctx.accounts.system_program.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">                rent: ctx.accounts.rent.<span class="title function_ invoke__">to_account_info</span>(),</span><br><span class="line">            &#125;,</span><br><span class="line">            signer_seeds,</span><br><span class="line">        ),</span><br><span class="line">        <span class="comment">//定义了元数据的具体内容</span></span><br><span class="line">        <span class="comment">//name: 代币名称。</span></span><br><span class="line">		<span class="comment">//symbol: 代币符号。</span></span><br><span class="line">		<span class="comment">//uri: 指向更多元数据信息的 URL（例如，代币的图标、描述等）。</span></span><br><span class="line">		<span class="comment">//seller_fee_basis_points: 卖家费用百分比点数，通常用于 NFTs 的二次销售。</span></span><br><span class="line">		<span class="comment">//creators, collection, uses: 可选字段，分别指代币创作者信息、所属集合信息及用途信息，在这个例子中均设为 None。</span></span><br><span class="line">		DataV2 &#123;</span><br><span class="line">            name: <span class="string">&quot;swap&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            symbol: <span class="string">&quot;swap&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            uri: <span class="string">&quot;swap.com&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            seller_fee_basis_points: <span class="number">0</span>,</span><br><span class="line">            creators: <span class="literal">None</span>,</span><br><span class="line">            collection: <span class="literal">None</span>,</span><br><span class="line">            uses: <span class="literal">None</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">//第三个参数 false: 是否更新现有元数据账户。</span></span><br><span class="line">		<span class="comment">//第四个参数 true: 是否使用更新权限。</span></span><br><span class="line">		<span class="comment">//第五个参数 None: 可选的额外参数。        </span></span><br><span class="line">		<span class="literal">false</span>,</span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line">        <span class="literal">None</span>,</span><br><span class="line">    )?;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>lib.rs</code> 添加以下内容：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">const</span> AUTH_SEED: &amp;<span class="type">str</span> = <span class="string">&quot;swap_auth_seed&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这是Program id，使用anchor自动生成的就好，不要更改自己的</span></span><br><span class="line">declare_id!(<span class="string">&quot;85pA1rfrCqkiHnTaUK1F5MqjEUGyAHgSjJgzR75Dv&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#[program]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> swap &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">create_lp_token_metadata</span>(ctx: Context&lt;CreateMintAndMetadata&gt;) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">        instructions::<span class="title function_ invoke__">create_lp_token_metadata</span>(ctx)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<p><code>Cargo.toml</code> 文件里面添加以下内容：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[features]</span></span><br><span class="line"><span class="attr">idl-build</span> = [<span class="string">&quot;anchor-lang/idl-build&quot;</span>, <span class="string">&quot;anchor-spl/idl-build&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">anchor-lang</span> = &#123; version = <span class="string">&quot;0.30.1&quot;</span>, features = [<span class="string">&quot;init-if-needed&quot;</span>] &#125;</span><br><span class="line"><span class="attr">anchor-spl</span> = &#123; version = <span class="string">&quot;0.30.1&quot;</span>, features = [<span class="string">&quot;metadata&quot;</span>] &#125;</span><br></pre></td></tr></table></figure>


<h2 id="前端TS测试合约代码："><a href="#前端TS测试合约代码：" class="headerlink" title="前端TS测试合约代码："></a>前端TS测试合约代码：</h2><p>获取本地钱包：<br>anchor&#x2F;example&#x2F;api&#x2F;wallet.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&quot;@coral-xyz/anchor&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Program</span>&#125; <span class="keyword">from</span> <span class="string">&quot;@coral-xyz/anchor&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; swap &#125; <span class="keyword">from</span> <span class="string">&quot;../../target/types/swap&quot;</span>;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> provider = anchor.<span class="property">AnchorProvider</span>.<span class="title function_">env</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;provider:&quot;</span>, provider.<span class="property">wallet</span>.<span class="property">publicKey</span>.<span class="title function_">toBase58</span>());</span><br><span class="line">anchor.<span class="title function_">setProvider</span>(provider);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> program = anchor.<span class="property">workspace</span>.<span class="property">swap</span> <span class="keyword">as</span> <span class="title class_">Program</span>&lt;swap&gt; ;</span><br><span class="line"><span class="keyword">const</span> wallet = provider.<span class="property">wallet</span> <span class="keyword">as</span> anchor.<span class="property">Wallet</span>;</span><br><span class="line"><span class="keyword">const</span> connection = provider.<span class="property">connection</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; program, provider,connection&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义并导出 useDefaultWallet 函数。</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useDefaultWallet</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> anchor.<span class="property">Wallet</span>.<span class="title function_">local</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写测试方法：<br>anchor&#x2F;example&#x2F;api&#x2F;token.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&#x27;@coral-xyz/anchor&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; program &#125; <span class="keyword">from</span> <span class="string">&#x27;./wallet&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这个方法就是lib.rs里的方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createLpTokenMetadata</span>(<span class="params"><span class="attr">wallet</span>: anchor.<span class="title class_">Wallet</span></span>) &#123;</span><br><span class="line">	</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> program.<span class="property">methods</span></span><br><span class="line">    .<span class="title function_">createLpTokenMetadata</span>()</span><br><span class="line">    .<span class="title function_">accounts</span>(&#123;</span><br><span class="line">      <span class="attr">payer</span>: wallet.<span class="property">publicKey</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">signers</span>([wallet.<span class="property">payer</span>])</span><br><span class="line">    .<span class="title function_">rpc</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用测试方法：<br>anchor&#x2F;example&#x2F;index.ts&#96;&#96;&#96;</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&#x27;@coral-xyz/anchor&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connection, program, provider, useDefaultWallet &#125; <span class="keyword">from</span> <span class="string">&#x27;./api/wallet&#x27;</span>;</span><br><span class="line"></span><br><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">	<span class="comment">// 获取默认钱包</span></span><br><span class="line">	<span class="keyword">const</span> defaultWallet = <span class="title function_">useDefaultWallet</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//创建token</span></span><br><span class="line">	<span class="keyword">const</span> create_lp_token = <span class="keyword">await</span> <span class="title function_">createLpTokenMetadata</span>(</span><br><span class="line">		defaultWallet,</span><br><span class="line">   );</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(create_lp_token);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>


<h2 id="执行Anchor-命令："><a href="#执行Anchor-命令：" class="headerlink" title="执行Anchor 命令："></a>执行Anchor 命令：</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#部署合约</span></span><br><span class="line">anchor build &amp;&amp; anchor deploy</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行前端测试代码，api在上一节介绍Anchor.toml里有讲</span></span><br><span class="line">anchor run api</span><br></pre></td></tr></table></figure>


<p>测试成功后会输出交易的transactions,  可将这个transactions输入到区块链浏览器里，查看交易的具体细节，产生了什么。<br>链接： <a target="_blank" rel="noopener" href="https://explorer.solana.com/">https://explorer.solana.com/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/15/Solana-Anchor%E9%A1%B9%E7%9B%AE%E9%87%8D%E8%A6%81%E6%96%87%E4%BB%B6%E8%AE%B2%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/15/Solana-Anchor%E9%A1%B9%E7%9B%AE%E9%87%8D%E8%A6%81%E6%96%87%E4%BB%B6%E8%AE%B2%E8%A7%A3/" itemprop="url">Solana 合约开发 - Anchor 项目基础介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-15T16:06:42+08:00">
                2024-11-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Solana%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91/" itemprop="url" rel="index">
                    <span itemprop="name">Solana合约开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="使用anchor创建项目，并使用IDE打开项目："><a href="#使用anchor创建项目，并使用IDE打开项目：" class="headerlink" title="使用anchor创建项目，并使用IDE打开项目："></a>使用anchor创建项目，并使用IDE打开项目：</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anchor init my_anchor_project</span><br></pre></td></tr></table></figure>

<h1 id="创建出来的基础目录结构："><a href="#创建出来的基础目录结构：" class="headerlink" title="创建出来的基础目录结构："></a>创建出来的基础目录结构：</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">my_anchor_project/</span><br><span class="line">├── Anchor.toml          # Anchor 配置文件</span><br><span class="line">├── Cargo.toml           # Rust 包管理配置文件</span><br><span class="line">├── programs/            # 存放 Solana 智能合约（程序）代码</span><br><span class="line">│   └── my_anchor_project/</span><br><span class="line">│       ├── src/</span><br><span class="line">│       │   └── lib.rs    # 智能合约的 Rust 实现</span><br><span class="line">│       └── Cargo.toml   # 程序模块的 Cargo 配置</span><br><span class="line">└── tests/               # 存放集成测试脚本，使用 TypeScript 编写</span><br><span class="line">    └── my_anchor_project.ts # 示例测试脚本</span><br></pre></td></tr></table></figure>


<h1 id="先介绍下-Cargo："><a href="#先介绍下-Cargo：" class="headerlink" title="先介绍下 Cargo："></a>先介绍下 <code>Cargo</code>：</h1><p>Cargo 是 Rust 编程语言的包管理器和构建系统。它帮助开发者管理 Rust 项目的依赖关系、构建项目、生成文档、运行测试等。Cargo 是 Rust 官方推荐的方式来管理 Rust 项目，简化了许多常见的开发任务，使得开发者可以更专注于编写代码而非管理工具链或依赖项。</p>
<h2 id="Cargo-的主要功能"><a href="#Cargo-的主要功能" class="headerlink" title="Cargo 的主要功能"></a>Cargo 的主要功能</h2><h3 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理:"></a>依赖管理:</h3><p>Cargo 使用 Cargo.toml 文件来定义项目的依赖。你可以在这个文件中指定你的项目需要哪些外部 crate（Rust 包），以及它们的版本要求。Cargo 会自动下载并编译这些依赖项，并确保所有依赖都兼容。</p>
<h3 id="构建项目"><a href="#构建项目" class="headerlink" title="构建项目:"></a>构建项目:</h3><p>使用 <code>cargo build</code> 命令可以编译你的项目。Cargo 会根据项目的配置自动处理编译顺序，链接库，以及其他必要的步骤。<br>对于优化构建，可以使用 cargo build –release 来启用优化选项，这对于生产环境非常重要。</p>
<h3 id="运行代码"><a href="#运行代码" class="headerlink" title="运行代码:"></a>运行代码:</h3><p><code>cargo run</code> 命令可以直接编译并运行你的项目，非常适合快速迭代开发。</p>
<h3 id="测试支持"><a href="#测试支持" class="headerlink" title="测试支持:"></a>测试支持:</h3><p>Cargo 提供了内置的测试框架支持，通过 <code>cargo test</code> 可以方便地运行项目的单元测试和集成测试。<br>生成文档:<br>使用 <code>cargo doc</code> 命令可以为你的项目及其所有依赖生成文档。这有助于团队成员理解和维护代码。</p>
<h2 id="发布包"><a href="#发布包" class="headerlink" title="发布包:"></a>发布包:</h2><p>如果你希望将你的 crate 发布到 crates.io，可以使用 <code>cargo publish</code> 命令轻松完成这一过程。</p>
<h3 id="锁定依赖版本"><a href="#锁定依赖版本" class="headerlink" title="锁定依赖版本:"></a>锁定依赖版本:</h3><p><code>Cargo.lock</code> 文件用于锁定所有依赖的确切版本，确保在不同的环境中构建时使用的依赖版本一致。这对于保证应用的行为一致性至关重要。</p>
<p>但是 <code>Anchor框架</code>已经封装了<code>Cargo</code>，所以很少直接使用 <code>Cargo</code> 命令，大多数时候使用 <code>Anchor</code> 命令。</p>
<h1 id="常用-Anchor命令："><a href="#常用-Anchor命令：" class="headerlink" title="常用 Anchor命令："></a>常用 <code>Anchor</code>命令：</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1. 初始化项目</span><br><span class="line">anchor init &lt;project-name&gt;</span><br><span class="line">创建一个新的 Anchor 项目，生成基本的目录结构和文件。</span><br><span class="line">示例：anchor init my_anchor_project</span><br><span class="line"></span><br><span class="line">2. 构建项目</span><br><span class="line">anchor build</span><br><span class="line">编译你的 Rust 程序（智能合约），并生成相应的 IDL（接口描述语言）文件。</span><br><span class="line">该命令会编译 programs/ 目录下的所有程序，并将编译结果放在 target/deploy/ 目录中。</span><br><span class="line"></span><br><span class="line">3. 部署程序</span><br><span class="line">anchor deploy</span><br><span class="line">将编译后的程序部署到指定的 Solana 集群（如 devnet, testnet 或 mainnet-beta）。</span><br><span class="line">在部署前确保已经设置了正确的集群环境（通过 solana config <span class="built_in">set</span> --url &lt;cluster-url&gt;）和钱包（通过 solana-keygen new 或者 solana config <span class="built_in">set</span> --keypair &lt;path-to-keypair&gt;）。</span><br><span class="line"></span><br><span class="line">4. 运行测试</span><br><span class="line">anchor <span class="built_in">test</span></span><br><span class="line">运行项目中的集成测试脚本。这些测试通常位于 tests/ 目录下，使用 TypeScript 编写。</span><br><span class="line">测试运行时会自动启动一个本地 Solana 测试集群，执行测试后关闭集群。</span><br><span class="line">可以通过 --skip-deploy 参数跳过重新部署步骤，直接运行测试。</span><br><span class="line"></span><br><span class="line">5. 运行自定义脚本</span><br><span class="line">anchor run &lt;script-name&gt;</span><br><span class="line">运行在 Anchor.toml 中定义的自定义脚本。</span><br><span class="line">示例：如果你在 Anchor.toml 中定义了一个名为 init 的脚本，可以通过 anchor run init 来执行它。</span><br><span class="line"></span><br><span class="line">6. 清理构建产物</span><br><span class="line">anchor clean</span><br><span class="line">清除构建产物，释放磁盘空间。这会删除 target/ 目录下的所有文件。</span><br></pre></td></tr></table></figure>


<h1 id="介绍几个Anchor重要文件"><a href="#介绍几个Anchor重要文件" class="headerlink" title="介绍几个Anchor重要文件:"></a>介绍几个Anchor重要文件:</h1><h2 id="Cargo-toml："><a href="#Cargo-toml：" class="headerlink" title="Cargo.toml："></a><code>Cargo.toml</code>：</h2><p>Cargo.toml 是 Rust 项目的配置文件，用于定义项目的元数据、依赖关系和构建配置等。对于 Anchor 项目来说，它主要用于管理智能合约（即程序）的 Rust 代码部分。</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[package]: 定义包的基本信息，如名称、版本、作者等</span></span><br><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;swap&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">description</span> = <span class="string">&quot;Created with Anchor&quot;</span></span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2021&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#[lib]: 配置库的设置，比如 crate-type 可以指定生成静态库还是动态库等。</span></span><br><span class="line"><span class="section">[lib]</span></span><br><span class="line"><span class="attr">crate-type</span> = [<span class="string">&quot;cdylib&quot;</span>, <span class="string">&quot;lib&quot;</span>]</span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;swap&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以开启一些特性</span></span><br><span class="line"><span class="section">[features]</span></span><br><span class="line"><span class="attr">default</span> = []</span><br><span class="line"><span class="attr">enable-log</span> = []</span><br><span class="line"><span class="attr">cpi</span> = [<span class="string">&quot;no-entrypoint&quot;</span>]</span><br><span class="line"><span class="attr">no-entrypoint</span> = []</span><br><span class="line"><span class="attr">no-log-ix-name</span> = []</span><br><span class="line"><span class="attr">idl-build</span> = [<span class="string">&quot;anchor-lang/idl-build&quot;</span>, <span class="string">&quot;anchor-spl/idl-build&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#[dependencies]: 列出该项目依赖的所有外部 crate。对于 Anchor 项目，通常会包含 anchor-lang 和其他可能需要的库。</span></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">anchor-lang</span> = &#123; version = <span class="string">&quot;0.30.1&quot;</span>, features = [<span class="string">&quot;init-if-needed&quot;</span>] &#125;</span><br><span class="line"><span class="attr">anchor-spl</span> = &#123; version = <span class="string">&quot;0.30.1&quot;</span>, features = [<span class="string">&quot;metadata&quot;</span>] &#125;</span><br><span class="line"><span class="attr">pyth-solana-receiver-sdk</span> = <span class="string">&quot;0.5.0&quot;</span></span><br><span class="line"><span class="attr">bytemuck</span> = <span class="string">&quot;1.20&quot;</span></span><br><span class="line"><span class="attr">serde</span> = &#123; version = <span class="string">&quot;1.0&quot;</span>, features = [<span class="string">&quot;derive&quot;</span>] &#125;</span><br><span class="line"><span class="attr">serde_json</span> = <span class="string">&quot;1.0&quot;</span></span><br><span class="line"><span class="attr">num-integer</span> = <span class="string">&quot;0.1&quot;</span></span><br><span class="line"><span class="attr">num-traits</span> = <span class="string">&quot;0.2&quot;</span></span><br><span class="line"><span class="attr">num-bigint</span> = <span class="string">&quot;0.4&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="Anchor-toml"><a href="#Anchor-toml" class="headerlink" title="Anchor.toml:"></a><code>Anchor.toml</code>:</h2><p>Anchor.toml 文件是 Anchor 框架的核心配置文件，用于定义项目的各种设置，包括部署环境、测试配置以及自定义脚本等。它使得开发者能够方便地管理项目在不同环境下的行为和依赖项。</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[toolchain]</span></span><br><span class="line"><span class="attr">anchor_version</span> = <span class="string">&quot;0.30.1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#可以用来启用或禁用某些特性。这有助于控制哪些代码会被编译进最终的构建中</span></span><br><span class="line"><span class="section">[features]</span></span><br><span class="line"><span class="attr">resolution</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">skip-lint</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义在特定网络上部署的程序地址。</span></span><br><span class="line"><span class="section">[programs.devnet]</span></span><br><span class="line"><span class="attr">swap</span> = <span class="string">&quot;85pA1rfrCqkiHnTaUK1F5MqjEUGyAHeCTgSjJgzR7v&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[registry]</span></span><br><span class="line"><span class="attr">url</span> = <span class="string">&quot;https://api.apr.dev&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义默认使用的 Solana 集群（如 devnet, testnet 或 mainnet-beta）以及钱包路径。</span></span><br><span class="line"><span class="section">[provider]</span></span><br><span class="line"><span class="attr">cluster</span> = <span class="string">&quot;https://devnet.helius-rpc.com/?api-key=7b73474a-082e-4823-be84-8dd532cb7a&quot;</span></span><br><span class="line"><span class="attr">wallet</span> = <span class="string">&quot;/Users/qsun-ou/wallet-keypair-pg-dev.json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#允许你定义自定义脚本，这些脚本可以通过 `anchor run &lt;script_name&gt;` 来执行，例如这个api是我定义的，可直接使用 anchor run api,就会执行api里面的命令。</span></span><br><span class="line"><span class="section">[scripts]</span></span><br><span class="line"><span class="attr">api</span> = <span class="string">&quot;ts-node ./example/index.ts&quot;</span></span><br><span class="line"><span class="attr">test</span> = <span class="string">&quot;../node_modules/.bin/jest --preset ts-jest&quot;</span></span><br></pre></td></tr></table></figure>


<h2 id="lib-rs"><a href="#lib-rs" class="headerlink" title="lib.rs:"></a><code>lib.rs</code>:</h2><p>这是你的 Solana 智能合约（程序）的主要 Rust 代码文件。它定义了程序的所有逻辑，包括如何处理交易指令以及管理账户状态等，可以理解成整个合约的访问入口。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> anchor_lang::prelude::*;</span><br><span class="line"></span><br><span class="line">declare_id!(<span class="string">&quot;Fg6PaFpoGXkYsidMpWTK6W2BeZ7FEfcYkg476zPFsLnS&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#[program]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> my_anchor_project &#123;</span><br><span class="line">    <span class="keyword">use</span> super::*;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">initialize</span>(ctx: Context&lt;Initialize&gt;) <span class="punctuation">-&gt;</span> ProgramResult &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Accounts)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Initialize</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="tests-your-test-file-ts："><a href="#tests-your-test-file-ts：" class="headerlink" title="tests/your_test_file.ts："></a><code>tests/your_test_file.ts</code>：</h2><p>包含用于测试智能合约功能的集成测试脚本。这些测试使用 TypeScript 编写，并利用 Anchor 提供的测试框架来模拟交易环境，可以通过ts脚本来调用<code>lib.rs</code>里面的方法来测试合约。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> anchor <span class="keyword">from</span> <span class="string">&#x27;@project-serum/anchor&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Program</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@project-serum/anchor&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MyAnchorProject</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../target/types/my_anchor_project&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;my_anchor_project&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> provider = anchor.<span class="property">Provider</span>.<span class="title function_">env</span>();</span><br><span class="line">  anchor.<span class="title function_">setProvider</span>(provider);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> program = anchor.<span class="property">workspace</span>.<span class="property">MyAnchorProject</span> <span class="keyword">as</span> <span class="title class_">Program</span>&lt;<span class="title class_">MyAnchorProject</span>&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;is initialized!&#x27;</span>, <span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> tx = <span class="keyword">await</span> program.<span class="property">rpc</span>.<span class="title function_">initialize</span>(&#123;&#125;);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(tx);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Cargo-lock"><a href="#Cargo-lock" class="headerlink" title="Cargo.lock:"></a><code>Cargo.lock</code>:</h2><p>记录了项目依赖的确切版本信息，确保构建过程中的依赖一致性。这个文件不会手动去改，是<code>cargo build</code> 或者 <code>cargo update</code> 的时候根据<code>Cargo.toml</code>自动生成的。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/14/Solana-%20token%20%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/14/Solana-%20token%20%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" itemprop="url">Solana 合约开发 - token 基础概念</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-14T17:57:09+08:00">
                2024-11-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Solana%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91-DeFi-Dex/" itemprop="url" rel="index">
                    <span itemprop="name">Solana合约开发-DeFi-Dex</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="What-is-token？"><a href="#What-is-token？" class="headerlink" title="What is token？"></a>What is token？</h1><p>在 Solana 区块链上，<strong>Token</strong> 是一种数字资产，用于表示价值或所有权。这些 Token 可以代表各种类型的资产，如货币、股权、积分、NFT（非同质化代币）等。Solana 使用 <strong>SPL Token Program</strong> 来管理和操作这些 Token。</p>
<h1 id="What-is-SPL"><a href="#What-is-SPL" class="headerlink" title="What is SPL?"></a>What is SPL?</h1><p><strong>SPL (Solana Program Library)</strong> 是一组用于在 Solana 区块链上构建去中心化应用程序的智能合约库。SPL 提供了多种标准和工具，使开发者能够更容易地创建和管理各种类型的代币、账户和其他常见功能。</p>
<h1 id="SPL-Token版本："><a href="#SPL-Token版本：" class="headerlink" title="SPL Token版本："></a>SPL Token版本：</h1><p>分为 SPL Token 和 SPL Token 2022 两个版本，都可以使用，SPL Token是最初版本，兼容性较好，SPL Token 2022 是对原始 SPL Token 标准的一个增强版本，它通过引入一系列扩展增强了代币的功能性。例如允许开发者为代币添加额外的功能。例如，可以添加转移费用、利息积累率、可选转移能力等功能。这些扩展使得 Token 2022 更加灵活和强大，当然还有其他方面的增强。</p>
<h1 id="Coin-和-Token-的区别："><a href="#Coin-和-Token-的区别：" class="headerlink" title="Coin 和 Token 的区别："></a>Coin 和 Token 的区别：</h1><h2 id="Coin："><a href="#Coin：" class="headerlink" title="Coin："></a>Coin：</h2><p>Coin 是指那些原生存在于其自身的区块链上的数字货币。例如，在 Solana 上，SOL 就是该平台的原生 coin。</p>
<p><strong>用途</strong>：<br>作为交易费用支付给网络中的验证者以确保交易被处理。<br>参与质押（staking），帮助维护网络安全并获得奖励。</p>
<h2 id="Token（代币）："><a href="#Token（代币）：" class="headerlink" title="Token（代币）："></a>Token（代币）：</h2><p>Token 是在现有的区块链平台上创建的数字资产。在 Solana 上，这些通常是通过 SPL-Token 标准来实现的。</p>
<p><strong>分类</strong>：<br>同质化代币（Fungible Tokens）：每个单位的价值相同且可互换，如稳定币 USDC。<br>非同质化代币（Non-Fungible Tokens, NFTs）：每个代币都是独一无二的，通常用来表示收藏品、艺术品等独特物品。<br><strong>用途</strong>：<br>代表各种形式的价值，包括但不限于货币、股票、积分、游戏内物品等。<br>可用于参与去中心化应用（DApps）的各种功能和服务。</p>
<h1 id="主要概念："><a href="#主要概念：" class="headerlink" title="主要概念："></a>主要概念：</h1><h2 id="Token-program"><a href="#Token-program" class="headerlink" title="Token program:"></a>Token program:</h2><p><strong>Token Program</strong> 是 SPL 中最核心的部分之一，用于创建和管理代币。它实现了 ERC-20 标准的功能，包括转账、授权等操作。</p>
<h3 id="主要功能："><a href="#主要功能：" class="headerlink" title="主要功能："></a>主要功能：</h3><ul>
<li><strong>创建代币</strong>：创建新的代币，并初始化代币账户。</li>
<li><strong>转账</strong>：在不同账户之间转移代币。</li>
<li><strong>授权</strong>：授权其他账户在你的账户中转移代币。</li>
<li><strong>撤销授权</strong>：撤销之前授权的权限。</li>
<li><strong>查询余额</strong>：查询某个账户的代币余额。</li>
</ul>
<h2 id="Mint-Account（铸币账户）"><a href="#Mint-Account（铸币账户）" class="headerlink" title="Mint Account（铸币账户）"></a>Mint Account（铸币账户）</h2><p><strong>Mint Account</strong> 是用于定义和管理某种代币的基本属性的账户。每个代币类型都有一个唯一的 Mint Account。</p>
<h3 id="主要功能：-1"><a href="#主要功能：-1" class="headerlink" title="主要功能："></a>主要功能：</h3><ul>
<li><strong>定义代币属性</strong>：包括代币的名称、符号、小数位数等。</li>
<li><strong>创建代币供应</strong>：初始发行代币。</li>
<li><strong>管理供应</strong>：增加或减少代币的总供应量。</li>
</ul>
<h2 id="Token-Account（代币账户）"><a href="#Token-Account（代币账户）" class="headerlink" title="Token Account（代币账户）"></a>Token Account（代币账户）</h2><p><strong>Token Account</strong> 是用于存储特定用户持有的代币数量的账户。每个用户持有一种代币都需要一个对应的 Token Account。</p>
<h3 id="主要功能：-2"><a href="#主要功能：-2" class="headerlink" title="主要功能："></a>主要功能：</h3><ul>
<li><strong>存储代币余额</strong>：记录用户持有的代币数量。</li>
<li><strong>转账</strong>：在不同用户之间转移代币。</li>
</ul>
<h2 id="ATA（关联代币账户）"><a href="#ATA（关联代币账户）" class="headerlink" title="ATA（关联代币账户）"></a>ATA（关联代币账户）</h2><p><strong>Associated Token Account (ATA)</strong> 是一种特殊的 Token Account，它的地址是通过特定的种子和程序 ID 生成的，确保每个用户和每种代币只有一个唯一的 Token Account。</p>
<h3 id="主要功能：-3"><a href="#主要功能：-3" class="headerlink" title="主要功能："></a>主要功能：</h3><ul>
<li><strong>简化账户创建</strong>：通过 ATA，用户可以轻松地为每种代币创建一个唯一的 Token Account。</li>
<li><strong>避免重复账户</strong>：确保每个用户和每种代币只有一个 Token Account，避免重复创建。</li>
</ul>
<p>现在不懂也没关系，后面代码还会再讲，这里留个印象。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/14/Solana-%E8%B4%A6%E6%88%B7%E6%A6%82%E5%BF%B5&%E7%AE%80%E5%8D%95%E4%BA%A4%E4%BA%92/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/14/Solana-%E8%B4%A6%E6%88%B7%E6%A6%82%E5%BF%B5&%E7%AE%80%E5%8D%95%E4%BA%A4%E4%BA%92/" itemprop="url">Solana 合约开发 - 账户&简单交互</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-14T16:26:35+08:00">
                2024-11-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Solana%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91/" itemprop="url" rel="index">
                    <span itemprop="name">Solana合约开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="账户相关基础概念："><a href="#账户相关基础概念：" class="headerlink" title="账户相关基础概念："></a>账户相关基础概念：</h1><ol>
<li>数据账户，</li>
<li>系统所有账户 </li>
<li>程序派生账户（PDA)</li>
<li>程序账户</li>
<li>原生账户<br>等账户相关概念，可阅读官方链接： <a target="_blank" rel="noopener" href="https://solana.com/zh/docs/core/accounts">https://solana.com/zh/docs/core/accounts</a></li>
</ol>
<p>里面写得非常详细，现在不懂不要紧，后面代码还会再讲。</p>
<h1 id="简单交互（使用Rust-SDK-："><a href="#简单交互（使用Rust-SDK-：" class="headerlink" title="简单交互（使用Rust SDK)："></a>简单交互（使用Rust SDK)：</h1><p>关于查询账户、获取空投、进行转账等操作，直接通过使用SDK，进行代码学习，其实平时也很少这样用，当加强理解：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::<span class="type">str</span>::FromStr;</span><br><span class="line"><span class="keyword">use</span> solana_sdk::pubkey::Pubkey;</span><br><span class="line"><span class="keyword">use</span> solana_client::rpc_client::RpcClient;</span><br><span class="line"><span class="keyword">use</span> solana_sdk::signature::&#123;<span class="keyword">self</span>, read_keypair_file&#125;;</span><br><span class="line"><span class="keyword">use</span> solana_sdk::signer::Signer;</span><br><span class="line"><span class="keyword">use</span> solana_sdk::&#123;recent_blockhashes_account, system_instruction, transaction&#125;;</span><br><span class="line"><span class="keyword">use</span> solana_sdk::transaction::Transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">//创建solana 链接,url可以用Playground创建的，也可以用本地创建的</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rpc_url</span> = <span class="string">&quot;https://api.devnet.solana.com&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">client</span> = RpcClient::<span class="title function_ invoke__">new</span>(rpc_url);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* //指定你要查询的余额账户公钥Pubkey</span></span><br><span class="line"><span class="comment">    let account_pubkey = Pubkey::from_str(&quot;3Mxb3vnmPRcf8UCYSVaUrc5VKV1P33EjMGuaJMuah4q&quot;).unwrap();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    let amount = 1 * 1_000_000_000; //1 SOL，Solana以 lamports 为单位，lamports 是 SOL 的最小单位（1 SOL = 10亿 lamports）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    //请求Airdrop空投到account_pubkey里面</span></span><br><span class="line"><span class="comment">    //后面获取余额可能会产生延迟，过一会儿才会有变化</span></span><br><span class="line"><span class="comment">    match client.request_airdrop(&amp;account_pubkey, amount)&#123;</span></span><br><span class="line"><span class="comment">        Ok(signature) =&gt; println!(&quot;Airdrop successful! Signature: &#123;&#125;&quot;, signature),</span></span><br><span class="line"><span class="comment">        Err(err) =&gt; eprintln!(&quot;Airdrop failed: &#123;&#125;&quot;, err),</span></span><br><span class="line"><span class="comment">    &#125; </span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     //获取账户余额</span></span><br><span class="line"><span class="comment">    match client.get_balance(&amp;account_pubkey) &#123;</span></span><br><span class="line"><span class="comment">        Ok(balance) =&gt; println!(&quot;账户余额:&#123;&#125; lamports&quot;, balance),</span></span><br><span class="line"><span class="comment">        Err(err) =&gt; eprintln!(&quot;获取余额失败&#123;&#125;&quot;,err),</span></span><br><span class="line"><span class="comment">    &#125;  */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------</span></span><br><span class="line">    <span class="comment">//账号转移SOL到另一个账户</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//发送方</span></span><br><span class="line">    <span class="comment">//file路径就是创建solana钱包的那个路径</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">sender</span> = <span class="title function_ invoke__">read_keypair_file</span>(<span class="string">&quot;/Users/xxx/wallet-keypair.json&quot;</span>).<span class="title function_ invoke__">expect</span>(<span class="string">&quot;fail&quot;</span>);</span><br><span class="line">    <span class="comment">//接收方</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">receive_pubkey</span> = Pubkey::<span class="title function_ invoke__">from_str</span>(<span class="string">&quot;CuiwHFr9gP4o2qTGYfPzqoxH7aihCHE7uYjjUTADXtU&quot;</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">amount</span> = <span class="number">1</span> * <span class="number">1_000_000_000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建转账指令</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">transfer_instruction</span> = system_instruction::<span class="title function_ invoke__">transfer</span>(&amp;sender.<span class="title function_ invoke__">pubkey</span>(), &amp;receive_pubkey, amount);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建交易</span></span><br><span class="line">    <span class="comment">//获取链上最后一个hash值</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">recent_blockhashes_account</span> = client.<span class="title function_ invoke__">get_latest_blockhash</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">transaction</span> = Transaction::<span class="title function_ invoke__">new_signed_with_payer</span>(</span><br><span class="line">        &amp;[transfer_instruction],</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(&amp;sender.<span class="title function_ invoke__">pubkey</span>()),</span><br><span class="line">        &amp;[&amp;sender],</span><br><span class="line">        recent_blockhashes_account,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = client.<span class="title function_ invoke__">send_and_confirm_transaction</span>(&amp;transaction);</span><br><span class="line">    <span class="keyword">match</span> result &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(signature) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;success,交易签名:&#123;&#125;&quot;</span>,signature),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(err) =&gt; <span class="built_in">eprintln!</span>(<span class="string">&quot;fail,&#123;&#125;&quot;</span>,err),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/10/Solana-%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/10/Solana-%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/" itemprop="url">Solana 合约开发 - 基础环境安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-10T22:14:58+08:00">
                2024-11-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Solana%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91/" itemprop="url" rel="index">
                    <span itemprop="name">Solana合约开发</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Solana-cli-安装"><a href="#Solana-cli-安装" class="headerlink" title="Solana-cli 安装:"></a><code>Solana-cli</code> 安装:</h1><p>以 macos 为例</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//检查xcode是否安装(其实一般自带已经安装)</span><br><span class="line">xcode-select -p</span><br><span class="line"></span><br><span class="line">//没有安装则</span><br><span class="line">xcode-select --install</span><br><span class="line"></span><br><span class="line">//安装Rust，之前已安装暂不赘述</span><br><span class="line"></span><br><span class="line">//安装 solana-cli ，安装特定版本将stable换成 v2.x.x</span><br><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -sSfL https://release.anza.xyz/stable/install)</span>&quot;</span></span><br><span class="line"></span><br><span class="line">//检查是否安装成功</span><br><span class="line">solana -V</span><br><span class="line"></span><br><span class="line">//如果之前已经安装过，可采用以下方式升级solana</span><br><span class="line">agave-install  update</span><br></pre></td></tr></table></figure>

<h1 id="Anchor开发框架安装"><a href="#Anchor开发框架安装" class="headerlink" title="Anchor开发框架安装:"></a><code>Anchor</code>开发框架安装:</h1><p>Anchor 是 Solana 区块链上的一种开发框架，旨在简化 Solana 程序的开发过程，使得开发者可以更容易地编写、测试和部署智能合约，虽然直接原生写rust也可以，但使用anchor会比较方便。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##正常安装：</span></span><br><span class="line">cargo install --git https://github.com/coral-xyz/anchor avm --locked --force</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##如果rust版本大于1.79，上面那条可能会报错，可尝试以下方案：</span></span><br><span class="line">cargo install --git https://github.com/coral-xyz/anchor --tag v0.30.1 anchor-cli --force</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##如果还不行，就手动安装：</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/coral-xyz/anchor.git</span><br><span class="line"><span class="built_in">cd</span> anchor</span><br><span class="line">git checkout avm</span><br><span class="line">cargo build --locked</span><br><span class="line"><span class="built_in">cd</span> avm</span><br><span class="line">cargo install --path .</span><br><span class="line"></span><br><span class="line">vi Cargo.toml</span><br><span class="line"><span class="comment">##添加：</span></span><br><span class="line">[net]</span><br><span class="line">git-fetch-with-cli = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">-----------------------------------------------</span><br><span class="line"><span class="comment">##上面的安装完以后安装avm:</span></span><br><span class="line"></span><br><span class="line">avm install latest</span><br><span class="line">avm use latest</span><br><span class="line"></span><br><span class="line">anchor -V</span><br><span class="line"><span class="comment">##显示anchor-cli 0.30.1，有显示则成功。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意！！！：</span><br><span class="line">由于rust、cargo、anchor之间的版本依赖非常混乱，简直是各玩各的，版本如果不对很有可能报错，以下是本人测试稳定可用版本：</span><br><span class="line">rustc --version</span><br><span class="line">rustc 1.79.0</span><br><span class="line">cargo --version</span><br><span class="line">cargo 1.79.0</span><br><span class="line">anchor --version</span><br><span class="line">anchor-cli 0.30.1</span><br><span class="line">solana -V</span><br><span class="line">solana-cli 2.1.9</span><br></pre></td></tr></table></figure>

<h1 id="Solana-cli-的使用"><a href="#Solana-cli-的使用" class="headerlink" title="Solana-cli 的使用:"></a><code>Solana-cli</code> 的使用:</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##创建一个新钱包</span></span><br><span class="line"><span class="comment">##pubkey(钱包地址）默认存储位置 ~/.config/solana/id.json</span></span><br><span class="line">solana-keygen new   <span class="comment"># --force overwrite 可重建钱包</span></span><br><span class="line"><span class="comment">#可建多个不同钱包，solana-keygen new -o /Users/qsun-ou/.config/solana/ad1.json</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置默认钱包为哪个，可切换不同钱包json文件</span></span><br><span class="line">solana config <span class="built_in">set</span> -k  ~/.config/solana/ad1.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 空投SOL代币（别想多，localnet 或者 devnet 而已，用来做测试,如果是开发网要在后面加devnet的url）</span></span><br><span class="line">solana airdrop 5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#还有一些常见用法：</span></span><br><span class="line"><span class="comment">#该命令用于获取当前Solana CLI配置的信息，包括所连接的集群（devnet, testnet, mainnet-beta等）、默认的公钥（如果已设置）等。</span></span><br><span class="line">solana config get</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用此命令可以更改当前Solana CLI配置中的集群URL。这里的 &lt;net&gt; 可以是任何有效的Solana集群URL，例如 https://api.devnet.solana.com 对于Devnet环境。也可以直接使用快捷方式如 devnet, testnet, 或 mainnet-beta 来切换到不同的网络环境。</span></span><br><span class="line">solana config <span class="built_in">set</span> --url &lt;net&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#此命令用于生成一个新的密钥对。这是创建新钱包的第一步，它会生成一个全新的私钥和相应的公钥。请确保安全地保存好生成的私钥文件。</span></span><br><span class="line">solana-keygen new</span><br><span class="line"></span><br><span class="line"><span class="comment">#该命令会显示与当前活动密钥对（由Solana CLI配置指定）相关联的Solana公共地址。如果您有多个密钥对，可以通过指定密钥对路径来查看特定地址：solana address --keypair &lt;path-to-keypair-file&gt;。</span></span><br><span class="line">solana address</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询指定公共密钥 &lt;pub_key&gt; 的Solana账户余额。如果不提供公共密钥参数，则默认查询当前配置的密钥对对应的账户余额。</span></span><br><span class="line">solana balance &lt;pub_key&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行从发送者账户到接收者账户的转账操作。需要提供接收者的公共密钥 &lt;recipient_public_key&gt; 和要转移的数量 &lt;amount&gt;。--from 参数允许您指定发送者账户的密钥对路径 &lt;sender_keypair_path&gt;，如果不指定，默认使用当前配置的密钥对。</span></span><br><span class="line">solana transfer &lt;recipient_public_key&gt; &lt;amount&gt; --from &lt;sender_keypair_path&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="启动本地Solana环境"><a href="#启动本地Solana环境" class="headerlink" title="启动本地Solana环境"></a>启动本地Solana环境</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">启动本地节点：</span><br><span class="line">solana-test-validator</span><br><span class="line"></span><br><span class="line">配置Solana Cli使用本地节点：</span><br><span class="line">solana config <span class="built_in">set</span> --url http://localhost:8899</span><br><span class="line"></span><br><span class="line">查看配置地址是否正确：</span><br><span class="line">solana config get  </span><br></pre></td></tr></table></figure>

<h1 id="通过区块链浏览器查看账户交易"><a href="#通过区块链浏览器查看账户交易" class="headerlink" title="通过区块链浏览器查看账户交易"></a>通过区块链浏览器查看账户交易</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">例如</span><br><span class="line">https://explorer.solana.com/address/[钱包地址]?cluster=devnet</span><br><span class="line"></span><br><span class="line">也可以在浏览里面切换localnet、testnet等。</span><br></pre></td></tr></table></figure>

<h1 id="其他参考链接："><a href="#其他参考链接：" class="headerlink" title="其他参考链接："></a>其他参考链接：</h1><p><a target="_blank" rel="noopener" href="https://solana.com/zh/docs/intro/installation#install-anchor-cli">https://solana.com/zh/docs/intro/installation#install-anchor-cli</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">45</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="qsunou@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">QsunOu</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
