<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Learning about Rust">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Learning about Rust">
<meta property="og:locale">
<meta property="article:author" content="QsunOu">
<meta property="article:tag" content="rust">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/page/2/"/>





  <title>Hexo</title>
  








<meta name="generator" content="Hexo 7.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/01/Rust-lesson-18/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/11/01/Rust-lesson-18/" itemprop="url">Rust lesson 18 - 生命周期</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-01T17:09:40+08:00">
                2024-11-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="为什么需要生命周期注解？"><a href="#为什么需要生命周期注解？" class="headerlink" title="为什么需要生命周期注解？"></a>为什么需要生命周期注解？</h1><h2 id="引用的有效范围："><a href="#引用的有效范围：" class="headerlink" title="引用的有效范围："></a>引用的有效范围：</h2><p>当函数返回一个引用时，编译器需要确保这个引用在其生命周期内始终有效。<br>如果没有生命周期注解，编译器无法确定返回的引用 &amp;str 的生命周期与输入引用 x 和 y 的生命周期之间的关系。</p>
<h2 id="悬垂引用："><a href="#悬垂引用：" class="headerlink" title="悬垂引用："></a>悬垂引用：</h2><p>悬垂引用是指指向已经释放的内存的引用。这是非常危险的，因为它会导致未定义行为。<br>生命周期注解帮助编译器确保返回的引用在其生命周期内始终有效，从而避免悬垂引用。</p>
<h2 id="创建生命周期："><a href="#创建生命周期：" class="headerlink" title="创建生命周期："></a>创建生命周期：</h2><p>生命周期主要通过生命周期注解来创建和使用。使用显示声明，例如<code>&#39;a</code>这种单引号加字母的方式，至于字母是什么无所谓，有单引号就行。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x27;a 是一个生命周期参数，表示 x 和 y 的生命周期至少与返回的引用的生命周期一样长</span></span><br><span class="line"><span class="comment">//x: &amp;&#x27;a str 和 y: &amp;&#x27;a str 表示 x 和 y 都是生命周期为 &#x27;a 的字符串切片</span></span><br><span class="line"><span class="comment">//-&gt; &amp;&#x27;a str 表示返回的字符串切片的生命周期也是 &#x27;a</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">longest</span>&lt;<span class="symbol">&#x27;a</span>&gt;(x: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>, y: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> x.<span class="title function_ invoke__">len</span>() &gt; y.<span class="title function_ invoke__">len</span>()&#123;</span><br><span class="line">        x</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="生命周期类别："><a href="#生命周期类别：" class="headerlink" title="生命周期类别："></a>生命周期类别：</h1><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">example</span>&lt;<span class="symbol">&#x27;a</span>&gt;(input: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span> &#123;</span><br><span class="line">    input</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Example</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    a: &amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">StringOption</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(&amp;<span class="symbol">&#x27;a</span> <span class="type">str</span>),</span><br><span class="line">    <span class="literal">None</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;a</span>, <span class="symbol">&#x27;b</span>&gt; StringOption &lt;<span class="symbol">&#x27;a</span>, <span class="symbol">&#x27;b</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="特殊生命周期标注"><a href="#特殊生命周期标注" class="headerlink" title="特殊生命周期标注"></a>特殊生命周期标注</h1><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//&#x27;static 是特殊的生命周期。</span></span><br><span class="line"><span class="comment">//&#x27;static 是 Rust 中最长的生命周期，表示引用在整个程序的生命周期内都是有效的。(注意整个程序)，通常用于全局变量和字符串字面量。</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s</span>: &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SOME_COORDINATE: (<span class="type">i32</span>, <span class="type">i32</span>) = (<span class="number">7</span>, <span class="number">4</span>);</span><br><span class="line"><span class="comment">//static_reference 是一个指向 SOME_COORDINATE 的引用，具有 &#x27;static 生命周期。</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">static_reference</span>: &amp;<span class="symbol">&#x27;static</span> (<span class="type">i32</span>, <span class="type">i32</span>) = &amp;SOME_COORDINATE;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Counter</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    counter: &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> <span class="type">i32</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//impl&lt;&#x27;a&gt; Counter&lt;&#x27;a&gt; 能简写成下面这样</span></span><br><span class="line"><span class="comment">//&#x27;_&#x27; 是一个匿名生命周期参数，表示编译器会自动推断出适当的生命周期。</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Counter</span>&lt;<span class="symbol">&#x27;_</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">increment</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        *<span class="keyword">self</span>.counter += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/31/Rust-lesson-17/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/31/Rust-lesson-17/" itemprop="url">Rust lesson 17 - 泛型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-10-31T21:04:04+08:00">
                2024-10-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="What-is-泛型："><a href="#What-is-泛型：" class="headerlink" title="What is 泛型："></a>What is 泛型：</h1><p>泛型（Generics）是编程语言中的一种特性，允许你在编写代码时使用占位符（类型参数）来代替具体的类型。通过以下使用场景，你就能理解是干什么的了。</p>
<h1 id="泛型使用场景："><a href="#泛型使用场景：" class="headerlink" title="泛型使用场景："></a>泛型使用场景：</h1><h2 id="泛型函数减少了代码重复，一个顶三个，简单示例："><a href="#泛型函数减少了代码重复，一个顶三个，简单示例：" class="headerlink" title="泛型函数减少了代码重复，一个顶三个，简单示例："></a>泛型函数减少了代码重复，一个顶三个，简单示例：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">add_i8</span>(a:<span class="type">i8</span>, b:<span class="type">i8</span>) <span class="punctuation">-&gt;</span> <span class="type">i8</span> &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">add_i32</span>(a:<span class="type">i32</span>, b:<span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">add_f64</span>(a:<span class="type">f64</span>, b:<span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//T 是一个泛型参数，表示任意类型,没啥特殊含义，你用ABCDEFG都行。</span></span><br><span class="line"><span class="comment">//std::ops::Add&lt;Output = T&gt; 是一个 trait 约束，表示类型 T 必须实现了 Add trait，并且加法操作的结果类型也是 T。</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">add</span>&lt;T : std::ops::Add&lt;Output = T&gt;&gt;(a:T, b:T) <span class="punctuation">-&gt;</span> T &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="comment">//2i8,就是2（i8类型）</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;add i8: &#123;&#125;&quot;</span>,<span class="title function_ invoke__">add_i8</span>(<span class="number">2i8</span>, <span class="number">3i8</span>));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;add i32: &#123;&#125;&quot;</span>,<span class="title function_ invoke__">add_i32</span>(<span class="number">20</span>, <span class="number">30</span>));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;add f64: &#123;&#125;&quot;</span>,<span class="title function_ invoke__">add_f64</span>(<span class="number">1.23</span>, <span class="number">1.23</span>));</span><br><span class="line">    <span class="title function_ invoke__">add</span>(<span class="number">2i8</span>, <span class="number">3i8</span>);</span><br><span class="line">    <span class="title function_ invoke__">add</span>(<span class="number">20</span>, <span class="number">30</span>);</span><br><span class="line">    <span class="title function_ invoke__">add</span>(<span class="number">1.23</span>, <span class="number">1.23</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="复杂一点的例子-比较大小-："><a href="#复杂一点的例子-比较大小-：" class="headerlink" title="复杂一点的例子(比较大小)："></a>复杂一点的例子(比较大小)：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//list: &amp;[T] 表示 list 是一个切片，切片是一个指向数组的引用，可以是任何长度的数组的一部分。</span></span><br><span class="line"><span class="comment">//-&gt; &amp;T 表示返回一个指向切片中元素的引用。</span></span><br><span class="line"><span class="comment">//通过实现 std::cmp::PartialOrd，可以在泛型函数或泛型结构中允许使用比较操作。</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">larget</span>&lt;T: std::cmp::<span class="built_in">PartialOrd</span>&gt;(list: &amp;[T])<span class="punctuation">-&gt;</span> &amp;T &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">largest</span> = &amp;list[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">item</span> <span class="keyword">in</span> list &#123;</span><br><span class="line">        <span class="keyword">if</span> item &gt; largest &#123;</span><br><span class="line">            largest = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>  largest;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number_list</span> = <span class="built_in">vec!</span>[<span class="number">34</span>, <span class="number">50</span>, <span class="number">25</span>, <span class="number">100</span>, <span class="number">65</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">larget</span>(&amp;number_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest number is &#123;&#125;&quot;</span>, result);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">char_list</span> = <span class="built_in">vec!</span>[<span class="string">&#x27;y&#x27;</span>,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;q&#x27;</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">larget</span>(&amp;char_list);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The largest char is &#123;&#125;&quot;</span>,result);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="结构体中使用泛型："><a href="#结构体中使用泛型：" class="headerlink" title="结构体中使用泛型："></a>结构体中使用泛型：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//T 和 U区分两个类型</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;T,U&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: U,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p1</span> = Point&#123;x:<span class="number">5</span> , y:<span class="number">10</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p2</span> = Point&#123;x:<span class="number">1.0</span> , y:<span class="number">1.0</span>&#125;;</span><br><span class="line">    <span class="comment">//如果上面是struct是&lt;T&gt;,会报错，因为x和y是不同类型。</span></span><br><span class="line">    <span class="comment">//但写成&lt;T ,U&gt;,区分开不同类型，就不会报错。</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p3</span> = Point&#123;x: <span class="number">5</span>, y: <span class="number">4.0</span>&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="枚举中用泛型："><a href="#枚举中用泛型：" class="headerlink" title="枚举中用泛型："></a>枚举中用泛型：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Option</span>&lt;T&gt; &#123;</span><br><span class="line">	<span class="title function_ invoke__">Some</span>(T),</span><br><span class="line">	<span class="literal">None</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;T, E&gt; &#123;</span><br><span class="line">	<span class="title function_ invoke__">Ok</span>(T),</span><br><span class="line">	<span class="title function_ invoke__">Err</span>(E),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实现方法使用泛型："><a href="#实现方法使用泛型：" class="headerlink" title="实现方法使用泛型："></a>实现方法使用泛型：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&lt;T,U&gt; &#123;</span><br><span class="line">    x: T,</span><br><span class="line">    y: U,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//为结构体实现方法，使用泛型要在impl后面加&lt;T, U&gt;</span></span><br><span class="line"><span class="keyword">impl</span>&lt;T, U&gt; Point&lt;T,U&gt;&#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">x</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;T&#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.x</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//接受另一个 Point 实例 other，返回一个新的 Point 实例，其 x 字段来自 self，y 字段来自 other。</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">mixup</span>&lt;T2, U2&gt;(<span class="keyword">self</span>, other: Point&lt;T2, U2&gt;) <span class="punctuation">-&gt;</span> Point&lt;T, U2&gt; &#123;</span><br><span class="line">        Point &#123;</span><br><span class="line">            x: <span class="keyword">self</span>.x,</span><br><span class="line">            y: other.y,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">p4</span> = Point &#123; x:<span class="number">5</span> , y:<span class="number">10.4</span>&#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p5</span> = Point &#123; x: <span class="string">&quot;Hello&quot;</span>, y: <span class="string">&#x27;c&#x27;</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//p4的 x 和 p5的 y 混合</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p6</span> = p4.<span class="title function_ invoke__">mixup</span>(p5);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;p6.x is &#123;&#125;,p6.y is &#123;&#125;&quot;</span>,p6.x,p6.y);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* let p1 = Point&#123;x:5 , y:10 &#125;;</span></span><br><span class="line"><span class="comment">    let p2 = Point&#123;x:1.0 , y:1.0&#125;;</span></span><br><span class="line"><span class="comment">    let p3 = Point&#123;x: 5, y: 4.0&#125;; */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="const使用泛型："><a href="#const使用泛型：" class="headerlink" title="const使用泛型："></a>const使用泛型：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">display_array</span>(arr: [<span class="type">i32</span>; <span class="number">3</span>]) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, arr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//接受一个切片arr（slice）,元素类型为 T 作为参数，并使用 std::fmt::Debug trait 将切片的内容打印出来</span></span><br><span class="line"><span class="comment">//切片是一个指向数组的引用，可以是任何长度的数组的一部分</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">display_array1</span>&lt;T: std::fmt::<span class="built_in">Debug</span>&gt;(arr: &amp;[T]) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, arr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//const N: usize：这是一个常量泛型参数，表示数组的大小 N 是一个常量, 大小事 usize</span></span><br><span class="line"><span class="comment">//arr: [T; N]：函数接受一个固定大小的数组 arr，数组中的元素类型为 T，大小为 N</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">display_array2</span>&lt;T: std::fmt::<span class="built_in">Debug</span>, <span class="keyword">const</span> N: <span class="type">usize</span> &gt;(arr: [T; N]) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, arr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">arr</span>: [<span class="type">i32</span>; <span class="number">3</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="title function_ invoke__">display_array</span>(arr); </span><br><span class="line"></span><br><span class="line">    <span class="comment">/* //这样不行，因为display_array(arr: [i32; 3])</span></span><br><span class="line"><span class="comment">    let arr2: [i32; 2] = [1, 2];</span></span><br><span class="line"><span class="comment">    display_array(arr2); */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span>: [<span class="type">i32</span>; <span class="number">3</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="title function_ invoke__">display_array1</span>(&amp;arr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span>: [<span class="type">i32</span>; <span class="number">2</span>] = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">    <span class="title function_ invoke__">display_array1</span>(&amp;arr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span>: [<span class="type">i32</span>; <span class="number">3</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="title function_ invoke__">display_array2</span>(arr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">arr</span>: [<span class="type">i32</span>; <span class="number">2</span>] = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">    <span class="title function_ invoke__">display_array2</span>(arr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/31/Rust-lesson-16/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/31/Rust-lesson-16/" itemprop="url">Rust lesson 16 - 智能指针 Box</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-10-31T14:43:37+08:00">
                2024-10-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="What-is-智能指针："><a href="#What-is-智能指针：" class="headerlink" title="What is 智能指针："></a>What is 智能指针：</h1><p>智能指针（Smart Pointer）是一种数据结构，它不仅包含一个指针，还附加了一些额外的信息和功能。智能指针的主要目的是管理指针的生命周期，自动处理内存的分配和释放，从而避免内存泄漏和其他常见的内存管理错误。</p>
<h1 id="智能指针特点："><a href="#智能指针特点：" class="headerlink" title="智能指针特点："></a>智能指针特点：</h1><ol>
<li>自动管理内存：<br>智能指针在不需要时会自动释放其所管理的资源，避免内存泄漏。</li>
<li>所有权和借用规则：<br>智能指针遵循 Rust 的所有权和借用规则，确保数据的安全性和一致性。</li>
<li>附加功能：<br>智能指针通常附带额外的功能，如引用计数、内部可变性、互斥锁等，以满足不同的需求。</li>
</ol>
<h1 id="基本概念之一："><a href="#基本概念之一：" class="headerlink" title="基本概念之一："></a>基本概念之一：</h1><p><code>Box&lt;T&gt;</code>智能指针：<br>    用途：用于在堆上分配内存。<br>    特点：当 Box 被丢弃时，它所指向的堆上的内存会被自动释放。</p>
<h1 id="Box-使用场景："><a href="#Box-使用场景：" class="headerlink" title="Box 使用场景："></a>Box 使用场景：</h1><h2 id="堆分配："><a href="#堆分配：" class="headerlink" title="堆分配："></a>堆分配：</h2><p><code>Box</code> 是一个智能指针，用于在堆上分配内存。当你使用 <code>Box::new</code> 创建一个 <code>Box</code> 时，它会在堆上分配内存，并返回一个指向该内存的指针</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,b); </span><br><span class="line">    <span class="comment">//或者println!(&quot;&#123;&#125;&quot;, *b);  *解引用 Box，获取内部的值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="动态大小类型："><a href="#动态大小类型：" class="headerlink" title="动态大小类型："></a>动态大小类型：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="comment">//into 方法在这里将字符串字面量转换为 Box&lt;str&gt;。</span></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s</span> : <span class="type">Box</span>&lt;<span class="type">str</span>&gt; = <span class="string">&quot;Hello&quot;</span>.<span class="title function_ invoke__">into</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//将 Vec&lt;i32&gt; 转换为 Box&lt;[i32]&gt;。into_boxed_slice 方法将 Vec 转换为一个指向固定大小数组的 Box。</span></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">arr</span> : <span class="type">Box</span>&lt;[<span class="type">i32</span>]&gt; = <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].<span class="title function_ invoke__">into_boxed_slice</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, arr);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="递归数据结构："><a href="#递归数据结构：" class="headerlink" title="递归数据结构："></a>递归数据结构：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">List</span> &#123;</span><br><span class="line">	<span class="comment">//Cons(i32, Box&lt;List&gt;)：表示一个包含整数和指向下一个 List 元素的智能指针的节点,像链表</span></span><br><span class="line">	<span class="title function_ invoke__">Cons</span>(<span class="type">i32</span>, <span class="type">Box</span>&lt;List&gt;),</span><br><span class="line">    Nil,</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">//use List::&#123;Cons, Nil&#125;;：引入 Cons 和 Nil 变体，以便在 main 函数中直接使用</span></span><br><span class="line"><span class="keyword">use</span> List::&#123;Cons, Nil&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="comment">//创建一个包含两个元素的列表 [1, 2]。</span></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">list</span> = List::<span class="title function_ invoke__">Cons</span>(<span class="number">1</span>, <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(List::<span class="title function_ invoke__">Cons</span>(<span class="number">2</span>, <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(List::Nil))));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="类型擦除（Type-Erasure）："><a href="#类型擦除（Type-Erasure）：" class="headerlink" title="类型擦除（Type Erasure）："></a>类型擦除（Type Erasure）：</h2><p>类型擦除是指在编译时将具体类型信息“擦除”，只保留一个通用的接口或 trait。这样，不同类型的对象可以通过相同的接口进行操作，而不需要知道它们的具体类型。</p>
<h3 id="动态调度（Dynamic-Dispatch）："><a href="#动态调度（Dynamic-Dispatch）：" class="headerlink" title="动态调度（Dynamic Dispatch）："></a>动态调度（Dynamic Dispatch）：</h3><p>动态调度是指在运行时确定调用哪个具体方法的过程。与之相对的是静态调度（也称为单态化），在编译时就确定了调用的具体方法。</p>
<h3 id="dyn关键字："><a href="#dyn关键字：" class="headerlink" title="dyn关键字："></a>dyn关键字：</h3><p><code>dyn</code>用于指定动态分发的类型，它允许在运行时决定具体类型（而不是像平时那样在编译的时候决定），用于实现动态分发的trait对象。</p>
<h3 id="问题背景："><a href="#问题背景：" class="headerlink" title="问题背景："></a>问题背景：</h3><p>由于静态类型系统和所有权模型，直接将不同类型的对象放入同一个集合（如 <code>Vec</code>）中是不允许的。这是因为 <code>Vec</code> 需要知道它存储的元素的具体类型和大小。为了解决这个问题，我们可以使用动态类型（如 <code>Box&lt;dyn Trait&gt;</code>）来存储实现了特定 trait 的不同类型的对象。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义了一个 speak 方法，所有实现了 Animal trait 的类型都必须实现这个方法。</span></span><br><span class="line"><span class="comment">//如果再加一个方法，下面的impl也一定要加</span></span><br><span class="line"><span class="keyword">trait</span>  <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">speak</span>(&amp;<span class="keyword">self</span>);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Dog</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Cat</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//由于impl Animal，所以一定要实现speak</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Animal</span> <span class="keyword">for</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">speak</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;haba dog&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Animal</span> <span class="keyword">for</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">speak</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;dudu cat&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">box_study</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这样会报错</span></span><br><span class="line">    <span class="comment">//因为Dog 和 Cat 不是同一类型，所以报错</span></span><br><span class="line">    <span class="comment">//let animals = vec![Dog,Cat];     </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//dyn Animal表示实现了 Animal trait 的动态类型。</span></span><br><span class="line">    <span class="comment">//Box::new：将具体类型的对象转换为 Box&lt;dyn Animal&gt; 类型。</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">animals</span> : <span class="type">Vec</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Animal&gt;&gt; = <span class="built_in">vec!</span>[<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Dog),<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Cat)];</span><br><span class="line">    <span class="comment">//iter（）方法遍历 Vec</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">animal</span> <span class="keyword">in</span> animals.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">        animal.<span class="title function_ invoke__">speak</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="具体解释"><a href="#具体解释" class="headerlink" title="具体解释"></a>具体解释</h4><ol>
<li><p><strong>静态类型和大小</strong>：</p>
<ul>
<li>在 Rust 中，<code>Vec&lt;T&gt;</code> 需要知道它存储的元素的具体类型 <code>T</code> 和大小。这是为了确保内存布局和性能优化。</li>
<li>例如，<code>Vec&lt;Dog&gt;</code> 和 <code>Vec&lt;Cat&gt;</code> 是两个不同的类型，它们的元素大小和布局是固定的。</li>
</ul>
</li>
<li><p>**动态类型 <code>Box&lt;dyn Animal&gt;</code>**：</p>
<ul>
<li><code>Box&lt;dyn Animal&gt;</code> 是一个智能指针，指向实现了 <code>Animal</code> trait 的对象。<code>dyn Animal</code> 表示一个动态类型，它只知道对象实现了 <code>Animal</code> trait，但不知道具体类型。</li>
<li><code>Box&lt;dyn Animal&gt;</code> 的大小是固定的，因为它只是一个指针（通常是 8 字节或 16 字节，取决于平台）。</li>
</ul>
</li>
<li><p><strong>类型擦除</strong>：</p>
<ul>
<li>当你将 <code>Dog</code> 和 <code>Cat</code> 转换为 <code>Box&lt;dyn Animal&gt;</code> 时，具体类型信息被“擦除”，只剩下 <code>Animal</code> trait 的接口。</li>
<li>这意味着 <code>Box&lt;dyn Animal&gt;</code> 可以指向任何实现了 <code>Animal</code> trait 的对象，无论其具体类型是什么。</li>
</ul>
</li>
<li><p><strong>动态调度</strong>：</p>
<ul>
<li>当你调用 <code>animal.speak()</code> 时，Rust 运行时会根据 <code>Box&lt;dyn Animal&gt;</code> 指向的具体对象来确定调用哪个实现的 <code>speak</code> 方法。</li>
<li>这种动态调度是在运行时进行的，而不是在编译时确定的。</li>
</ul>
</li>
</ol>
<h2 id="内存管理和性能优化："><a href="#内存管理和性能优化：" class="headerlink" title="内存管理和性能优化："></a>内存管理和性能优化：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="comment">//Box::new([0u8; 1_000_000])：在堆上分配内存，适合处理大型数据结构，避免栈溢出。</span></span><br><span class="line">	<span class="comment">//Box::new([0u8; 1_000_000])：涉及堆分配和指针管理，可能会有轻微的性能开销。</span></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">large_arr</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>([<span class="number">0u8</span>;<span class="number">1_000_000</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//[0u8; 1_000_000]：在栈上分配内存，适合处理较小的数据结构。</span></span><br><span class="line">	<span class="comment">//[0u8; 1_000_000]：直接在栈上分配内存，访问速度快，但栈空间有限。</span></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">array</span> = [<span class="number">0u8</span>;<span class="number">1_000_000</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Box-的优缺点："><a href="#Box-的优缺点：" class="headerlink" title="Box 的优缺点："></a>Box 的优缺点：</h1><h2 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h2><ol>
<li>提供堆内存分配，支持复杂数据结构。</li>
<li>与Rust的所有权系统完美继承，确保内存安全</li>
<li>动态分配对象，实现类型擦除。</li>
</ol>
<h2 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h2><ol>
<li>需要堆内存分配和释放，可能带来性能开销。</li>
<li>不适合需要频繁分配和释放的场景。</li>
</ol>
<h1 id="Drop、Deref、DerefMut"><a href="#Drop、Deref、DerefMut" class="headerlink" title="Drop、Deref、DerefMut:"></a>Drop、Deref、DerefMut:</h1><h2 id="Drop"><a href="#Drop" class="headerlink" title="Drop:"></a>Drop:</h2><p><code>Drop</code> trait 用于定义当一个值离开作用域时（即被丢弃时）应该执行的清理操作。这对于资源管理非常有用，特别是对于那些需要显式释放资源的情况。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Resource</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Drop</span> <span class="keyword">for</span> <span class="title class_">Resource</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">drop</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Dropping &#123;&#125;&quot;</span>,<span class="keyword">self</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">_rest1</span> = Resource&#123; name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Resource 1&quot;</span>)&#125;;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">_rest2</span> = Resource&#123; name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Resource 2&quot;</span>)&#125;;</span><br><span class="line">        <span class="comment">// rest 2 的 drop在离开作用域时隐式调用</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// rest 1 的 drop在离开作用域时隐式调用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Deref"><a href="#Deref" class="headerlink" title="Deref:"></a>Deref:</h2><p><code>Deref</code> trait 用于实现解引用操作，即 <code>*</code> 操作符。通过实现 <code>Deref</code>，可以将自定义类型转换为不可变引用（<code>&amp;T</code>）。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::ops::Deref;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个泛型结构体 MyBox，包含一个泛型字段 T。</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MyBox</span>&lt;T&gt;(T);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt;MyBox&lt;T&gt; &#123;</span><br><span class="line">	<span class="comment">//为 MyBox 实现一个构造函数 new，接受一个泛型参数 x，返回一个 MyBox&lt;T&gt; 实例。</span></span><br><span class="line">	<span class="keyword">fn</span> <span class="title function_">new</span>(x: T) <span class="punctuation">-&gt;</span> MyBox&lt;T&gt;&#123;</span><br><span class="line">        <span class="title function_ invoke__">MyBox</span>(x)</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Deref <span class="keyword">for</span> <span class="title class_">MyBox</span>&lt;T&gt; &#123;</span><br><span class="line">	<span class="comment">//指定Deref trait 的目标类型为 T</span></span><br><span class="line">	<span class="keyword">type</span> <span class="title class_">Target</span> = T;</span><br><span class="line">	<span class="comment">// 回 `MyBox` 内部存储的 `T` 类型的引用。</span></span><br><span class="line">	<span class="keyword">fn</span> <span class="title function_">deref</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;T &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;deref called&quot;</span>);</span><br><span class="line">        &amp;<span class="keyword">self</span>.<span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = MyBox::<span class="title function_ invoke__">new</span>(x);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;x= &#123;&#125;&quot;</span>, x);</span><br><span class="line">    <span class="comment">//*y 解引用 y，获取y的值</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;y= &#123;&#125;&quot;</span>, *y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="DerefMut："><a href="#DerefMut：" class="headerlink" title="DerefMut："></a>DerefMut：</h2><p><code>DerefMut</code> trait 用于实现可变解引用操作，即 <code>*</code> 操作符应用于可变引用。通过实现 <code>DerefMut</code>，可以将自定义类型转换为可变引用（<code>&amp;mut T</code>）。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::ops::Deref;</span><br><span class="line"><span class="keyword">use</span> std::ops::DerefMut;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MyBox</span>&lt;T&gt;(T);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt;MyBox&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(x: T) <span class="punctuation">-&gt;</span> MyBox&lt;T&gt;&#123;</span><br><span class="line">        <span class="title function_ invoke__">MyBox</span>(x)</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Deref <span class="keyword">for</span> <span class="title class_">MyBox</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Target</span> = T;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">deref</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;T &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;deref called&quot;</span>);</span><br><span class="line">        &amp;<span class="keyword">self</span>.<span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; DerefMut <span class="keyword">for</span> <span class="title class_">MyBox</span>&lt;T&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">deref_mut</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> T &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;deref_mut called&quot;</span>);</span><br><span class="line">        &amp;<span class="keyword">mut</span> <span class="keyword">self</span>.<span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">x</span> = MyBox::<span class="title function_ invoke__">new</span>(<span class="number">5</span>);</span><br><span class="line">	<span class="comment">//使用 *x 解引用 MyBox，实际调用 deref_mut 方法获取 x 内部的可变引用，然后赋值为 10。</span></span><br><span class="line">	*x = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;x = &#123;&#125;&quot;</span>,*x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出结果：</span></span><br><span class="line"><span class="comment">//deref_mut called (在 *x = 10; 时，调用了 deref_mut 方法，输出 deref_mut called。</span></span><br><span class="line"><span class="comment">//deref called (在 println!(&quot;x = &#123;&#125;&quot;, *x); 时，调用了 deref 方法，输出 deref called。</span></span><br><span class="line"><span class="comment">//x = 10 (通过解引用 x，获取 x 内部的 i32 值，输出 10。</span></span><br></pre></td></tr></table></figure>

<p>解引用操作（Deref）和可变解引用（DerefMut）区别：</p>
<h3 id="主要区别"><a href="#主要区别" class="headerlink" title="主要区别"></a>主要区别</h3><ol>
<li><p><strong>引用类型</strong>：</p>
<ul>
<li><strong>解引用操作</strong>：返回不可变引用（<code>&amp;T</code>）。</li>
<li><strong>可变解引用操作</strong>：返回可变引用（<code>&amp;mut T</code>）。</li>
</ul>
</li>
<li><p><strong>数据访问权限</strong>：</p>
<ul>
<li><strong>解引用操作</strong>：只能读取数据，不能修改数据。</li>
<li><strong>可变解引用操作</strong>：可以读取和修改数据。</li>
</ul>
</li>
<li><p><strong>使用场景</strong>：</p>
<ul>
<li><strong>解引用操作</strong>：适用于需要读取数据的场景，如打印、计算等。</li>
<li><strong>可变解引用操作</strong>：适用于需要修改数据的场景，如更新、重置等。</li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/28/Rust-lesson-15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/28/Rust-lesson-15/" itemprop="url">Rust lesson 15 - 模块化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-10-28T17:13:12+08:00">
                2024-10-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="包（package）"><a href="#包（package）" class="headerlink" title="包（package）"></a>包（package）</h1><p>包（package）是一个包含一个或多个 crates 的目录树。包是 Rust 项目的基本单位，可以是一个库（library）或一个可执行文件（binary），也可以同时包含两者。包通常由 Cargo.toml 文件定义，这是一个配置文件，用于指定包的元数据、依赖关系和其他构建选项。</p>
<h2 id="包的结构："><a href="#包的结构：" class="headerlink" title="包的结构："></a>包的结构：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my_package/</span><br><span class="line">├── Cargo.toml</span><br><span class="line">├── src/</span><br><span class="line">│   ├── lib.rs  # 库入口文件（如果包是一个库）</span><br><span class="line">│   └── main.rs  # 可执行文件入口文件（如果包是一个二进制程序）</span><br><span class="line">└── tests/  # 集成测试文件</span><br></pre></td></tr></table></figure>

<h2 id="包的组成："><a href="#包的组成：" class="headerlink" title="包的组成："></a>包的组成：</h2><ol>
<li>cargo.toml</li>
</ol>
<ul>
<li>这是包的配置文件，定义了包的元数据、依赖关系和其他构建选项。</li>
<li>一个基本的 <code>Cargo.toml</code> 文件可能如下所示：&#96;&#96;&#96;rust</li>
</ul>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;my_package&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">&quot;Your Name &lt;you@example.com&gt;&quot;</span>]</span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2021&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">serde</span> = <span class="string">&quot;1.0&quot;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>src&#x2F; 目录：</li>
</ol>
<ul>
<li>包含源代码文件。</li>
<li><code>lib.rs</code>：库的入口文件。如果包是一个库，这是主文件。</li>
<li><code>main.rs</code>：可执行文件的入口文件。如果包是一个二进制程序，这是主文件。</li>
</ul>
<ol start="3">
<li>tests&#x2F; 目录：</li>
</ol>
<ul>
<li>包含集成测试文件。每个文件都是一个单独的模块，可以包含多个测试函数。</li>
</ul>
<h2 id="包的类型："><a href="#包的类型：" class="headerlink" title="包的类型："></a>包的类型：</h2><ol>
<li>库包（Library Package）：<br> 提供可重用的代码。<br> 通常包含一个 lib.rs 文件。<br> 可以被其他包依赖。</li>
<li>可执行文件包（Binary Package）：<br> 生成一个可执行文件。<br> 通常包含一个 main.rs 文件。<br> 可以包含多个可执行文件（通过在 src&#x2F;bin&#x2F; 目录下添加多个 *.rs 文件）。</li>
<li>混合包（Mixed Package）：<br> 同时包含库和可执行文件。<br> 通常包含 lib.rs 和 main.rs 文件。</li>
</ol>
<h2 id="依赖管理："><a href="#依赖管理：" class="headerlink" title="依赖管理："></a>依赖管理：</h2><p>在 <code>Cargo.toml</code> 文件中，你可以指定包的依赖关系。依赖关系可以是其他包或本地路径。</p>
<h3 id="添加依赖："><a href="#添加依赖：" class="headerlink" title="添加依赖："></a>添加依赖：</h3><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">serde</span> = <span class="string">&quot;1.0&quot;</span></span><br><span class="line"><span class="attr">tokio</span> = &#123; version = <span class="string">&quot;1.0&quot;</span>, features = [<span class="string">&quot;full&quot;</span>] &#125;</span><br></pre></td></tr></table></figure>

<h3 id="本地路径依赖"><a href="#本地路径依赖" class="headerlink" title="本地路径依赖:"></a>本地路径依赖:</h3><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">my_local_lib</span> = &#123; path = <span class="string">&quot;../my_local_lib&quot;</span> &#125;</span><br></pre></td></tr></table></figure>


<h1 id="库（crates）"><a href="#库（crates）" class="headerlink" title="库（crates）"></a>库（crates）</h1><p>crate 是编译和链接的基本单位。一个 crate 可以是一个库（library）或一个可执行文件（binary），也可以同时包含两者。crate 是 Rust 项目的核心组成部分，通过 <code>Cargo.toml</code> 文件进行管理和配置。</p>
<h2 id="什么是库？"><a href="#什么是库？" class="headerlink" title="什么是库？"></a>什么是库？</h2><ol>
<li>库（Library Crate）：<br> 提供可重用的代码。<br> 通常包含一个 lib.rs 文件。<br> 可以被其他 crate 依赖。</li>
<li>可执行文件（Binary Crate）：<br> 生成一个可执行文件。<br> 通常包含一个 main.rs 文件。<br> 可以包含多个可执行文件（通过在 src&#x2F;bin&#x2F; 目录下添加多个 *.rs 文件）。</li>
</ol>
<h2 id="crate结构："><a href="#crate结构：" class="headerlink" title="crate结构："></a>crate结构：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my_crate/</span><br><span class="line">├── Cargo.toml</span><br><span class="line">├── src/</span><br><span class="line">│   ├── lib.rs  # 库入口文件（如果 <span class="keyword">crate</span> 是一个库）</span><br><span class="line">│   └── main.rs  # 可执行文件入口文件（如果 <span class="keyword">crate</span> 是一个二进制程序）</span><br><span class="line">└── tests/  # 集成测试文件</span><br></pre></td></tr></table></figure>

<h2 id="crate的类型："><a href="#crate的类型：" class="headerlink" title="crate的类型："></a>crate的类型：</h2><ol>
<li>库 crate：<br> 提供可重用的代码。<br> 通常包含一个 lib.rs 文件。<br> 可以被其他 crate 依赖。</li>
<li>可执行文件 crate：<br> 生成一个可执行文件。<br> 通常包含一个 main.rs 文件。<br> 可以包含多个可执行文件（通过在 src&#x2F;bin&#x2F; 目录下添加多个 *.rs 文件）。</li>
<li>混合 crate：<br> 同时包含库和可执行文件。<br> 通常包含 lib.rs 和 main.rs 文件。</li>
</ol>
<h2 id="依赖管理：-1"><a href="#依赖管理：-1" class="headerlink" title="依赖管理："></a>依赖管理：</h2><p>在 <code>Cargo.toml</code> 文件中，你可以指定 crate 的依赖关系。依赖关系可以是其他 crate 或本地路径。</p>
<h3 id="添加依赖：-1"><a href="#添加依赖：-1" class="headerlink" title="添加依赖："></a>添加依赖：</h3><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">serde</span> = <span class="string">&quot;1.0&quot;</span></span><br><span class="line"><span class="attr">tokio</span> = &#123; version = <span class="string">&quot;1.0&quot;</span>, features = [<span class="string">&quot;full&quot;</span>] &#125;</span><br></pre></td></tr></table></figure>

<h3 id="本地路径依赖："><a href="#本地路径依赖：" class="headerlink" title="本地路径依赖："></a>本地路径依赖：</h3><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">my_local_lib</span> = &#123; path = <span class="string">&quot;../my_local_lib&quot;</span> &#125;</span><br></pre></td></tr></table></figure>


<h1 id="包和库的区别："><a href="#包和库的区别：" class="headerlink" title="包和库的区别："></a>包和库的区别：</h1><ol>
<li><strong>范围</strong>：<ul>
<li><strong>包</strong>：是一个包含一个或多个 crates 的目录树，由 <code>Cargo.toml</code> 文件定义。</li>
<li><strong>库</strong>：是一个可重用的代码集合，通常包含一个 <code>lib.rs</code> 文件。</li>
</ul>
</li>
<li><strong>文件结构</strong>：<ul>
<li><strong>包</strong>：包含 <code>Cargo.toml</code> 文件、<code>src</code> 目录、测试文件等。</li>
<li><strong>库</strong>：主要包含 <code>src/lib.rs</code> 文件及其相关的模块文件。</li>
</ul>
</li>
<li><strong>功能</strong>：<ul>
<li><strong>包</strong>：管理项目的元数据、依赖关系和构建选项。</li>
<li><strong>库</strong>：提供可重用的代码，供其他 crate 使用。</li>
</ul>
</li>
<li><strong>用途</strong>：<ul>
<li><strong>包</strong>：用于组织和管理整个项目，可以发布到 crates.io。</li>
<li><strong>库</strong>：用于封装可重用的代码，提高代码的模块化和复用性。</li>
</ul>
</li>
</ol>
<h1 id="模块（mod"><a href="#模块（mod" class="headerlink" title="模块（mod)"></a>模块（mod)</h1><p>模块系统允许你将代码分成逻辑单元，提高代码的可读性和可维护性。</p>
<h2 id="模块系统的基本概念"><a href="#模块系统的基本概念" class="headerlink" title="模块系统的基本概念"></a>模块系统的基本概念</h2><ol>
<li><p><strong>模块</strong>：</p>
<ul>
<li>模块是一个包含其他项（如函数、结构体、枚举、其他模块等）的逻辑单元。</li>
<li>模块可以通过 <code>mod</code> 关键字定义。</li>
</ul>
</li>
<li><p><strong>可见性</strong>：</p>
<ul>
<li>默认情况下，模块中的项是私有的（private），只能在定义它们的模块内访问。</li>
<li>使用 <code>pub</code> 关键字可以将项声明为公有的（public），使其在父模块或其他模块中可见。</li>
</ul>
</li>
<li><p><strong>路径</strong>：</p>
<ul>
<li>路径是用于引用模块或模块中项的标识符，可以是绝对路径或相对路径。</li>
</ul>
</li>
<li><p><strong>重新导出</strong>：</p>
<ul>
<li>使用 <code>pub use</code> 关键字将模块中的项重新导出到父模块中，使其在父模块中可见。</li>
</ul>
</li>
</ol>
<p>项目结构示例：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">my_project/</span><br><span class="line">├── Cargo.toml</span><br><span class="line">└── src/</span><br><span class="line">    ├── lib.rs</span><br><span class="line">    └── shapes/</span><br><span class="line">        ├── <span class="keyword">mod</span>.rs</span><br><span class="line">        ├── circle.rs</span><br><span class="line">        └── rectangle.rs</span><br></pre></td></tr></table></figure>

<h3 id="定义模块"><a href="#定义模块" class="headerlink" title="定义模块"></a>定义模块</h3><ol>
<li><p>src&#x2F;lib.rs<br> 这是库的入口文件，定义顶层模块并重新导出子模块中的项。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/lib.rs</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> shapes::circle::draw_circle <span class="keyword">as</span> draw;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> shapes::rectangle::draw_rectangle <span class="keyword">as</span> draw_rect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">say_hello</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello from the library!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>src&#x2F;shapes&#x2F;mod.rs<br>这是 shapes 模块的入口文件，定义子模块。</p>
</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/shapes/mod.rs</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> circle;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> rectangle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">draw_shapes</span>() &#123;</span><br><span class="line">    circle::<span class="title function_ invoke__">draw_circle</span>();</span><br><span class="line">    rectangle::<span class="title function_ invoke__">draw_rectangle</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>src&#x2F;shapes&#x2F;circle.rs<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/shapes/circle.rs</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">draw_circle</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Drawing a circle&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">calculate_area</span>(radius: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">    std::<span class="type">f64</span>::consts::PI * radius * radius</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="使用模块"><a href="#使用模块" class="headerlink" title="使用模块"></a>使用模块</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.rs</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> my_project;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> my_project::&#123;draw, draw_rect&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    my_project::<span class="title function_ invoke__">say_hello</span>();</span><br><span class="line">    <span class="title function_ invoke__">draw</span>();          <span class="comment">// 调用 draw_circle</span></span><br><span class="line">    <span class="title function_ invoke__">draw_rect</span>();     <span class="comment">// 调用 draw_rectangle</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="工作区（workspace）"><a href="#工作区（workspace）" class="headerlink" title="工作区（workspace）"></a>工作区（workspace）</h1><p>工作区（workspace）是一种组织多个包（packages）的方式，这些包共享相同的依赖关系和构建配置。工作区允许你在单个 <code>Cargo.toml</code> 文件中管理多个包，从而简化大型项目的管理和构建过程。</p>
<h2 id="工作区的基本概念"><a href="#工作区的基本概念" class="headerlink" title="工作区的基本概念"></a>工作区的基本概念</h2><ol>
<li><strong>工作区</strong>：<ul>
<li>工作区是一个包含多个包的目录树。</li>
<li>每个包都有自己的 <code>Cargo.toml</code> 文件，但工作区有一个顶级的 <code>Cargo.toml</code> 文件来管理所有包的依赖关系和构建配置。</li>
</ul>
</li>
<li><strong>成员包</strong>：<ul>
<li>成员包是工作区中的每个包，每个包都可以是一个独立的库或可执行文件。</li>
<li>成员包的 <code>Cargo.toml</code> 文件可以指定自己的依赖关系和构建选项。</li>
</ul>
</li>
<li>**顶级 <code>Cargo.toml</code>**：<ul>
<li>顶级 <code>Cargo.toml</code> 文件定义了工作区的成员包，并可以指定共享的依赖关系和构建配置。</li>
</ul>
</li>
</ol>
<h2 id="工作区的结构"><a href="#工作区的结构" class="headerlink" title="工作区的结构"></a>工作区的结构</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">my_workspace/</span><br><span class="line">├── Cargo.toml  # 顶级 Cargo.toml 文件</span><br><span class="line">├── my_library/</span><br><span class="line">│   ├── Cargo.toml  # my_library 的 Cargo.toml 文件</span><br><span class="line">│   └── src/</span><br><span class="line">│       └── lib.rs</span><br><span class="line">└── my_binary/</span><br><span class="line">    ├── Cargo.toml  # my_binary 的 Cargo.toml 文件</span><br><span class="line">    └── src/</span><br><span class="line">        └── main.rs</span><br><span class="line">        </span><br></pre></td></tr></table></figure>

<h2 id="创建工作区："><a href="#创建工作区：" class="headerlink" title="创建工作区："></a>创建工作区：</h2><ol>
<li>创建顶级 Cargo.toml 文件：</li>
</ol>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[workspace]</span></span><br><span class="line"><span class="attr">members</span> = [</span><br><span class="line">    <span class="string">&quot;my_library&quot;</span>,</span><br><span class="line">    <span class="string">&quot;my_binary&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建成员包</li>
</ol>
<ul>
<li>使用 <code>cargo new</code> 命令创建成员包。<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cargo new my_library --lib</span><br><span class="line">cargo new my_binary</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="可见性-visibility"><a href="#可见性-visibility" class="headerlink" title="可见性(visibility)"></a>可见性(visibility)</h1><p>指代码项（如函数、结构体、枚举、模块等）在代码中的可见范围。</p>
<p>项目结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">my_project/</span><br><span class="line">├── Cargo.toml</span><br><span class="line">└── src/</span><br><span class="line">    ├── lib.rs</span><br><span class="line">    └── shapes/</span><br><span class="line">        ├── mod.rs</span><br><span class="line">        ├── circle.rs</span><br><span class="line">        └── rectangle.rs</span><br></pre></td></tr></table></figure>

<h2 id="可见性关键字"><a href="#可见性关键字" class="headerlink" title="可见性关键字"></a>可见性关键字</h2><ol>
<li>**<code>pub</code>**：<ul>
<li>将项声明为公有（public），使其在父模块及其子模块之外可见。</li>
<li>如果不使用 <code>pub</code>，项默认为私有（private），只能在定义它的模块内访问。</li>
</ul>
</li>
<li>**<code>pub(in path)</code>**：<ul>
<li>将项声明为在指定路径内的公有，限制其可见范围。</li>
<li><code>path</code> 可以是绝对路径或相对路径。</li>
</ul>
</li>
<li>**<code>pub(crate)</code>**：<ul>
<li>将项声明为在当前 crate 内公有，使其在整个 crate 内可见。</li>
</ul>
</li>
<li>**<code>pub(super)</code>**：<ul>
<li>将项声明为在其父模块内公有，使其在父模块及其子模块内可见。</li>
</ul>
</li>
</ol>
<h3 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h3><ol>
<li>公有（pub）：<br> 将项声明为公有，使其在父模块及其子模块之外可见。</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/shapes/circle.rs</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">draw_circle</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Drawing a circle&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">calculate_area</span>(radius: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">    std::<span class="type">f64</span>::consts::PI * radius * radius</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>限制可见范围（pub(in path)）：<br> 将项声明为在指定路径内的公有，限制其可见范围。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/shapes/circle.rs</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">draw_circle</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Drawing a circle&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">pub</span>(<span class="keyword">in</span> crate::shapes) <span class="keyword">fn</span> <span class="title function_">calculate_area</span>(radius: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">    std::<span class="type">f64</span>::consts::PI * radius * radius</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>当前 crate 内公有（pub(crate)）：<br> 将项声明为在当前 crate 内公有，使其在整个 crate 内可见。</p>
</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/shapes/circle.rs</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">draw_circle</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Drawing a circle&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">pub</span>(<span class="keyword">crate</span>) <span class="keyword">fn</span> <span class="title function_">calculate_area</span>(radius: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">    std::<span class="type">f64</span>::consts::PI * radius * radius</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>父模块内公有（pub(super)）：<br> 将项声明为在其父模块内公有，使其在父模块及其子模块内可见。</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/shapes/circle.rs</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">draw_circle</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Drawing a circle&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">pub</span>(<span class="keyword">super</span>) <span class="keyword">fn</span> <span class="title function_">calculate_area</span>(radius: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">    std::<span class="type">f64</span>::consts::PI * radius * radius</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="路径（Path）"><a href="#路径（Path）" class="headerlink" title="路径（Path）"></a>路径（Path）</h1><p>路径（Path）用于引用模块或模块中的项（如函数、结构体、枚举、常量等）。路径可以是绝对路径或相对路径，通过路径，你可以在代码中访问不同模块中的项。</p>
<h2 id="路径的基本概念"><a href="#路径的基本概念" class="headerlink" title="路径的基本概念"></a>路径的基本概念</h2><ol>
<li><strong>绝对路径</strong>：<ul>
<li>从根模块开始的路径。</li>
<li>根模块通常是 crate 的入口点（<code>lib.rs</code> 或 <code>main.rs</code>）。</li>
</ul>
</li>
<li><strong>相对路径</strong>：<ul>
<li>从当前模块开始的路径。</li>
<li>使用 <code>self</code>、<code>super</code> 和模块名称来表示相对路径。</li>
</ul>
</li>
</ol>
<h3 id="路径的语法"><a href="#路径的语法" class="headerlink" title="路径的语法"></a>路径的语法</h3><ol>
<li><strong>绝对路径</strong>：<ul>
<li>以 <code>crate</code>、<code>self</code> 或 <code>super</code> 开头。</li>
<li>例如：<code>crate::module::item</code>、<code>self::module::item</code>、<code>super::module::item</code>。</li>
</ul>
</li>
<li><strong>相对路径</strong>：<ul>
<li>从当前模块开始，使用模块名称。</li>
<li>例如：<code>module::item</code>。</li>
</ul>
</li>
</ol>
<p>示例目录结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">my_project/</span><br><span class="line">├── Cargo.toml</span><br><span class="line">└── src/</span><br><span class="line">    ├── lib.rs</span><br><span class="line">    └── shapes/</span><br><span class="line">        ├── mod.rs</span><br><span class="line">        ├── circle.rs</span><br><span class="line">        └── rectangle.rs</span><br></pre></td></tr></table></figure>

<h3 id="绝对路径示例"><a href="#绝对路径示例" class="headerlink" title="绝对路径示例"></a>绝对路径示例</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/main.rs</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">crate</span> my_project;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> my_project::shapes::circle::draw_circle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    my_project::<span class="title function_ invoke__">say_hello</span>();</span><br><span class="line">    <span class="title function_ invoke__">draw_circle</span>();  <span class="comment">// 调用 draw_circle</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="相对路径示例"><a href="#相对路径示例" class="headerlink" title="相对路径示例"></a>相对路径示例</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/shapes/mod.rs</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> circle;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> rectangle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">draw_shapes</span>() &#123;</span><br><span class="line">    self::circle::<span class="title function_ invoke__">draw_circle</span>();</span><br><span class="line">    self::rectangle::<span class="title function_ invoke__">draw_rectangle</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="单元测试（unit-test"><a href="#单元测试（unit-test" class="headerlink" title="单元测试（unit test)"></a>单元测试（unit test)</h1><p>单元测试（unit testing）是确保代码正确性和健壮性的重要手段。</p>
<h2 id="单元测试的基本概念"><a href="#单元测试的基本概念" class="headerlink" title="单元测试的基本概念"></a>单元测试的基本概念</h2><ol>
<li><strong>测试模块</strong>：<ul>
<li>测试代码通常放在模块的 <code>#[cfg(test)]</code> 属性中，这样测试代码不会在生产环境中编译。</li>
<li>每个模块可以有自己的测试模块。</li>
</ul>
</li>
<li><strong>测试函数</strong>：<ul>
<li>测试函数使用 <code>#[test]</code> 属性标记。</li>
<li>测试函数必须没有参数且返回类型为 <code>()</code>。</li>
</ul>
</li>
<li><strong>断言</strong>：<ul>
<li>使用 <code>assert!</code> 宏来检查条件是否为真。</li>
<li>使用 <code>assert_eq!</code> 和 <code>assert_ne!</code> 宏来比较值是否相等或不相等。</li>
</ul>
</li>
</ol>
<p>项目结构：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my_project/</span><br><span class="line">├── Cargo.toml</span><br><span class="line">└── src/</span><br><span class="line">    ├── lib.rs</span><br><span class="line">    └── tests/</span><br><span class="line">        └── integration_test.rs</span><br></pre></td></tr></table></figure>

<h3 id="代码示例："><a href="#代码示例：" class="headerlink" title="代码示例："></a>代码示例：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/lib.rs</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> math &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        a + b</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">subtract</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        a - b</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">multiply</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        a * b</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">divide</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Err</span>(<span class="string">&quot;Division by zero&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Ok</span>(a / b)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::math;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_add</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(math::<span class="title function_ invoke__">add</span>(<span class="number">2</span>, <span class="number">3</span>), <span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_subtract</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(math::<span class="title function_ invoke__">subtract</span>(<span class="number">5</span>, <span class="number">3</span>), <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_multiply</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(math::<span class="title function_ invoke__">multiply</span>(<span class="number">4</span>, <span class="number">5</span>), <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_divide</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(math::<span class="title function_ invoke__">divide</span>(<span class="number">10</span>, <span class="number">2</span>).<span class="title function_ invoke__">unwrap</span>(), <span class="number">5</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(math::<span class="title function_ invoke__">divide</span>(<span class="number">10</span>, <span class="number">0</span>).<span class="title function_ invoke__">is_err</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>**<code>pub mod math</code>**：<ul>
<li>定义了一个 <code>math</code> 模块，包含一些数学函数。</li>
</ul>
</li>
<li>**<code>#[cfg(test)] mod tests</code>**：<ul>
<li>定义了一个测试模块，只在测试配置中编译。</li>
</ul>
</li>
<li>**<code>#[test]</code>**：<ul>
<li>标记测试函数，这些函数将在运行测试时自动执行。</li>
</ul>
</li>
<li>**<code>assert_eq!</code> 和 <code>assert!</code>**：<ul>
<li><code>assert_eq!</code> 用于检查两个值是否相等。</li>
<li><code>assert!</code> 用于检查一个条件是否为真。</li>
</ul>
</li>
</ol>
<h3 id="运行单元测试："><a href="#运行单元测试：" class="headerlink" title="运行单元测试："></a>运行单元测试：</h3><ol>
<li><p>运行 cargo test</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">running 4 tests</span><br><span class="line">test tests::test_add ... ok</span><br><span class="line">test tests::test_subtract ... ok</span><br><span class="line">test tests::test_multiply ... ok</span><br><span class="line">test tests::test_divide ... ok</span><br><span class="line"></span><br><span class="line">test result: ok. 4 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="集成测试（Integration-Test"><a href="#集成测试（Integration-Test" class="headerlink" title="集成测试（Integration Test)"></a>集成测试（Integration Test)</h1><p>集成测试（integration testing）用于验证多个模块或组件之间的交互是否按预期工作。</p>
<h2 id="集成测试的基本概念"><a href="#集成测试的基本概念" class="headerlink" title="集成测试的基本概念"></a>集成测试的基本概念</h2><ol>
<li><p><strong>测试文件</strong>：</p>
<ul>
<li>集成测试文件通常放在 <code>tests</code> 目录下。</li>
<li>每个测试文件都是一个单独的 crate，可以独立编译和运行。</li>
</ul>
</li>
<li><p><strong>测试函数</strong>：</p>
<ul>
<li>测试函数使用 <code>#[test]</code> 属性标记。</li>
<li>测试函数必须没有参数且返回类型为 <code>()</code>。</li>
</ul>
</li>
<li><p><strong>断言</strong>：</p>
<ul>
<li>使用 <code>assert!</code> 宏来检查条件是否为真。</li>
<li>使用 <code>assert_eq!</code> 和 <code>assert_ne!</code> 宏来比较值是否相等或不相等。</li>
</ul>
</li>
</ol>
<p>继续沿用上面单元测试的目录结构</p>
<h3 id="创建集成测试文件："><a href="#创建集成测试文件：" class="headerlink" title="创建集成测试文件："></a>创建集成测试文件：</h3><p>在 tests 目录下创建一个新的文件，例如 integration_test.rs。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tests/integration_test.rs</span></span><br><span class="line"><span class="keyword">use</span> my_project::math;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">test_integration</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">sum</span> = math::<span class="title function_ invoke__">add</span>(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">product</span> = math::<span class="title function_ invoke__">multiply</span>(sum, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(product, <span class="number">20</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="运行集成测试："><a href="#运行集成测试：" class="headerlink" title="运行集成测试："></a>运行集成测试：</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<h3 id="忽略某些测试"><a href="#忽略某些测试" class="headerlink" title="忽略某些测试"></a>忽略某些测试</h3><p>如果你有一些测试需要在特定条件下运行，可以使用 <code>#[ignore]</code> 属性来忽略这些测试。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests &#123;</span><br><span class="line">    <span class="keyword">use</span> super::math;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_add</span>() &#123;</span><br><span class="line">        <span class="built_in">assert_eq!</span>(math::<span class="title function_ invoke__">add</span>(<span class="number">2</span>, <span class="number">3</span>), <span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[test]</span></span><br><span class="line">    <span class="meta">#[ignore]</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">test_long_running</span>() &#123;</span><br><span class="line">        <span class="comment">// 这个测试会被忽略</span></span><br><span class="line">        <span class="built_in">assert_eq!</span>(math::<span class="title function_ invoke__">add</span>(<span class="number">1000</span>, <span class="number">2000</span>), <span class="number">3000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="运行特定测试"><a href="#运行特定测试" class="headerlink" title="运行特定测试"></a>运行特定测试</h3><p>可以使用 <code>cargo test</code> 命令加上测试名称来运行特定的测试。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo test test_add</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/26/Rust-lesson-14/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/26/Rust-lesson-14/" itemprop="url">Rust lesson 14 - 返回值和错误处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-10-26T20:21:16+08:00">
                2024-10-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Opiton返回值"><a href="#Opiton返回值" class="headerlink" title="Opiton返回值"></a>Opiton返回值</h1><p><code>Option</code> 是一种用于表示可能缺失值的枚举类型。它有两个变体：<code>Some(T)</code> 表示存在一个值，<code>None</code> 表示不存在值。<code>Option</code> 常用于错误处理，特别是在可能没有结果的情况下。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Opiton</span>&lt;T&gt; &#123;</span><br><span class="line">	<span class="title function_ invoke__">Some</span>(T),</span><br><span class="line">	<span class="literal">None</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="基础示例："><a href="#基础示例：" class="headerlink" title="基础示例："></a>基础示例：</h2><p>&#96;</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">//返回 p1=Some(&#x27;A&#x27;),p1是 Option 类型</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p1</span> = s.<span class="title function_ invoke__">pop</span>();</span><br><span class="line">    dbg!(p1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回None,因为弹两次已经为空了。</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p2</span> = s.<span class="title function_ invoke__">pop</span>();</span><br><span class="line">    dbg!(p2); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="匹配Option："><a href="#匹配Option：" class="headerlink" title="匹配Option："></a>匹配Option：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">plus_one</span>(x: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; &#123;</span><br><span class="line">	<span class="keyword">match</span> x &#123;</span><br><span class="line">		<span class="literal">None</span> =&gt; <span class="literal">None</span>,</span><br><span class="line">		<span class="title function_ invoke__">Some</span>(i) =&gt; <span class="title function_ invoke__">Some</span>(i+<span class="number">1</span>),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">five</span> = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">six</span> = <span class="title function_ invoke__">plus_one</span>(five);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, six); </span><br></pre></td></tr></table></figure>

<h2 id="使用unwrap"><a href="#使用unwrap" class="headerlink" title="使用unwrap:"></a>使用unwrap:</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//unwrap</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    <span class="comment">//unwrap，有值的时候取值，没值就panic</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p1</span> = s.<span class="title function_ invoke__">pop</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="comment">//输出 o，把Some(o)的Some去掉了</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,p1); </span><br></pre></td></tr></table></figure>

<h2 id="使用is-some和is-none"><a href="#使用is-some和is-none" class="headerlink" title="使用is_some和is_none:"></a>使用<code>is_some</code>和<code>is_none</code>:</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//is_some 和 is_none</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">v</span> = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="comment">//判断 v[1]有没有值</span></span><br><span class="line"><span class="comment">//if !v.get(1).is_none()&#123;&#125; 相同效果</span></span><br><span class="line"><span class="keyword">if</span> v.<span class="title function_ invoke__">get</span>(<span class="number">1</span>).<span class="title function_ invoke__">is_some</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,v[<span class="number">1</span>]);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="使用-unwrap-or"><a href="#使用-unwrap-or" class="headerlink" title="使用 unwrap_or:"></a>使用 <code>unwrap_or</code>:</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"> <span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line"> <span class="comment">//b为0正常来讲会返回None，但unwrap_or可以设定其他默认返回值</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">r</span> = <span class="title function_ invoke__">div</span>(<span class="number">10</span>,<span class="number">0</span>).<span class="title function_ invoke__">unwrap_or</span>(<span class="number">0.0</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,r); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">fn</span> <span class="title function_">div</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">f64</span>&gt; &#123;</span><br><span class="line">    <span class="comment">//分母不能为0</span></span><br><span class="line">    <span class="keyword">if</span> b != <span class="number">0</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(a <span class="keyword">as</span> <span class="type">f64</span> / b <span class="keyword">as</span> <span class="type">f64</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="literal">None</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h1 id="Rust-中的错误分类："><a href="#Rust-中的错误分类：" class="headerlink" title="Rust 中的错误分类："></a>Rust 中的错误分类：</h1><ol>
<li>可恢复错误，通常用于从系统全局角度来看可以接受的错误，例如处理用户的访问、操作和错误，这些操作只会影响操作进程，而不会对系统的全局稳定性产生影响。<br> <code>Rsesult&lt;T, E&gt;</code> 用于可恢复错误。</li>
<li>不可恢复错误，通常是全局性或者系统性的错误，例如数组越界访问等等，对系统安全性有致命影响<br><code>panic!</code> 用于不可恢复错误。</li>
</ol>
<h2 id="Panic："><a href="#Panic：" class="headerlink" title="Panic："></a>Panic：</h2><h3 id="被动触发："><a href="#被动触发：" class="headerlink" title="被动触发："></a>被动触发：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">	v[<span class="number">99</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="主动触发："><a href="#主动触发：" class="headerlink" title="主动触发："></a>主动触发：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="built_in">panic!</span>(<span class="string">&quot;crash and burn&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Result"><a href="#Result" class="headerlink" title="Result:"></a>Result:</h2><p>很多错误没严重到程序要完全停止，例如：想要打开一个不存在的文件但是失败了，我们下一步可能是想创建文件，而不是直接停止程序。</p>
<p><code>Ok(T)</code>：表示操作成功，并包含一个成功值 T。<br><code>Err(E)</code>：表示操作失败，并包含一个错误值 E。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;T,E&gt; &#123;</span><br><span class="line">	<span class="title function_ invoke__">Ok</span>(T),</span><br><span class="line">	<span class="title function_ invoke__">Err</span>(E),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="返回result"><a href="#返回result" class="headerlink" title="返回result:"></a>返回result:</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">enum</span> <span class="title class_">MathError</span> &#123;</span><br><span class="line">    DivisionByZero,</span><br><span class="line">    NegativeSquareRoot,</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//返回Result&lt;成功数据类型，失败数据类型&gt;</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">div</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">f64</span>,MathError&gt; &#123;</span><br><span class="line">    <span class="comment">//分母不能为0</span></span><br><span class="line">    <span class="keyword">if</span> b != <span class="number">0</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(a <span class="keyword">as</span> <span class="type">f64</span> / b <span class="keyword">as</span> <span class="type">f64</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">	    <span class="comment">//把失败原因包装在Err里并返回</span></span><br><span class="line">        <span class="title function_ invoke__">Err</span>(MathError::DivisionByZero)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"> <span class="keyword">fn</span> <span class="title function_">sqrt</span>(a: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">f64</span>, MathError&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> a &lt; <span class="number">0.0</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(MathError::NegativeSquareRoot)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(a.<span class="title function_ invoke__">sqrt</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="处理result"><a href="#处理result" class="headerlink" title="处理result:"></a>处理result:</h3><p>打开hello.txt文件，如果文件不存在而失败，希望创建这文件。如果因为其他原因失败，一样panic。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">//处理Result</span></span><br><span class="line">    <span class="comment">//open() 函数打开文件，返回是个Result类型</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = <span class="keyword">match</span> f &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="comment">//kind() 会输出更详细的错误类型</span></span><br><span class="line">        <span class="title function_ invoke__">Err</span>(error) =&gt; <span class="keyword">match</span> error.<span class="title function_ invoke__">kind</span>()&#123;</span><br><span class="line">            ErrorKind::NotFound =&gt; <span class="keyword">match</span> File::<span class="title function_ invoke__">create</span>(<span class="string">&quot;hello.txt&quot;</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">Ok</span>(fc) =&gt; fc,</span><br><span class="line">                <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;creating file failed: &#123;&#125;&quot;</span>,e),      </span><br><span class="line">            &#125;,</span><br><span class="line">            other_error =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;opening file failed: &#123;&#125;&quot;</span>, other_error),</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="unwrap"><a href="#unwrap" class="headerlink" title="unwrap():"></a>unwrap():</h3><p>如果Result 是 Ok，那么unwrap会返回Ok中的值；如果是Err，则会调用panic!</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">//unwrap</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="expect"><a href="#expect" class="headerlink" title="expect():"></a>expect():</h3><p>expect跟unwrap差不多，就是错误输出可以自定义内容</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="comment">//expect 按自己期望修改打印出来的错误信息</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>).<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Failed to open hello.txt&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="map"><a href="#map" class="headerlink" title="map:"></a>map:</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//map</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">line</span> = <span class="string">&quot;1\n2\n3\n4\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//遍历每一行，line.lines()是迭代器，按行分割字符串</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">num</span> <span class="keyword">in</span> line.<span class="title function_ invoke__">lines</span>() &#123;</span><br><span class="line">        <span class="comment">// num.parse::&lt;i32&gt;() 将num转为i32类型，成功就ok,不成功Err</span></span><br><span class="line">        <span class="comment">// ok的话， map会将ok中的值*2</span></span><br><span class="line">        <span class="keyword">match</span> num.parse::&lt;<span class="type">i32</span>&gt;().<span class="title function_ invoke__">map</span>(|i| i * <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">Ok</span>(n) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;&#123;n&#125;&quot;</span>),</span><br><span class="line">            <span class="title function_ invoke__">Err</span>(..) =&gt; &#123;&#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="map-err"><a href="#map-err" class="headerlink" title="map_err:"></a>map_err:</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//map_err</span></span><br><span class="line"><span class="comment">//注意 Result&lt;(), String&gt;的String</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">x</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;(), <span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="comment">//map_err,如果文件打开失败，map_err 方法将 std::io::Error 转换为一个 String 类型的错误信息。</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>).<span class="title function_ invoke__">map_err</span>(|e: std::io::Error| <span class="built_in">format!</span>(<span class="string">&quot;&#123;e&#125;&quot;</span>));</span><br><span class="line">    <span class="keyword">match</span> f &#123;</span><br><span class="line">        <span class="comment">//：如果文件打开失败，返回 Err(e)，其中 e 是转换后的 String 错误信息。</span></span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(_) =&gt; <span class="title function_ invoke__">Ok</span>(()),</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="传播错误："><a href="#传播错误：" class="headerlink" title="传播错误："></a>传播错误：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">read_username_from_file</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, std::io::Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">f</span> = <span class="keyword">match</span> f &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(error) =&gt; <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(error),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> f.<span class="title function_ invoke__">read_to_string</span>(&amp;<span class="keyword">mut</span> s) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(_) =&gt; <span class="title function_ invoke__">Ok</span>(s),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(error) =&gt; <span class="title function_ invoke__">Err</span>(error),</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//上面这样写太长</span></span><br><span class="line"><span class="comment">//简略写法：</span></span><br><span class="line"><span class="comment">//对于Result，如果结果是Ok(T),则把T赋值给f</span></span><br><span class="line"><span class="comment">//如果结果是Err(E),则返回该错误</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_username_from_file</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, io::Error&gt; &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">f</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>)?;</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">	f.<span class="title function_ invoke__">read_to_string</span>(&amp;<span class="keyword">mut</span> s)?;</span><br><span class="line">	<span class="title function_ invoke__">Ok</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_username_from_file</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, std::io::Error&gt; &#123;</span><br><span class="line"><span class="comment">//还有更简单的，链式方法调用：</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//? 运算符用于在函数返回 Result 类型时，简化错误处理。如果某个操作返回 Err，? 运算符会立即将错误返回，否则继续执行后续代码。</span></span><br><span class="line">    <span class="comment">//如果 File::open(&quot;hello.txt&quot;) 返回 Err，则立即返回该错误；否则，继续执行 read_to_string 方法。</span></span><br><span class="line">    File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>)?.<span class="title function_ invoke__">read_to_string</span>(&amp;<span class="keyword">mut</span> s)?;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(s)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="Option和Result-互换："><a href="#Option和Result-互换：" class="headerlink" title="Option和Result 互换："></a>Option和Result 互换：</h2><h3 id="Option-转-Result，ok-or-："><a href="#Option-转-Result，ok-or-：" class="headerlink" title="Option 转 Result，ok_or()："></a>Option 转 Result，ok_or()：</h3><p><code>Some(v)</code> -&gt; <code>Ok(v)</code><br><code>None</code> -&gt; <code>Err(err)</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//Option 转 Result</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">op_to_re</span>(arr: &amp;[<span class="type">i32</span>]) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;&amp;<span class="type">i32</span>, <span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="comment">//ok_or(&quot;out of index&quot;.to_string())：将 Option&lt;&amp;i32&gt; 转换为 Result&lt;&amp;i32, String&gt;。</span></span><br><span class="line">    <span class="comment">//如果 arr.get(0) 返回 Some(&amp;i32)，则 ok_or 返回 Ok(&amp;i32)。</span></span><br><span class="line">    <span class="comment">//如果 arr.get(0) 返回 None，则 ok_or 返回 Err(&quot;out of index&quot;.to_string())。</span></span><br><span class="line">    arr.<span class="title function_ invoke__">get</span>(<span class="number">0</span>).<span class="title function_ invoke__">ok_or</span>(<span class="string">&quot;out of index&quot;</span>.<span class="title function_ invoke__">to_string</span>())</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="Result-转-Option-ok-："><a href="#Result-转-Option-ok-：" class="headerlink" title="Result 转 Option, ok()："></a>Result 转 Option, ok()：</h3><p><code>Ok(v)</code> -&gt; <code>None</code><br><code>Err(e)</code> -&gt; <code>Some(v)</code></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">res</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = <span class="title function_ invoke__">Ok</span>(<span class="number">24</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">option</span> = res.<span class="title function_ invoke__">ok</span>();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(opt,<span class="title function_ invoke__">Some</span>(<span class="number">42</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">res</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt;= <span class="title function_ invoke__">Err</span>(<span class="string">&quot;Nothing here&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">opt</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = res.<span class="title function_ invoke__">ok</span>();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(opt,<span class="literal">None</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/26/Rust-lesson-13/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/26/Rust-lesson-13/" itemprop="url">Rust lesson 13 - 常见集合</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-10-26T20:21:06+08:00">
                2024-10-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="向量-Vector"><a href="#向量-Vector" class="headerlink" title="向量 Vector"></a>向量 Vector</h1><p>是一个动态数组，可以根据需要动态增长和缩小，适用于需要按顺序存储数据的场景。</p>
<h2 id="基础用法："><a href="#基础用法：" class="headerlink" title="基础用法："></a>基础用法：</h2><h3 id="创建和初始化："><a href="#创建和初始化：" class="headerlink" title="创建和初始化："></a>创建和初始化：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">vec_study</span>() &#123;</span><br><span class="line"><span class="comment">//创建一个空的vec</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> : <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;v: &#123;:?&#125;&quot;</span>,v);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用宏来创建vec</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;v: &#123;:?&#125;&quot;</span>, v); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="添加元素："><a href="#添加元素：" class="headerlink" title="添加元素："></a>添加元素：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">vec_study</span>() &#123;</span><br><span class="line">	<span class="comment">//push 添加元素</span></span><br><span class="line">    <span class="comment">//Vec::new(); 必须显式写明类型 Vec&lt;i32&gt;</span></span><br><span class="line">    <span class="comment">//如果换成 vec![1,2,3,]; 编译器则会自动推断，不需要自己写类型</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span>: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    v.<span class="title function_ invoke__">push</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;v: &#123;:?&#125;&quot;</span>,v);</span><br><span class="line">    v.<span class="title function_ invoke__">push</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;v: &#123;:?&#125;&quot;</span>,v); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="访问元素："><a href="#访问元素：" class="headerlink" title="访问元素："></a>访问元素：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">vec_study</span>() &#123;</span><br><span class="line">     <span class="comment">//直接引用访问元素</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">second</span> : &amp;<span class="type">i32</span> = &amp;v[<span class="number">1</span>];</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The second number is  &#123;&#125;&quot;</span>,second);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用get 方法访问</span></span><br><span class="line">    <span class="comment">//get方法返回的是OPTION类型，要用match</span></span><br><span class="line">    <span class="comment">//好处：假如get 10，这种方法不会报错，使用直接引用会报错越界</span></span><br><span class="line">    <span class="keyword">match</span> v.<span class="title function_ invoke__">get</span>(<span class="number">3</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(third) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;The third number is &#123;&#125;&quot;</span>,third),</span><br><span class="line">        <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;There is no third&quot;</span>),</span><br><span class="line">    &#125; */&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改元素："><a href="#修改元素：" class="headerlink" title="修改元素："></a>修改元素：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">vec_study</span>() &#123;</span><br><span class="line">    <span class="comment">//修改元素</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line">    v[<span class="number">2</span>] = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;v: &#123;:?&#125;&quot;</span>,v); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="遍历元素："><a href="#遍历元素：" class="headerlink" title="遍历元素："></a>遍历元素：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">vec_study</span>() &#123;</span><br><span class="line"> <span class="comment">//遍历元素</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> &amp;v &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,i);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="进阶用法："><a href="#进阶用法：" class="headerlink" title="进阶用法："></a>进阶用法：</h2><h3 id="使用枚举存储多种类型："><a href="#使用枚举存储多种类型：" class="headerlink" title="使用枚举存储多种类型："></a>使用枚举存储多种类型：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">vec_study</span>() &#123;</span><br><span class="line">	<span class="keyword">enum</span> <span class="title class_">SpreadsheetCell</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Int</span>(<span class="type">i32</span>),</span><br><span class="line">        <span class="title function_ invoke__">Float</span>(<span class="type">f64</span>),</span><br><span class="line">        <span class="title function_ invoke__">String</span>(<span class="type">String</span>),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">row</span> = vect![</span><br><span class="line">        SpreadsheetCell::<span class="title function_ invoke__">Int</span>(<span class="number">2</span>),</span><br><span class="line">        SpreadsheetCell::<span class="title function_ invoke__">Float</span>(<span class="number">10</span>,<span class="number">12</span>),</span><br><span class="line">        SpreadsheetCell::<span class="title function_ invoke__">Test</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>))</span><br><span class="line">    ]; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="容量与重新分配："><a href="#容量与重新分配：" class="headerlink" title="容量与重新分配："></a>容量与重新分配：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">vec_study</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> : <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = <span class="type">Vec</span>::<span class="title function_ invoke__">with_capacity</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;capacity: &#123;&#125;&quot;</span>,v.<span class="title function_ invoke__">capacity</span>());</span><br><span class="line"></span><br><span class="line">    v.<span class="title function_ invoke__">push</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;capacity: &#123;&#125;&quot;</span>,v.<span class="title function_ invoke__">capacity</span>());</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;value: &#123;:?&#125;&quot;</span>,v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="Hashmap："><a href="#Hashmap：" class="headerlink" title="Hashmap："></a>Hashmap：</h1><p>一种键值对（Key-Value）的数据结构，用于需要快速查找数据的场景。</p>
<h2 id="基础使用："><a href="#基础使用：" class="headerlink" title="基础使用："></a>基础使用：</h2><h3 id="创建与初始化："><a href="#创建与初始化：" class="headerlink" title="创建与初始化："></a>创建与初始化：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">hashmap</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span>: HashMap&lt;_, _&gt; = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="number">10</span>);</span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Yellow&quot;</span>), <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,scores);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="访问："><a href="#访问：" class="headerlink" title="访问："></a>访问：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">hashmap</span>() &#123;</span><br><span class="line"> <span class="comment">//使用get 来访问</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">team_name</span> = <span class="type">String</span> :: <span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">score</span> = scores.<span class="title function_ invoke__">get</span>(&amp;team_name);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> score &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(s) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; score is &#123;&#125;&quot;</span>,team_name,s),</span><br><span class="line">        <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;NO SCORE&quot;</span>),</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="遍历："><a href="#遍历：" class="headerlink" title="遍历："></a>遍历：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (team,score) <span class="keyword">in</span> &amp;scores &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;,&#123;&#125;&quot;</span>,team,score);</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure>

<h2 id="进阶用法：-1"><a href="#进阶用法：-1" class="headerlink" title="进阶用法："></a>进阶用法：</h2><h3 id="更新哈希表："><a href="#更新哈希表：" class="headerlink" title="更新哈希表："></a>更新哈希表：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">hashmap</span>() &#123;</span><br><span class="line">	<span class="comment">//更新哈希表</span></span><br><span class="line">    <span class="comment">//insert直接插入</span></span><br><span class="line">    scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;red&quot;</span>), <span class="number">25</span>);</span><br><span class="line">    <span class="comment">//entry().or_insert(),检查是否已经存在key,不存在插入，存在不操作</span></span><br><span class="line">    scores.<span class="title function_ invoke__">entry</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>)).<span class="title function_ invoke__">or_insert</span>(<span class="number">50</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="合并哈希表："><a href="#合并哈希表：" class="headerlink" title="合并哈希表："></a>合并哈希表：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">hashmap</span>() &#123;</span><br><span class="line">	<span class="comment">//合并哈希表</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">map1</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    map1.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;a&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    map1.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;b&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">map2</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    map2.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;b&quot;</span>, <span class="number">3</span>);</span><br><span class="line">    map2.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;c&quot;</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (k , v) <span class="keyword">in</span> map2 &#123;</span><br><span class="line">        </span><br><span class="line">        map1.<span class="title function_ invoke__">entry</span>(k).<span class="title function_ invoke__">or_insert</span>(v);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>,map1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/25/Rust-lesson-12/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/25/Rust-lesson-12/" itemprop="url">Rust lesson 12 - 模式匹配</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-10-25T17:41:08+08:00">
                2024-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>模式匹配，可以让代码轻松地从数据结构中提取值，并根据不同的模式执行不同的操作。</p>
<h1 id="基础模式匹配："><a href="#基础模式匹配：" class="headerlink" title="基础模式匹配："></a>基础模式匹配：</h1><p>通过match 后面的值，匹配下面某个选项，代码示例：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">match_1</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">number</span> = <span class="number">13</span>;</span><br><span class="line">    <span class="keyword">match</span> number &#123;</span><br><span class="line">        <span class="number">1</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;1&quot;</span>),</span><br><span class="line">        <span class="number">2</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;2&quot;</span>),</span><br><span class="line">        <span class="number">3</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;3&quot;</span>),</span><br><span class="line">        <span class="comment">//下划线的意思是通配符，不写会报错</span></span><br><span class="line">        _ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;other&quot;</span>),</span><br><span class="line">    &#125; </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>


<h1 id="各种匹配模式："><a href="#各种匹配模式：" class="headerlink" title="各种匹配模式："></a>各种匹配模式：</h1><h2 id="字面值模式，代码示例："><a href="#字面值模式，代码示例：" class="headerlink" title="字面值模式，代码示例："></a>字面值模式，代码示例：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">match_1</span>() &#123;</span><br><span class="line">	<span class="comment">// 字面值模式</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">    <span class="keyword">match</span> y &#123;</span><br><span class="line">        <span class="string">&quot;Hello&quot;</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Hello&quot;</span>),</span><br><span class="line">        _ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Other&quot;</span>),</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="变量模式，代码示例："><a href="#变量模式，代码示例：" class="headerlink" title="变量模式，代码示例："></a>变量模式，代码示例：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">match_1</span>() &#123;</span><br><span class="line">	 <span class="comment">// 变量模式</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">42</span>;  <span class="comment">//如果换成 let x = String::from(&quot;Hello&quot;)</span></span><br><span class="line">    <span class="keyword">match</span> x &#123;</span><br><span class="line">        <span class="comment">// x会赋值给var</span></span><br><span class="line">        var =&gt; <span class="built_in">println!</span>(<span class="string">&quot;The value of var is &#123;&#125;&quot;</span>,var),</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">//x=42时不会报错，换成String会报错，因为在上面所有权转移到var上,可去查查什么数据类型转移不转移</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,x)  </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="结构模式，代码示例："><a href="#结构模式，代码示例：" class="headerlink" title="结构模式，代码示例："></a>结构模式，代码示例：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">match_1</span>() &#123;</span><br><span class="line">	<span class="comment">//结构模式</span></span><br><span class="line">    <span class="keyword">struct</span>  <span class="title class_">Point</span>&#123;x:<span class="type">i32</span> , y:<span class="type">i32</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> = Point&#123;x:<span class="number">0</span>,y:<span class="number">7</span>&#125;;</span><br><span class="line">    <span class="keyword">match</span> p &#123;</span><br><span class="line">        Point &#123;x,y: <span class="number">0</span> &#125; =&gt; <span class="built_in">println!</span>(<span class="string">&quot;x is &#123;&#125;&quot;</span>,x),</span><br><span class="line">        <span class="comment">//会匹配到第二条</span></span><br><span class="line">        Point &#123;x: <span class="number">0</span> , y&#125; =&gt;<span class="built_in">println!</span>(<span class="string">&quot;y is &#123;&#125;&quot;</span>,y),</span><br><span class="line">        Point &#123;x, y &#125; =&gt;<span class="built_in">println!</span>(<span class="string">&quot;x is &#123;&#125;,y is &#123;&#125;&quot;</span>,x,y),</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="守卫模式，代码示例："><a href="#守卫模式，代码示例：" class="headerlink" title="守卫模式，代码示例："></a>守卫模式，代码示例：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">match_1</span>() &#123;</span><br><span class="line">	<span class="comment">//守卫模式，其实就是里面添加条件判断</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span>=<span class="number">5</span>;</span><br><span class="line">    <span class="keyword">match</span> x &#123;</span><br><span class="line">        <span class="comment">// x 会赋值给 n</span></span><br><span class="line">        n <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Even&quot;</span>),</span><br><span class="line">        n =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Odd&quot;</span>),</span><br><span class="line"></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="绑定模式，代码示例："><a href="#绑定模式，代码示例：" class="headerlink" title="绑定模式，代码示例："></a>绑定模式，代码示例：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">match_1</span>() &#123;</span><br><span class="line">	<span class="comment">//绑定模式</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">match</span> x &#123;</span><br><span class="line">        var @ <span class="number">1</span>..=<span class="number">5</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;var is &#123;&#125;&quot;</span>,var),</span><br><span class="line">        _ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Default&quot;</span>),</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="高级匹配模式："><a href="#高级匹配模式：" class="headerlink" title="高级匹配模式："></a>高级匹配模式：</h1><h2 id="嵌套匹配，代码示例："><a href="#嵌套匹配，代码示例：" class="headerlink" title="嵌套匹配，代码示例："></a>嵌套匹配，代码示例：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">match_2</span>() &#123;</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">        Quit,</span><br><span class="line">        Move&#123;x: <span class="type">i32</span>, y: <span class="type">i32</span>&#125;,</span><br><span class="line">        <span class="title function_ invoke__">Write</span>(<span class="type">String</span>),</span><br><span class="line">        <span class="title function_ invoke__">ChangeColor</span>(<span class="type">i32</span>,<span class="type">i32</span>,<span class="type">i32</span>),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">msg</span> = Message::<span class="title function_ invoke__">ChangeColor</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> msg &#123;</span><br><span class="line">        <span class="comment">//就是多了个大括号里面可以写多行</span></span><br><span class="line">        Message::<span class="title function_ invoke__">ChangeColor</span>(r,g ,b ) =&gt; &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;red &#123;&#125;,green &#123;&#125;,blue &#123;&#125;&quot;</span>,r,g,b);</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;hahahahaha&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        _ =&gt; (),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="匹配模式和迭代器使用"><a href="#匹配模式和迭代器使用" class="headerlink" title="匹配模式和迭代器使用:"></a>匹配模式和迭代器使用:</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">match_3</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">vec1</span> = <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">vec2</span> = <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//iter().zip 用于将两个迭代器合并成一个迭代器，每次迭代时返回一个包含两个元素的元组</span></span><br><span class="line">    <span class="comment">//vec1.iter() 返回一个迭代器，该迭代器产生 vec1 中每个元素的引用（&amp;i32）。</span></span><br><span class="line">    <span class="comment">//zip 方法接受另一个迭代器，并将两个迭代器合并成一个迭代器。</span></span><br><span class="line">    <span class="keyword">for</span> (a , b) <span class="keyword">in</span> vec1.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">zip</span>(vec2) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125; + &#123;&#125; = &#123;&#125;&quot;</span>,a,b,a+b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="if-let-和-while-let简化单个模式匹配"><a href="#if-let-和-while-let简化单个模式匹配" class="headerlink" title="if let 和 while let简化单个模式匹配:"></a><code>if let</code> 和 <code>while let</code>简化单个模式匹配:</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">match_4</span>() &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">opt</span> = <span class="title function_ invoke__">Some</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(x) = opt &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;The value of x is &#123;&#125;&quot;</span> ,x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 对比 match 语句:</span></span><br><span class="line"><span class="comment">    let opt = Some(5);</span></span><br><span class="line"><span class="comment">    match opt &#123;</span></span><br><span class="line"><span class="comment">        Some(x) =&gt; println!(&quot;The value of x is &#123;&#125;&quot;, x),</span></span><br><span class="line"><span class="comment">        None =&gt; (),</span></span><br><span class="line"><span class="comment">    &#125; */</span></span><br><span class="line">    <span class="comment">//match 语句：需要显式地处理所有可能的分支，即使只有一个分支是有意义的。在这种情况下，None 分支只是简单地什么也不做。</span></span><br><span class="line">    <span class="comment">//if let 语句：只需关注感兴趣的模式（Some(x)），并且代码更简洁。if let 语法省去了不必要的 None 分支，使代码更加聚焦于关键逻辑。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">iter</span> = <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>].<span class="title function_ invoke__">into_iter</span>();</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(x) = iter.<span class="title function_ invoke__">next</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;The value is: &#123;:?&#125;&quot;</span>, x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 对比 loop 和 match语句</span></span><br><span class="line"><span class="comment">    let mut iter = vec![1, 2, 3, 4].into_iter();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    loop &#123;</span></span><br><span class="line"><span class="comment">        match iter.next() &#123;</span></span><br><span class="line"><span class="comment">            Some(x) =&gt; println!(&quot;The value is: &#123;:?&#125;&quot;, x),</span></span><br><span class="line"><span class="comment">            None =&gt; break,</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125; */</span></span><br><span class="line">    <span class="comment">//loop 和 match 语句：需要显式地使用 loop 循环，并在每次迭代时使用 match 语句来检查 iter.next() 的返回值。如果返回 Some(x)，则处理 x；如果返回 None，则退出循环。</span></span><br><span class="line">    <span class="comment">//while let 语句：只需一行代码即可实现相同的功能。while let 语法自动处理了 None 情况下的退出逻辑，使代码更加简洁和易读。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ref-ref-mut"><a href="#ref-ref-mut" class="headerlink" title="ref &amp; ref mut:"></a>ref &amp; ref mut:</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ref 关键字：在模式匹配中创建一个不可变引用，不会移动或改变原始变量的所有权。</span></span><br><span class="line"><span class="comment">//ref mut 关键字：在模式匹配中创建一个可变引用，不会移动或改变原始变量的所有权，但允许修改引用所指向的值。</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">match_5</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span>  x &#123;</span><br><span class="line">        <span class="comment">//ref r：在模式匹配中，ref 关键字用于创建一个新的引用 r，而不是移动或复制 x的值。</span></span><br><span class="line">        <span class="keyword">ref</span> r =&gt; <span class="built_in">println!</span>(<span class="string">&quot;value is &#123;&#125;&quot;</span>,r),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在函数或块的其他地方仍可以使用x</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;x still can be used in other place :&#123;&#125;&quot;</span>,x);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="模式匹配的应用场景"><a href="#模式匹配的应用场景" class="headerlink" title="模式匹配的应用场景"></a>模式匹配的应用场景</h1><ol>
<li>处理错误</li>
<li>解析命令行参数</li>
<li>解析配置文件</li>
<li>解析数据包</li>
<li>解析XML或JSON等数据格式</li>
</ol>
<h2 id="处理错误代码示例："><a href="#处理错误代码示例：" class="headerlink" title="处理错误代码示例："></a>处理错误代码示例：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用场景一：错误处理</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">divide</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">i32</span>,<span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> b==<span class="number">0</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Can not divide by zero&quot;</span>))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(a/b)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="comment">//错误处理</span></span><br><span class="line">    <span class="keyword">match</span> <span class="title function_ invoke__">divide</span>(<span class="number">4</span>,<span class="number">2</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(n) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;The result is &#123;&#125;&quot;</span>, n),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;The error is &#123;&#125;&quot;</span>,e),</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/24/Rust-lesson-11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/24/Rust-lesson-11/" itemprop="url">Rust lesson 11- 结构体</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-10-24T18:04:12+08:00">
                2024-10-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="结构体基础"><a href="#结构体基础" class="headerlink" title="结构体基础:"></a>结构体基础:</h1><p>直接通过代码来学习吧：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//知识点一：基础实例化</span></span><br><span class="line">	<span class="comment">//创建User结构体对应的实例,注意：</span></span><br><span class="line">    <span class="comment">//每个字段都必须初始化</span></span><br><span class="line">    <span class="comment">//赋值顺序和定义顺序不需要一致</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">user1</span> = User &#123;</span><br><span class="line">        email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;aaa@gmail.com&quot;</span>),</span><br><span class="line">        username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;root&quot;</span>),</span><br><span class="line">        active: <span class="literal">true</span>,</span><br><span class="line">        sign_in_count: <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//知识点二： 初始化简写语法</span></span><br><span class="line">	<span class="comment">/* //实例user2 里面直接写email，就会匹配到外部变量email</span></span><br><span class="line"><span class="comment">    let email = String::from(&quot;aaa@gmail.com&quot;);</span></span><br><span class="line"><span class="comment">    let username = String::from(&quot;root&quot;);</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    let user2 = User &#123;</span></span><br><span class="line"><span class="comment">        email,</span></span><br><span class="line"><span class="comment">        username,</span></span><br><span class="line"><span class="comment">        active: true,</span></span><br><span class="line"><span class="comment">        sign_in_count: 1,</span></span><br><span class="line"><span class="comment">    &#125; */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//知识点三： 结构体更新语法</span></span><br><span class="line">	<span class="comment">/* </span></span><br><span class="line"><span class="comment">    let user3 = User &#123;</span></span><br><span class="line"><span class="comment">        email: String::from(&quot;bbb@gmail.com&quot;),</span></span><br><span class="line"><span class="comment">        //user3除了email不一样，其余都跟user1一样,&quot;..&quot;就是所有</span></span><br><span class="line"><span class="comment">        ..user1</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">    println!(&quot;&#123;&#125;&quot;,user3.email); */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 知识点四：实例有mut以后，就可以改里面的值</span></span><br><span class="line"><span class="comment">    let mut user4 = User &#123;</span></span><br><span class="line"><span class="comment">        email: String::from(&quot;aaa@gmail.com&quot;),</span></span><br><span class="line"><span class="comment">        username: String::from(&quot;root&quot;),</span></span><br><span class="line"><span class="comment">        active: true,</span></span><br><span class="line"><span class="comment">        sign_in_count: 1,</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    user4.email = String::from(&quot;cccc@example.com&quot;);</span></span><br><span class="line"><span class="comment">    println!(&quot;&#123;&#125;&quot;,user4.email); */</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建结构体</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">// 字段 : 类型,</span></span><br><span class="line">    active: <span class="type">bool</span>,</span><br><span class="line">    username: <span class="type">String</span>,</span><br><span class="line">    email: <span class="type">String</span>,</span><br><span class="line">    sign_in_count: <span class="type">u64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="元祖结构体-Tuple-Struct-："><a href="#元祖结构体-Tuple-Struct-：" class="headerlink" title="元祖结构体(Tuple Struct)："></a>元祖结构体(Tuple Struct)：</h1><p>结构体必须有名称，但结构体的字段可以没有，这种结构因为长得像结构体，所以叫元祖结构体。<br>元祖结构体在你希望有个一个整体名称，但又不关心里面字段的名称时很有用。<br>例如<code>Point</code>元祖结构体，3D图形是以（x,y,z)作为坐标点，所以没必要为字段命名</p>
<p>代码示例：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="comment">//元祖结构体实例化</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">point</span> = <span class="title function_ invoke__">Point</span>(<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,point.<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//元祖结构体</span></span><br><span class="line"><span class="keyword">struct</span>  <span class="title class_">Point</span>( <span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="单元结构体（Unit-like-Struct）："><a href="#单元结构体（Unit-like-Struct）：" class="headerlink" title="单元结构体（Unit-like Struct）："></a>单元结构体（Unit-like Struct）：</h1><p>如果你定义一个结构体，但是我不关心它的字段数据，只关心它的行为（方法），就可以使用单元结构体</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="comment">//单元结构体实例化</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">subject</span> = AlwaysEqual;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//不关心AlwaysEqual的字段数据，只关心它的行为，通过impl为它设定行为</span></span><br><span class="line">    <span class="keyword">impl</span> <span class="title class_">SomeTrait</span> <span class="keyword">for</span> <span class="title class_">AlwaysEqual</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//单元结构体</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AlwaysEqual</span>;</span><br></pre></td></tr></table></figure>


<h1 id="结构体中的所有权："><a href="#结构体中的所有权：" class="headerlink" title="结构体中的所有权："></a>结构体中的所有权：</h1><h3 id="会发生所有权移动的数据类型"><a href="#会发生所有权移动的数据类型" class="headerlink" title="会发生所有权移动的数据类型"></a>会发生所有权移动的数据类型</h3><ol>
<li><strong>拥有资源的数据类型</strong>：<ul>
<li>**<code>String</code>**：<code>String</code> 类型拥有其数据的所有权，因此在赋值或传递给函数时会发生所有权移动。</li>
<li>**<code>Vec&lt;T&gt;</code>**：动态数组，拥有其元素的所有权，同样会在赋值或传递时移动所有权。</li>
<li><strong>自定义结构体</strong>：如果结构体包含拥有资源的字段（如 <code>String</code> 或 <code>Vec&lt;T&gt;</code>），那么该结构体也会在赋值或传递时移动所有权。</li>
<li><strong>智能指针</strong>：如 <code>Box&lt;T&gt;</code>、<code>Rc&lt;T&gt;</code> 和 <code>Arc&lt;T&gt;</code> 等，这些类型都拥有其指向的数据的所有权。</li>
</ul>
</li>
</ol>
<h3 id="不会发生所有权移动的数据类型"><a href="#不会发生所有权移动的数据类型" class="headerlink" title="不会发生所有权移动的数据类型"></a>不会发生所有权移动的数据类型</h3><ol>
<li><p><strong>标量类型</strong>：</p>
<ul>
<li><strong>整数</strong>：如 <code>i32</code>、<code>u32</code> 等。</li>
<li><strong>浮点数</strong>：如 <code>f32</code>、<code>f64</code> 等。</li>
<li><strong>布尔值</strong>：<code>bool</code>。</li>
<li><strong>字符</strong>：<code>char</code>。</li>
</ul>
</li>
<li><p><strong>元组</strong>：如果元组中的所有元素都是不会发生所有权移动的类型，那么整个元组也不会发生所有权移动。</p>
</li>
<li><p><strong>引用</strong>：如 <code>&amp;T</code> 和 <code>&amp;mut T</code>，引用本身不拥有数据的所有权，因此在赋值或传递时不会移动所有权。</p>
</li>
<li><p><strong>切片</strong>：如 <code>&amp;[T]</code> 和 <code>&amp;str</code>，切片也不拥有数据的所有权，因此不会发生所有权移动。</p>
</li>
</ol>
<p>代码示例：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="comment">//所有权</span></span><br><span class="line">    <span class="comment">//1.所有权的范围细粒度是字段，也就是email、username这些</span></span><br><span class="line">    <span class="comment">//2.Copy 特征的类型，会发生复制不会发生所有权移动，例如active</span></span><br><span class="line">    <span class="comment">//3.没有实现Copy特征，会发生所有权的转移,例如email字段</span></span><br><span class="line">    <span class="comment">//4.一旦字结构体中一个字段发生了所有权移动，那么整个结构体就不能再被传递和赋值，但可直接打印</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">user5</span> = User &#123;</span><br><span class="line">        email: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;aaa@gmail.com&quot;</span>),</span><br><span class="line">        username: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;root&quot;</span>),</span><br><span class="line">        active: <span class="literal">true</span>,</span><br><span class="line">        sign_in_count: <span class="number">1</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//user5.email发生所有权移动给email</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">email</span> = user5.email;</span><br><span class="line">    <span class="comment">//打印因为所有权移动会报错</span></span><br><span class="line">    <span class="comment">//println!(&quot;&#123;&#125;&quot;,user5.email);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">// 字段 : 类型,</span></span><br><span class="line">    active: <span class="type">bool</span>,</span><br><span class="line">    username: <span class="type">String</span>,</span><br><span class="line">    email: <span class="type">String</span>,</span><br><span class="line">    sign_in_count: <span class="type">u64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="方法："><a href="#方法：" class="headerlink" title="方法："></a>方法：</h1><p>使用<code>fn</code>关键字和名称声明，可以拥有参数和返回值，同时包含在某处调用该方法时会执行代码。<br>方法与函数不同，方法在结构体的上下文中被定义，并且它的第一个参数总是<code>self</code>,它代表调用该方法的结构体实例</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span>  <span class="comment">//加上这个，println的时候才能用debugstruct </span></span><br><span class="line">Rectangle &#123;</span><br><span class="line">    width: <span class="type">u32</span>,</span><br><span class="line">    height: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="comment">//以下3种fn写法效果一样</span></span><br><span class="line">    <span class="comment">// fn area(self: &amp;Self)</span></span><br><span class="line">    <span class="comment">// fn area(self: &amp;Rectangle)</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">area</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.width * <span class="keyword">self</span>.height;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//修改width,注意 &amp;mut</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_width</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, new_width: <span class="type">u32</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.width = new_width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这种没self的方法外部是不能 xxx.new()这样直接调用,但可以用rect3那种方式</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(width: <span class="type">u32</span>, height: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> Rectangle &#123;</span><br><span class="line">        Rectangle &#123; width, height&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Display</span> <span class="keyword">for</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> std::fmt::Formatter&lt;<span class="symbol">&#x27;_</span>&gt;) <span class="punctuation">-&gt;</span> std::fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">_</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="keyword">self</span>.height &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">            <span class="keyword">for</span> <span class="variable">_</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="keyword">self</span>.width &#123;</span><br><span class="line">                s.<span class="title function_ invoke__">push</span>(<span class="string">&#x27;#&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">write!</span>(f, <span class="string">&quot;&#123;&#125;\n&quot;</span>, s);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">Ok</span>(());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">print_area</span>(rectangle: &amp;Rectangle ) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, rectangle.<span class="title function_ invoke__">area</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="comment">//rect1.area()直接调用area方法</span></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">rect1</span> = Rectangle &#123; width: <span class="number">30</span> , height: <span class="number">50</span> &#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,rect1.<span class="title function_ invoke__">area</span>());</span><br><span class="line"></span><br><span class="line">	<span class="comment">//直接调用set_width方法</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">rect2</span> = Rectangle&#123;width:<span class="number">10</span>, height: <span class="number">40</span>&#125;;</span><br><span class="line">    rect2.<span class="title function_ invoke__">set_width</span>(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rect3</span> = Rectangle::<span class="title function_ invoke__">new</span>(<span class="number">10</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">rect4</span> = Rectangle::<span class="title function_ invoke__">new</span>(<span class="number">10</span>, <span class="number">30</span>);</span><br><span class="line">    <span class="title function_ invoke__">print_area</span>(&amp;rect4);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">rect5</span> = Rectangle::<span class="title function_ invoke__">new</span>(<span class="number">10</span>, <span class="number">30</span>);</span><br><span class="line">    <span class="comment">//注意，结构体上面必须要有#[derive(Debug)] 才能使用&#123;:?&#125; 来debug输出</span></span><br><span class="line">    <span class="comment">//&#123;:? &#125; 换成 &#123;:#?&#125; 能输出更多结构体信息</span></span><br><span class="line">    <span class="comment">//使用dbg!(rect5) 也能输出</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;rect5 is &#123;:?&#125;&quot;</span>,rect5);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果&#123;:?&#125; 和 dbg的输出格式你都不满意，还能自己impl Display方法去实现</span></span><br><span class="line">    <span class="comment">//然后就可以直接打印了</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,rect5);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="trait："><a href="#trait：" class="headerlink" title="trait："></a>trait：</h1><p>Rust中没有借口，但<code>trait</code>类似于其他语言的接口<br>如果不同的类型具有相同的行为(共享行为），那么我们就可以定义一个特征，然后为这些类型实现该特征。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Rectangle和HaHaHa都具有相同的行为Shape</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HaHaHa</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">area</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Shape</span> <span class="keyword">for</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">area</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">return</span> (<span class="keyword">self</span>.width * <span class="keyword">self</span>.height) <span class="keyword">as</span> <span class="type">f64</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Shape</span> <span class="keyword">for</span> <span class="title class_">HaHaHa</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">area</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">return</span> (<span class="keyword">self</span>.width * <span class="keyword">self</span>.height) <span class="keyword">as</span> <span class="type">f64</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/24/Rust-lesson-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/24/Rust-lesson-10/" itemprop="url">Rust lesson 10- 枚举（Enum）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-10-24T17:07:44+08:00">
                2024-10-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>枚举（Enumeration）是编程中的一种数据类型，用于定义一组命名的常量。在 Rust 中，枚举是一种强大的工具，用于表示具有多个可能值的数据类型。每个可能的值称为一个变体（variant）。枚举可以包含不同类型的变体，每个变体可以有自己的数据结构。</p>
<h1 id="创建和初始化："><a href="#创建和初始化：" class="headerlink" title="创建和初始化："></a>创建和初始化：</h1><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line"> <span class="meta">#[derive(Debug)]</span></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Pets</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Cat</span>(<span class="type">String</span>),</span><br><span class="line">        Dog&#123; name: <span class="type">String</span>, age: <span class="type">usize</span> &#125;,</span><br><span class="line">        Brid, <span class="comment">//Bird 是一个没有附加数据的单元变体（unit variant），类似于单元类型 (),可以作为枚举的默认值或初始状态。</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">cat</span> = Pets::Cat;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">dog</span> = Pets::Dog &#123; </span><br><span class="line">        name: <span class="string">&quot;Alen&quot;</span>.<span class="title function_ invoke__">to_string</span>(), </span><br><span class="line">        age: <span class="number">18</span>, </span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;dog is &#123;:?&#125;&quot;</span>,dog);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//为枚举创建方法</span></span><br><span class="line">    <span class="keyword">impl</span> <span class="title class_">Pets</span> &#123;</span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">speak</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;hallo&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//使用方法</span></span><br><span class="line">    dog.<span class="title function_ invoke__">speak</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//关联函数</span></span><br><span class="line">    <span class="keyword">impl</span> <span class="title class_">Pets</span> &#123;</span><br><span class="line">        <span class="comment">//输入没 &amp;self,所以是关联函数</span></span><br><span class="line">        <span class="keyword">fn</span> <span class="title function_">log</span>(name: <span class="type">String</span>) &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;name is &#123;name&#125;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// dog.log不行的啦,log是关联函数，是impl中的静态方法，不属于任何具体实例</span></span><br><span class="line">    Pets::<span class="title function_ invoke__">log</span>(<span class="string">&quot;alen&quot;</span>.<span class="title function_ invoke__">to_string</span>());</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="判别式："><a href="#判别式：" class="headerlink" title="判别式："></a>判别式：</h1><p>枚举的判别式（discriminant）是指每个枚举变体的内部标识符，通常是一个整数值。Rust 会自动为每个枚举变体分配一个唯一的整数值作为判别式，但你也可以自定义这些值。</p>
<h2 id="默认判别式："><a href="#默认判别式：" class="headerlink" title="默认判别式："></a>默认判别式：</h2><p>代码示例：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">    Red,</span><br><span class="line">    Green,</span><br><span class="line">    Blue,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Red: &#123;:?&#125;&quot;</span>, Color::Red <span class="keyword">as</span> <span class="type">isize</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Green: &#123;:?&#125;&quot;</span>, Color::Green <span class="keyword">as</span> <span class="type">isize</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Blue: &#123;:?&#125;&quot;</span>, Color::Blue <span class="keyword">as</span> <span class="type">isize</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出</span></span><br><span class="line">Red: <span class="number">0</span></span><br><span class="line">Green: <span class="number">1</span></span><br><span class="line">Blue: <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定义判别式："><a href="#自定义判别式：" class="headerlink" title="自定义判别式："></a>自定义判别式：</h2><p>代码示例：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Number</span> &#123;</span><br><span class="line">    One = <span class="number">1</span>,</span><br><span class="line">    Two = <span class="number">2</span>,</span><br><span class="line">    Three = <span class="number">3</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;One: &#123;:?&#125;&quot;</span>, Number::One <span class="keyword">as</span> <span class="type">isize</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Two: &#123;:?&#125;&quot;</span>, Number::Two <span class="keyword">as</span> <span class="type">isize</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Three: &#123;:?&#125;&quot;</span>, Number::Three <span class="keyword">as</span> <span class="type">isize</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="非连续判别式"><a href="#非连续判别式" class="headerlink" title="非连续判别式"></a>非连续判别式</h2><p>代码示例：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Status</span> &#123;</span><br><span class="line">    Success = <span class="number">0</span>,</span><br><span class="line">    Failure = <span class="number">100</span>,</span><br><span class="line">    Pending = <span class="number">200</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Success: &#123;:?&#125;&quot;</span>, Status::Success <span class="keyword">as</span> <span class="type">isize</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Failure: &#123;:?&#125;&quot;</span>, Status::Failure <span class="keyword">as</span> <span class="type">isize</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Pending: &#123;:?&#125;&quot;</span>, Status::Pending <span class="keyword">as</span> <span class="type">isize</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="判别式的自动递增"><a href="#判别式的自动递增" class="headerlink" title="判别式的自动递增"></a>判别式的自动递增</h2><p>如果你指定了某些变体的判别式值，Rust 会自动为后续的变体分配递增的值。</p>
<p>例如：代码示例：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    Info = <span class="number">10</span>,</span><br><span class="line">    Warning,</span><br><span class="line">    Error,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Info: &#123;:?&#125;&quot;</span>, Message::Info <span class="keyword">as</span> <span class="type">isize</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Warning: &#123;:?&#125;&quot;</span>, Message::Warning <span class="keyword">as</span> <span class="type">isize</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Error: &#123;:?&#125;&quot;</span>, Message::Error <span class="keyword">as</span> <span class="type">isize</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="unit-only-enum-field-less-enum"><a href="#unit-only-enum-field-less-enum" class="headerlink" title="unit-only enum(field-less enum)"></a>unit-only enum(field-less enum)</h1><p>就是这种全是单元变体的</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">AA</span> &#123;</span><br><span class="line">       A,</span><br><span class="line">       B,</span><br><span class="line">       C,</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>


<h1 id="Enum-常见用法："><a href="#Enum-常见用法：" class="headerlink" title="Enum 常见用法："></a>Enum 常见用法：</h1><h2 id="比较："><a href="#比较：" class="headerlink" title="比较："></a>比较：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//方法一：要加#[derive(PartialEq)]</span></span><br><span class="line"> <span class="meta">#[derive(PartialEq)]</span></span><br><span class="line"> <span class="keyword">enum</span> <span class="title class_">Pets</span> &#123;</span><br><span class="line">     Cat,</span><br><span class="line">     Dog,</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">let</span> <span class="variable">cat</span> = Pets::Cat;</span><br><span class="line"> <span class="keyword">let</span> <span class="variable">dog</span> = Pets::Dog;</span><br><span class="line"> <span class="keyword">if</span> cat == dog &#123;</span><br><span class="line">     <span class="comment">//</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//方法二：直接使用match</span></span><br><span class="line"> <span class="keyword">match</span> cat &#123;</span><br><span class="line">     Pets::Cat =&gt; &#123;</span><br><span class="line">         <span class="built_in">println!</span>(<span class="string">&quot;is cat &quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     Pets::Dog =&gt; &#123;</span><br><span class="line">         <span class="built_in">println!</span>(<span class="string">&quot;is dog &quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//方法三：if let，这样不需要使用完整的 match 表达式（以后会说match)</span></span><br><span class="line"> <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Pets</span>::<span class="title function_ invoke__">Cat</span>(name) = pet &#123;</span><br><span class="line">     <span class="built_in">println!</span>(<span class="string">&quot;It&#x27;s a cat named &#123;&#125;&quot;</span>, name);</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="built_in">println!</span>(<span class="string">&quot;Not a cat&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Option-和-Result"><a href="#Option-和-Result" class="headerlink" title="Option 和 Result"></a>Option 和 Result</h1><p><code>Option</code> 和 <code>Result</code> 是两个非常重要的枚举类型，用于处理可能不存在的值和可能出错的操作。</p>
<h2 id="Option"><a href="#Option" class="headerlink" title="Option:"></a>Option:</h2><p><code>Option</code> 枚举用于表示可能存在或不存在的值。它有两个变体：</p>
<ol>
<li>**<code>Some(T)</code>**：表示存在一个值，类型为 <code>T</code>。</li>
<li>**<code>None</code>**：表示不存在值。</li>
</ol>
<h3 id="创建和初始化：-1"><a href="#创建和初始化：-1" class="headerlink" title="创建和初始化："></a>创建和初始化：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">num</span> = <span class="title function_ invoke__">Some</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">none</span>:<span class="type">Option</span>&lt;<span class="type">usize</span>&gt; = <span class="literal">None</span>;</span><br><span class="line">    <span class="keyword">match</span> num &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(val) =&gt; &#123;&#125;</span><br><span class="line">        <span class="literal">None</span> =&gt; &#123;&#125;</span><br><span class="line">    &#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="使用示例一：哈希表，后面文章还会再讲"><a href="#使用示例一：哈希表，后面文章还会再讲" class="headerlink" title="使用示例一：哈希表，后面文章还会再讲"></a>使用示例一：哈希表，后面文章还会再讲</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">map</span>: HashMap&lt;&amp;<span class="type">str</span>, <span class="type">usize</span>&gt; = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = map.<span class="title function_ invoke__">get</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    <span class="keyword">match</span> a &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(val) =&gt; &#123;&#125;</span><br><span class="line">        <span class="literal">None</span> =&gt; &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用示例二：向量"><a href="#使用示例二：向量" class="headerlink" title="使用示例二：向量"></a>使用示例二：向量</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">vec</span> = <span class="built_in">vec!</span>[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">last_one</span> = vec.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">last</span>();</span><br><span class="line">    <span class="keyword">match</span> last_one &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(val) =&gt; &#123;&#125;</span><br><span class="line">        <span class="literal">None</span> =&gt; &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="常用操作："><a href="#常用操作：" class="headerlink" title="常用操作："></a>常用操作：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//option</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">option</span> = <span class="title function_ invoke__">Some</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = option.<span class="title function_ invoke__">map</span>(|num| num + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">c</span> = option.<span class="title function_ invoke__">and_then</span>(|val| <span class="title function_ invoke__">Some</span>((val +<span class="number">1</span> )));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">d</span> = option.<span class="title function_ invoke__">or_else</span>(|| <span class="title function_ invoke__">Some</span>(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = option.<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">a</span> = option.<span class="title function_ invoke__">expect</span>(<span class="string">&quot;msg&quot;</span>);</span><br><span class="line">    dbg!(a);</span><br></pre></td></tr></table></figure>

<h2 id="Result"><a href="#Result" class="headerlink" title="Result:"></a>Result:</h2><p><code>Result</code> 枚举用于表示操作的结果，可能成功也可能失败。它有两个变体：</p>
<ol>
<li>**<code>Ok(T)</code>**：表示操作成功，返回一个值，类型为 <code>T</code>。</li>
<li>**<code>Err(E)</code>**：表示操作失败，返回一个错误，类型为 <code>E</code>。</li>
</ol>
<h3 id="创建和初始化：-2"><a href="#创建和初始化：-2" class="headerlink" title="创建和初始化："></a>创建和初始化：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">num</span>:<span class="type">Result</span>&lt;<span class="type">usize</span>, ()&gt; = <span class="title function_ invoke__">ok</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">match</span> num &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(val) =&gt; &#123;&#125;</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(_) =&gt; &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="常用操作：-1"><a href="#常用操作：-1" class="headerlink" title="常用操作："></a>常用操作：</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">result</span>: <span class="type">Result</span>&lt;<span class="title function_ invoke__">i32</span> ()&gt; = <span class="title function_ invoke__">Ok</span>(<span class="number">1</span>);</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">b</span> = result.<span class="title function_ invoke__">map</span>(|num| num + <span class="number">1</span>);</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">c</span> = result.<span class="title function_ invoke__">and_then</span>(|val| <span class="title function_ invoke__">Ok</span>(val + <span class="number">1</span>));</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">d</span> = result.<span class="title function_ invoke__">or_else</span>(|val| <span class="title function_ invoke__">Err</span>(<span class="number">1</span>));</span><br><span class="line">   </span><br></pre></td></tr></table></figure>

<h2 id="Option-转-Result："><a href="#Option-转-Result：" class="headerlink" title="Option 转 Result："></a>Option 转 Result：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">opt</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = <span class="title function_ invoke__">Some</span>(<span class="number">42</span>);</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">Result</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = opt.<span class="title function_ invoke__">ok_or</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">   <span class="built_in">assert_eq!</span>(result, <span class="title function_ invoke__">Ok</span>(<span class="number">42</span>));</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">none</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = <span class="literal">None</span>;</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">result</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = none.<span class="title function_ invoke__">ok_or</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">   <span class="built_in">assert_eq!</span>(result, <span class="title function_ invoke__">Err</span>(<span class="string">&quot;error&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="Result-转-Option："><a href="#Result-转-Option：" class="headerlink" title="Result 转 Option："></a>Result 转 Option：</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">res</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt; = <span class="title function_ invoke__">Ok</span>(<span class="number">24</span>);</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">option</span> = res.<span class="title function_ invoke__">ok</span>();</span><br><span class="line">   <span class="built_in">assert_eq!</span>(opt,<span class="title function_ invoke__">Some</span>(<span class="number">42</span>));</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> <span class="variable">res</span>: <span class="type">Result</span>&lt;<span class="type">i32</span>, &amp;<span class="type">str</span>&gt;= <span class="title function_ invoke__">Err</span>(<span class="string">&quot;Nothing here&quot;</span>);</span><br><span class="line">   <span class="keyword">let</span> <span class="variable">opt</span>: <span class="type">Option</span>&lt;<span class="type">i32</span>&gt; = res.<span class="title function_ invoke__">ok</span>();</span><br><span class="line">   <span class="built_in">assert_eq!</span>(opt,<span class="literal">None</span>);</span><br></pre></td></tr></table></figure>

<h2 id="枚举内存布局："><a href="#枚举内存布局：" class="headerlink" title="枚举内存布局："></a>枚举内存布局：</h2><p>枚举的内存占用取决于其变体的最大内存需求。枚举的内存布局需要能够容纳所有变体中的最大数据量，同时还需要存储一个判别式（discriminant）来区分不同的变体。</p>
<h3 id="内存布局"><a href="#内存布局" class="headerlink" title="内存布局"></a>内存布局</h3><ol>
<li><p><strong>判别式</strong>：</p>
<ul>
<li>每个枚举变体都有一个判别式，用于区分不同的变体。</li>
<li>判别式通常是一个整数，其大小取决于枚举变体的数量。对于大多数情况，判别式占用 1 个字节（u8）或 2 个字节（u16），但如果有更多的变体，可能会占用更大的空间。</li>
</ul>
</li>
<li><p><strong>变体数据</strong>：</p>
<ul>
<li>每个变体的数据需要存储在枚举的内存中。</li>
<li>枚举的总内存大小是所有变体中最大数据大小加上判别式的大小。</li>
</ul>
</li>
</ol>
<p>通过使用 <code>std::mem::size_of_val</code> 函数，你可以查看具体实例的内存占用情况，从而更好地理解枚举的内存布局。</p>
<p>代码示例：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Pets</span> &#123;</span><br><span class="line">    Cat &#123; name: <span class="type">String</span> &#125;,</span><br><span class="line">    Dog &#123; name: <span class="type">String</span>, age: <span class="type">usize</span> &#125;,</span><br><span class="line">    Bird,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">my_cat</span> = Pets::Cat &#123; name: <span class="string">&quot;Whiskers&quot;</span>.<span class="title function_ invoke__">to_string</span>() &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">my_dog</span> = Pets::Dog &#123; name: <span class="string">&quot;Buddy&quot;</span>.<span class="title function_ invoke__">to_string</span>(), age: <span class="number">3</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">my_bird</span> = Pets::Bird;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Size of Cat: &#123;&#125; bytes&quot;</span>, std::mem::<span class="title function_ invoke__">size_of_val</span>(&amp;my_cat));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Size of Dog: &#123;&#125; bytes&quot;</span>, std::mem::<span class="title function_ invoke__">size_of_val</span>(&amp;my_dog));</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Size of Bird: &#123;&#125; bytes&quot;</span>, std::mem::<span class="title function_ invoke__">size_of_val</span>(&amp;my_bird));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//运行结果</span></span><br><span class="line">Size of Cat: <span class="number">24</span> bytes</span><br><span class="line">Size of Dog: <span class="number">24</span> bytes</span><br><span class="line">Size of Bird: <span class="number">1</span> bytes</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Cat</code> 变体包含一个 <code>String</code>，<code>String</code> 本身占用 24 个字节。</li>
<li><code>Dog</code> 变体包含一个 <code>String</code> 和一个 <code>usize</code>，<code>String</code> 占用 24 个字节，<code>usize</code> 占用 8 个字节，总共 32 个字节。但由于枚举的内存布局需要对齐（这个自行查找内存对齐），所以实际占用 24 个字节。</li>
<li><code>Bird</code> 变体没有附加数据，判别式占用 1 个字节。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/23/Rust-lesson-9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/10/23/Rust-lesson-9/" itemprop="url">Rust lesson 9- 字符串（String）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-10-23T18:54:04+08:00">
                2024-10-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Rust-字符类型："><a href="#Rust-字符类型：" class="headerlink" title="Rust 字符类型："></a>Rust 字符类型：</h1><p>Rust中字符使用Unicode类型，每个字符占4个字节空间。<br>但是，字符串用的是UTF-8，字符串中的字符所占的字节数是变化的（1-4）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&quot;hello 中国&quot;这样一个字符串来说，utf编码为：</span><br><span class="line"></span><br><span class="line">h  104</span><br><span class="line">e  101</span><br><span class="line">l  108</span><br><span class="line">l  108</span><br><span class="line">o  111</span><br><span class="line">中 228,184,173</span><br><span class="line">国 229,155,189</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="str类型，其本质也是一个字节数组（-u8"><a href="#str类型，其本质也是一个字节数组（-u8" class="headerlink" title="str类型，其本质也是一个字节数组（[u8])"></a>str类型，其本质也是一个字节数组（[u8])</h1><p>str或[u8]类型的值存放在内存某处：maybe 堆 | 栈 | 硬编码进可执行文件</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s</span>: &amp;<span class="type">str</span> = <span class="string">&quot;Hello ,world!&quot;</span>;</span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="1-str硬编译进可执行文件"><a href="#1-str硬编译进可执行文件" class="headerlink" title="1.str硬编译进可执行文件"></a>1.str硬编译进可执行文件</h2><p>下面这种双引号的写法，Rust编译的时候就直接把它写进可执行文件中，没法修改。<br>一般使用<code>&amp;str</code> （字符串切片）来引用</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;Hello world&quot;</span>; <span class="comment">//等于 let s:&amp;s = &quot;Hello world&quot;;</span></span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-String-堆上生成"><a href="#2-String-堆上生成" class="headerlink" title="2.String 堆上生成"></a>2.String 堆上生成</h2><p>运行时产生，String可改变，也拥有所有权</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="str-vs-String"><a href="#str-vs-String" class="headerlink" title="&amp;str vs String:"></a>&amp;str vs String:</h2><h3 id="str-字符串切片"><a href="#str-字符串切片" class="headerlink" title="&amp;str (字符串切片)"></a><code>&amp;str</code> (字符串切片)</h3><ol>
<li>不可变性：&amp;str 是一个不可变的字符串切片，通常用于表示一段只读的字符串数据。</li>
<li>借用特性：&amp;str 是一个引用，它借用了某个地方的数据，不拥有数据的所有权。这意味着它的生命周期受到所引用数据的限制。</li>
<li>栈上分配：由于&amp;str是引用类型，它自身占用的内存很小，通常只包含指向实际字符串数据的指针和长度信息，因此可以在栈上高效地传递。</li>
<li>性能优势：因为不需要复制字符串数据，使用&amp;str可以提高性能，尤其是在频繁传递或处理大量文本数据时。</li>
<li>应用场景：适合用于不需要修改的字符串数据，如函数参数、配置项等。</li>
</ol>
<h3 id="String"><a href="#String" class="headerlink" title="String"></a><code>String</code></h3><ol>
<li>可变性：String 类型是可变的，允许在其生命周期内添加、删除或修改内容。</li>
<li>所有权：String 拥有其数据的所有权，这意味着当String实例超出作用域时，其数据将被自动释放。</li>
<li>堆上分配：String 实际的数据存储在堆上，这使得它可以动态增长，但也意味着创建和销毁String实例可能涉及更多的内存管理开销。</li>
<li>灵活性：由于String是可变的，并且可以动态调整大小，因此它提供了更多的灵活性，适用于需要构建或修改字符串的场景。</li>
<li>应用场景：适合用于需要修改或构建的字符串数据，如从用户输入中读取文本、拼接字符串等。</li>
</ol>
<h1 id="类型转换："><a href="#类型转换：" class="headerlink" title="类型转换："></a>类型转换：</h1><h2 id="1-UTF-8-字节-字符串"><a href="#1-UTF-8-字节-字符串" class="headerlink" title="1.UTF-8 字节 -&gt; 字符串"></a>1.UTF-8 字节 -&gt; 字符串</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::<span class="type">str</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">b</span> = [<span class="number">104</span>,<span class="number">101</span>,<span class="number">108</span>,<span class="number">108</span>,<span class="number">111</span>,<span class="number">32</span>,<span class="number">228</span>,<span class="number">184</span>,<span class="number">173</span>,<span class="number">229</span>,<span class="number">155</span>,<span class="number">189</span>];</span><br><span class="line">	<span class="comment">//unwrap</span></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s</span> = <span class="type">str</span>::<span class="title function_ invoke__">from_utf8</span>(&amp;b).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">	<span class="comment">//输出 hello 中国</span></span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-字符串-字节"><a href="#2-字符串-字节" class="headerlink" title="2.字符串 -&gt; 字节"></a>2.字符串 -&gt; 字节</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;HELLO 中国&quot;</span>;</span><br><span class="line">	<span class="comment">//as_bytes()</span></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">b</span> = s.<span class="title function_ invoke__">as_bytes</span>();</span><br><span class="line">	dbg!(<span class="string">&quot;&#123;&#125;&quot;</span>,b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-String-str"><a href="#3-String-str" class="headerlink" title="3.String -&gt; &amp;str"></a>3.String -&gt; &amp;str</h2><p>从String 转为 &amp;str 很方便，且无性能损耗。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::<span class="type">str</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello, world&quot;</span>);</span><br><span class="line">	<span class="title function_ invoke__">say_hello</span>(&amp;s);  <span class="comment">//&amp;String -&gt; &amp;str</span></span><br><span class="line">	<span class="title function_ invoke__">say_hello</span>(&amp;s[..]); <span class="comment">//..是取全部，1..3是取e、l</span></span><br><span class="line">	<span class="title function_ invoke__">say_hello</span>(&amp;s[<span class="number">1</span>..<span class="number">7</span>]); <span class="comment">//这里有个坑，索引字节不是字符边界，因为中文的“中”是3个字节</span></span><br><span class="line">	<span class="title function_ invoke__">say_hello</span>(s.<span class="title function_ invoke__">as_str</span>()); <span class="comment">//String -&gt; &amp;str</span></span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">say_hello</span>(s: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-字节数组-String"><a href="#4-字节数组-String" class="headerlink" title="4.字节数组  -&gt;String"></a>4.字节数组  -&gt;String</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="comment">//vec&lt;u8&gt;,vec是动态数组，u8是无符号8位整形</span></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">b</span> = <span class="built_in">vec!</span>(<span class="number">104</span>,<span class="number">101</span>,<span class="number">108</span>,<span class="number">108</span>,<span class="number">111</span>,<span class="number">32</span>,<span class="number">228</span>,<span class="number">184</span>,<span class="number">173</span>,<span class="number">229</span>,<span class="number">155</span>,<span class="number">189</span>);</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from_utf8</span>(b).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">	<span class="title function_ invoke__">println</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="5-str-String"><a href="#5-str-String" class="headerlink" title="5.&amp;str -&gt; String"></a>5.&amp;str -&gt; String</h2><p>效率极低，需要将硬编码在文件的数据，重新malloc到内存中,不建议使用。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span>: &amp;<span class="type">str</span> = <span class="string">&quot;hello, world&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s_string</span>: <span class="type">String</span> = s.<span class="title function_ invoke__">into</span>(); <span class="comment">// 使用 into 方法</span></span><br><span class="line">    <span class="comment">// 或者</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s_string</span>: <span class="type">String</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(s); <span class="comment">// 使用 String::from 方法</span></span><br><span class="line">    <span class="comment">// 或者</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;hello, world&quot;</span>.<span class="title function_ invoke__">to_string</span>(); <span class="comment">// 使用to_string() 方法</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s_string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h1 id="操作字符串"><a href="#操作字符串" class="headerlink" title="操作字符串"></a>操作字符串</h1><h2 id="追加（Push）："><a href="#追加（Push）：" class="headerlink" title="追加（Push）："></a>追加（Push）：</h2><ol>
<li>使用<code>push()</code>方法追加字符 <code>char</code></li>
<li>使用<code>push_str()</code> 方法追加字符串字面量</li>
<li>两个方法都是在原有的字符串上追加，并不会返回新的字符串</li>
<li>字符串追加操作要修改原来的字符串，则该字符串必须是可变的，即字符串变量必须有<code>mut</code>关键字</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="comment">//注意这个mut</span></span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">	s.<span class="title function_ invoke__">push_str</span>(<span class="string">&quot;rust&quot;</span>);</span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;追加字符串 push_str() -&gt;&#123;&#125;&quot;</span>,s);</span><br><span class="line"></span><br><span class="line">	s.<span class="title function_ invoke__">push</span>(<span class="string">&#x27;!&#x27;</span>);</span><br><span class="line">	<span class="title function_ invoke__">println</span>(<span class="string">&quot;追加字符 push() -&gt; ()&quot;</span>,s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="插入-Insert-："><a href="#插入-Insert-：" class="headerlink" title="插入(Insert)："></a>插入(Insert)：</h2><ol>
<li>使用<code>insert()</code> 方法插入单个单词char</li>
<li>使用<code>insert_str()</code> 方法插入字符串字面量</li>
<li>这两个方法需要传入两个参数，第一个参数是字符（串）插入位置的索引，索引从0开始计数；第二个是要插入的字符（串）</li>
<li>由于是修改原来的字符串，所以字符串必须可变，要有<code>mut</code></li>
</ol>
<p>注意：</p>
<ol>
<li>插入的时候不能越界 </li>
<li>插入的位置必须是合法的边界</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">use</span> std::<span class="type">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello 中国&quot;</span>);</span><br><span class="line"></span><br><span class="line">	s.<span class="title function_ invoke__">insert</span>(<span class="number">5</span>,<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">	s.<span class="title function_ invoke__">insert_str</span>(<span class="number">6</span>,<span class="string">&quot;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>


<h2 id="替换："><a href="#替换：" class="headerlink" title="替换："></a>替换：</h2><h3 id="不修改原有字符串："><a href="#不修改原有字符串：" class="headerlink" title="不修改原有字符串："></a>不修改原有字符串：</h3><h4 id="replace："><a href="#replace：" class="headerlink" title="replace："></a>replace：</h4><ol>
<li><code>replace()</code>方法接收两个参数，第一个参数是要被替换的字符串，第二个参数是新的字符串</li>
<li>该方法会替换所有匹配到的字符串</li>
<li>该方法会返回一个新的字符串，而不是改原来那个,所以也不需要<code>mut</code></li>
</ol>
<h4 id="replacen"><a href="#replacen" class="headerlink" title="replacen:"></a>replacen:</h4><ol>
<li>对比<code>replace()</code>,多了第三个参数，表示替换个数</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">use</span> std::<span class="type">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello 中国，I like rust rust&quot;</span>);</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">n</span> = s.<span class="title function_ invoke__">replace</span>(<span class="string">&quot;rust&quot;</span>,<span class="string">&quot;RUST&quot;</span>);</span><br><span class="line">	<span class="comment">//let n = s.replacen(&quot;rust&quot;,&quot;RUST&quot;,2)</span></span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="修改原有字符串："><a href="#修改原有字符串：" class="headerlink" title="修改原有字符串："></a>修改原有字符串：</h3><h4 id="replace-range"><a href="#replace-range" class="headerlink" title="replace_range:"></a>replace_range:</h4><ol>
<li><code>replace_range</code>有两个参数，第一个是替换字符串范围（Range），第二个参数是新的字符串。</li>
<li>该方法直接操作原有的字符串，不返回新的字符串，该方法需要<code>mut</code>。</li>
<li>可以自己试试range的范围大于&#x2F;小于新字符串长度会发生什么，还有留意老朋友边界问题。</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello rust&quot;</span>);</span><br><span class="line">	s.<span class="title function_ invoke__">replace_range</span>(<span class="number">0</span>..<span class="number">5</span>,<span class="string">&quot;HELLO&quot;</span>);</span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="删除："><a href="#删除：" class="headerlink" title="删除："></a>删除：</h2><h3 id="pop："><a href="#pop：" class="headerlink" title="pop："></a>pop：</h3><ol>
<li>删除并返回字符串最后一个字符（就最后那一个）</li>
<li>返回值是个<code>Option</code>类型，就是有字符返回字符，没字符返回一个None</li>
<li>该方法直接操作原来字符串,所以要有<code>mut</code></li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;中中中文&quot;</span>);</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">p1</span> = s.<span class="title function_ invoke__">pop</span>();</span><br><span class="line"></span><br><span class="line">	dbg!(p1); <span class="comment">//dbg用于调试</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="remove："><a href="#remove：" class="headerlink" title="remove："></a>remove：</h3><ol>
<li>直接操作原来字符串，要有<code>mut</code></li>
<li>返回值是删除位置的字符串</li>
<li>只接收一个参数，就是要删除的字符起始索引位置</li>
<li>该方法也是按照字节来处理字符串的，要注意边界问题</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;中中中文&quot;</span>);</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">p1</span> = s.<span class="title function_ invoke__">remove</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	dbg!(s); <span class="comment">//dbg用于调试</span></span><br><span class="line"></span><br><span class="line">&#125;```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### truncate:</span><br><span class="line"><span class="number">1</span>. 删除字符串中从指定位置开始到结尾的全部字符</span><br><span class="line"><span class="number">2</span>. 注意边界问题</span><br><span class="line"><span class="number">3</span>. 直接操作原来字符串</span><br><span class="line"></span><br><span class="line">```rust</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;aaa中中中文&quot;</span>);</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">p1</span> = s.<span class="title function_ invoke__">truncate</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	dbg!(s); <span class="comment">//dbg用于调试</span></span><br></pre></td></tr></table></figure>


<h3 id="clear"><a href="#clear" class="headerlink" title="clear:"></a>clear:</h3><ol>
<li>清空字符串</li>
<li>直接操作原来字符串</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;aaa中中中文&quot;</span>);</span><br><span class="line">	s.<span class="title function_ invoke__">clear</span>();</span><br><span class="line"></span><br><span class="line">	dbg!(s); <span class="comment">//dbg用于调试</span></span><br></pre></td></tr></table></figure>


<h2 id="链接："><a href="#链接：" class="headerlink" title="链接："></a>链接：</h2><h3 id="使用-或者-连接字符串："><a href="#使用-或者-连接字符串：" class="headerlink" title="使用+或者+=连接字符串："></a>使用<code>+</code>或者<code>+=</code>连接字符串：</h3><ol>
<li>这里<code>add()</code>方法的第一个参数是字符串，第二个参数必须为字符串的切片引用类型,也就是<code>&amp;</code></li>
<li><code>+</code>是返回一个新字符串，所以不需要有<code>mut</code></li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s1</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s2</span> = <span class="string">&quot;world&quot;</span>;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s3</span> = s1 + s2;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s3);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s4</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;yeah&quot;</span>);</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s5</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;haha&quot;</span>);</span><br><span class="line">	<span class="comment">//这里s4的所有权会转移到s6，s4转移后无法再使用</span></span><br><span class="line">	<span class="comment">//可以使用s4.clone()来避免转移所有权</span></span><br><span class="line">	<span class="comment">//&amp;s5是引用，不会产生转移</span></span><br><span class="line">	<span class="comment">//可以用let s6 = s4.add(&amp;s5) 相同效果</span></span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s6</span> = s4 + &amp;s5;</span><br><span class="line">	<span class="title function_ invoke__">println</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s6);</span><br></pre></td></tr></table></figure>


<h3 id="使用format！连接字符串："><a href="#使用format！连接字符串：" class="headerlink" title="使用format！连接字符串："></a>使用<code>format！</code>连接字符串：</h3><ol>
<li><code>format！</code>用法与<code>println!</code>类似</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s4</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;yeah&quot;</span>);</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s5</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;haha&quot;</span>);</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">s</span> = <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125; &#123;&#125;&quot;</span>,s4,s5);</span><br><span class="line">	<span class="built_in">print!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>,s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查阅String函数手册链接：<a target="_blank" rel="noopener" href="https://doc.rust-lang.org/stable/std/string/">https://doc.rust-lang.org/stable/std/string/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">QsunOu</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
